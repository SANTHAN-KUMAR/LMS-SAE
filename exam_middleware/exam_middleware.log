2025-12-02 22:39:56,653 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-12-02 22:39:56,653 - multipart.multipart - DEBUG - Calling on_header_field with data[42:61]
2025-12-02 22:39:56,653 - multipart.multipart - DEBUG - Calling on_header_value with data[63:89]
2025-12-02 22:39:56,655 - multipart.multipart - DEBUG - Calling on_header_end with no data
2025-12-02 22:39:56,655 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-12-02 22:39:56,655 - multipart.multipart - DEBUG - Calling on_part_data with data[93:98]
2025-12-02 22:39:56,656 - multipart.multipart - DEBUG - Calling on_part_end with no data
2025-12-02 22:39:56,656 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-12-02 22:39:56,656 - multipart.multipart - DEBUG - Calling on_header_field with data[142:161]
2025-12-02 22:39:56,656 - multipart.multipart - DEBUG - Calling on_header_value with data[163:189]
2025-12-02 22:39:56,656 - multipart.multipart - DEBUG - Calling on_header_end with no data
2025-12-02 22:39:56,657 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-12-02 22:39:56,657 - multipart.multipart - DEBUG - Calling on_part_data with data[193:201]
2025-12-02 22:39:56,658 - multipart.multipart - DEBUG - Calling on_part_end with no data
2025-12-02 22:39:56,658 - multipart.multipart - DEBUG - Calling on_end with no data
2025-12-02 22:39:56,840 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-02 22:39:56,848 - sqlalchemy.engine.Engine - INFO - SELECT staff_users.id, staff_users.username, staff_users.email, staff_users.hashed_password, staff_users.full_name, staff_users.role, staff_users.is_active, staff_users.created_at, staff_users.last_login_at 
FROM staff_users 
WHERE staff_users.username = $1::VARCHAR
2025-12-02 22:39:56,849 - sqlalchemy.engine.Engine - INFO - [generated in 0.00073s] ('admin',)
2025-12-02 22:39:57,082 - sqlalchemy.engine.Engine - INFO - UPDATE staff_users SET last_login_at=$1::TIMESTAMP WITH TIME ZONE WHERE staff_users.id = $2::INTEGER
2025-12-02 22:39:57,083 - sqlalchemy.engine.Engine - INFO - [generated in 0.00050s] (datetime.datetime(2025, 12, 2, 17, 9, 57, 81008, tzinfo=datetime.timezone.utc), 1)
2025-12-02 22:39:57,086 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-02 22:40:26,980 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-12-02 22:40:26,980 - multipart.multipart - DEBUG - Calling on_header_field with data[42:61]
2025-12-02 22:40:26,981 - multipart.multipart - DEBUG - Calling on_header_value with data[63:123]
2025-12-02 22:40:26,981 - multipart.multipart - DEBUG - Calling on_header_end with no data
2025-12-02 22:40:26,981 - multipart.multipart - DEBUG - Calling on_header_field with data[125:137]
2025-12-02 22:40:26,981 - multipart.multipart - DEBUG - Calling on_header_value with data[139:149]
2025-12-02 22:40:26,982 - multipart.multipart - DEBUG - Calling on_header_end with no data
2025-12-02 22:40:26,982 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-12-02 22:40:26,982 - multipart.multipart - DEBUG - Calling on_part_data with data[153:254]
2025-12-02 22:40:26,982 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-02 22:40:26,982 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-02 22:40:26,983 - multipart.multipart - DEBUG - Calling on_part_data with data[256:45108]
2025-12-02 22:40:26,983 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-02 22:40:26,984 - multipart.multipart - DEBUG - Calling on_part_data with data[45109:49152]
2025-12-02 22:40:26,985 - multipart.multipart - DEBUG - Calling on_part_data with data[0:212992]
2025-12-02 22:40:26,985 - multipart.multipart - DEBUG - Calling on_part_data with data[0:33607]
2025-12-02 22:40:26,985 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-02 22:40:26,985 - multipart.multipart - DEBUG - Calling on_part_data with data[33608:51010]
2025-12-02 22:40:26,985 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-02 22:40:26,985 - multipart.multipart - DEBUG - Calling on_part_data with data[51011:57831]
2025-12-02 22:40:26,986 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-02 22:40:26,986 - multipart.multipart - DEBUG - Calling on_part_data with data[57832:78877]
2025-12-02 22:40:26,986 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-02 22:40:26,986 - multipart.multipart - DEBUG - Calling on_part_data with data[78878:147494]
2025-12-02 22:40:26,987 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-02 22:40:26,987 - multipart.multipart - DEBUG - Calling on_part_data with data[147495:208868]
2025-12-02 22:40:26,987 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-02 22:40:26,987 - multipart.multipart - DEBUG - Calling on_part_data with data[208869:230393]
2025-12-02 22:40:26,987 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-02 22:40:26,987 - multipart.multipart - DEBUG - Calling on_part_data with data[230394:232457]
2025-12-02 22:40:26,987 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-02 22:40:26,987 - multipart.multipart - DEBUG - Calling on_part_data with data[232458:238225]
2025-12-02 22:40:26,988 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-02 22:40:26,988 - multipart.multipart - DEBUG - Calling on_part_data with data[238226:245760]
2025-12-02 22:40:26,989 - multipart.multipart - DEBUG - Calling on_part_data with data[0:77448]
2025-12-02 22:40:26,989 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-02 22:40:26,989 - multipart.multipart - DEBUG - Calling on_part_data with data[77449:79891]
2025-12-02 22:40:26,990 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-02 22:40:26,990 - multipart.multipart - DEBUG - Calling on_part_data with data[79892:262144]
2025-12-02 22:40:26,991 - multipart.multipart - DEBUG - Calling on_part_data with data[0:34252]
2025-12-02 22:40:26,991 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-02 22:40:26,991 - multipart.multipart - DEBUG - Calling on_part_data with data[34253:93371]
2025-12-02 22:40:26,991 - multipart.multipart - DEBUG - Calling on_part_end with no data
2025-12-02 22:40:26,991 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-12-02 22:40:26,991 - multipart.multipart - DEBUG - Calling on_header_field with data[93415:93434]
2025-12-02 22:40:26,992 - multipart.multipart - DEBUG - Calling on_header_value with data[93436:93466]
2025-12-02 22:40:26,992 - multipart.multipart - DEBUG - Calling on_header_end with no data
2025-12-02 22:40:26,992 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-12-02 22:40:26,992 - multipart.multipart - DEBUG - Calling on_part_data with data[93470:93478]
2025-12-02 22:40:26,992 - multipart.multipart - DEBUG - Calling on_part_end with no data
2025-12-02 22:40:26,992 - multipart.multipart - DEBUG - Calling on_end with no data
2025-12-02 22:40:27,068 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-02 22:40:27,070 - sqlalchemy.engine.Engine - INFO - SELECT staff_users.id, staff_users.username, staff_users.email, staff_users.hashed_password, staff_users.full_name, staff_users.role, staff_users.is_active, staff_users.created_at, staff_users.last_login_at 
FROM staff_users 
WHERE staff_users.id = $1::INTEGER
2025-12-02 22:40:27,071 - sqlalchemy.engine.Engine - INFO - [generated in 0.00072s] (1,)
2025-12-02 22:40:27,077 - app.services.file_processor - INFO - Parsed filename (strict): 212223240065, 19AI411
2025-12-02 22:40:27,079 - app.services.file_processor - INFO - Saved file: ./uploads\pending\85e0aacc54b24e6993d6fcc4efc059a5.jpg (hash: 8e24fdd42caf25f1...)
2025-12-02 22:40:27,084 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE examination_artifacts.transaction_id = $1::VARCHAR
2025-12-02 22:40:27,084 - sqlalchemy.engine.Engine - INFO - [generated in 0.00106s] ('6a02102b82cbf452d8cc15bf3919a176',)
2025-12-02 22:40:27,120 - sqlalchemy.engine.Engine - INFO - INSERT INTO examination_artifacts (artifact_uuid, raw_filename, original_filename, parsed_reg_no, parsed_subject_code, file_blob_path, file_hash, file_size_bytes, mime_type, moodle_user_id, moodle_username, moodle_course_id, moodle_assignment_id, workflow_status, moodle_draft_item_id, moodle_submission_id, lms_transaction_id, transaction_id, validated_at, submit_timestamp, completed_at, uploaded_by_staff_id, submitted_by_user_id, transaction_log, error_message, retry_count) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::BIGINT, $9::VARCHAR, $10::BIGINT, $11::VARCHAR, $12::INTEGER, $13::INTEGER, $14::workflowstatus, $15::BIGINT, $16::VARCHAR, $17::VARCHAR, $18::VARCHAR, $19::TIMESTAMP WITH TIME ZONE, $20::TIMESTAMP WITH TIME ZONE, $21::TIMESTAMP WITH TIME ZONE, $22::INTEGER, $23::BIGINT, $24::JSONB, $25::VARCHAR, $26::INTEGER) RETURNING examination_artifacts.id, examination_artifacts.uploaded_at
2025-12-02 22:40:27,120 - sqlalchemy.engine.Engine - INFO - [generated in 0.00093s] (UUID('9900387b-884b-456a-8433-70489e226a40'), '212223240065_19AI411.jpg', '212223240065_19AI411.jpg', '212223240065', '19AI411', './uploads\\pending\\85e0aacc54b24e6993d6fcc4efc059a5.jpg', '8e24fdd42caf25f119e96b8b3135d254a4a9adce5ef48fcfd0bb9240879a4bc5', 863266, 'image/jpeg', None, None, None, None, 'PENDING', None, None, None, '6a02102b82cbf452d8cc15bf3919a176', None, None, None, 1, None, '[{"timestamp": "2025-12-02T17:10:27.117636", "action": "created", "details": {"filename": "212223240065_19AI411.jpg", "parsed_reg_no": "212223240065", "parsed_subject_code": "19AI411"}}]', None, 0)
2025-12-02 22:40:27,129 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE examination_artifacts.id = $1::INTEGER
2025-12-02 22:40:27,129 - sqlalchemy.engine.Engine - INFO - [generated in 0.00052s] (17,)
2025-12-02 22:40:27,130 - app.services.artifact_service - INFO - Created artifact: 9900387b-884b-456a-8433-70489e226a40
2025-12-02 22:40:27,132 - sqlalchemy.engine.Engine - INFO - INSERT INTO audit_logs (action, action_category, description, actor_type, actor_id, actor_username, actor_ip, artifact_id, target_type, target_id, request_data, response_data, moodle_api_function, moodle_response_code) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::INTEGER, $9::VARCHAR, $10::VARCHAR, $11::JSONB, $12::JSONB, $13::VARCHAR, $14::INTEGER) RETURNING audit_logs.id, audit_logs.created_at
2025-12-02 22:40:27,132 - sqlalchemy.engine.Engine - INFO - [generated in 0.00056s] ('bulk_upload', 'upload', 'Bulk upload: 1 successful, 0 failed', 'staff', '1', 'admin', '127.0.0.1', None, None, None, '{"total": 1, "successful": 1, "failed": 0}', 'null', None, None)
2025-12-02 22:40:27,134 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-02 22:40:35,102 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-02 22:40:35,103 - sqlalchemy.engine.Engine - INFO - SELECT student_sessions.id, student_sessions.session_id, student_sessions.moodle_user_id, student_sessions.moodle_username, student_sessions.moodle_fullname, student_sessions.encrypted_token, student_sessions.token_expires_at, student_sessions.ip_address, student_sessions.user_agent, student_sessions.created_at, student_sessions.last_activity_at, student_sessions.expires_at 
FROM student_sessions 
WHERE student_sessions.session_id = $1::VARCHAR
2025-12-02 22:40:35,104 - sqlalchemy.engine.Engine - INFO - [generated in 0.00047s] ('cuCArYHR6bm4S73s0jZ_X9gCgnk9zEQDh-DflFtmd4w',)
2025-12-02 22:40:35,109 - sqlalchemy.engine.Engine - INFO - UPDATE student_sessions SET last_activity_at=$1::TIMESTAMP WITH TIME ZONE WHERE student_sessions.id = $2::INTEGER
2025-12-02 22:40:35,110 - sqlalchemy.engine.Engine - INFO - [generated in 0.00070s] (datetime.datetime(2025, 12, 2, 17, 10, 35, 108876, tzinfo=datetime.timezone.utc), 19)
2025-12-02 22:40:35,112 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-02 22:40:35,180 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-02 22:40:35,181 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE (examination_artifacts.parsed_reg_no = $1::VARCHAR OR examination_artifacts.moodle_username = $2::VARCHAR) AND examination_artifacts.workflow_status IN ($3::workflowstatus, $4::workflowstatus, $5::workflowstatus, $6::workflowstatus) ORDER BY examination_artifacts.uploaded_at DESC
2025-12-02 22:40:35,182 - sqlalchemy.engine.Engine - INFO - [generated in 0.00066s] ('212223240065', '212223240065', 'PENDING', 'PENDING_REVIEW', 'VALIDATED', 'READY_FOR_REVIEW')
2025-12-02 22:40:35,196 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE examination_artifacts.parsed_reg_no = $1::VARCHAR AND examination_artifacts.workflow_status IN ($2::workflowstatus, $3::workflowstatus) ORDER BY examination_artifacts.submit_timestamp DESC
2025-12-02 22:40:35,196 - sqlalchemy.engine.Engine - INFO - [generated in 0.00067s] ('212223240065', 'SUBMITTED_TO_LMS', 'COMPLETED')
2025-12-02 22:40:35,198 - sqlalchemy.engine.Engine - INFO - SELECT subject_mappings.id, subject_mappings.subject_code, subject_mappings.subject_name, subject_mappings.moodle_course_id, subject_mappings.moodle_course_idnumber, subject_mappings.moodle_assignment_id, subject_mappings.moodle_assignment_name, subject_mappings.exam_session, subject_mappings.is_active, subject_mappings.created_at, subject_mappings.updated_at, subject_mappings.last_verified_at 
FROM subject_mappings 
WHERE subject_mappings.subject_code = $1::VARCHAR AND subject_mappings.is_active = true
2025-12-02 22:40:35,199 - sqlalchemy.engine.Engine - INFO - [generated in 0.00062s] ('19AI411',)
2025-12-02 22:40:35,203 - sqlalchemy.engine.Engine - INFO - SELECT subject_mappings.id, subject_mappings.subject_code, subject_mappings.subject_name, subject_mappings.moodle_course_id, subject_mappings.moodle_course_idnumber, subject_mappings.moodle_assignment_id, subject_mappings.moodle_assignment_name, subject_mappings.exam_session, subject_mappings.is_active, subject_mappings.created_at, subject_mappings.updated_at, subject_mappings.last_verified_at 
FROM subject_mappings 
WHERE subject_mappings.subject_code = $1::VARCHAR AND subject_mappings.is_active = true
2025-12-02 22:40:35,203 - sqlalchemy.engine.Engine - INFO - [cached since 0.003942s ago] ('19AI411',)
2025-12-02 22:40:35,204 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-02 22:40:35,215 - app.db.database - ERROR - Database session error: [{'type': 'missing', 'loc': ('header', 'X-Session-ID'), 'msg': 'Field required', 'input': None, 'url': 'https://errors.pydantic.dev/2.5/v/missing'}]
2025-12-02 22:40:41,914 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-02 22:40:41,915 - sqlalchemy.engine.Engine - INFO - SELECT student_sessions.id, student_sessions.session_id, student_sessions.moodle_user_id, student_sessions.moodle_username, student_sessions.moodle_fullname, student_sessions.encrypted_token, student_sessions.token_expires_at, student_sessions.ip_address, student_sessions.user_agent, student_sessions.created_at, student_sessions.last_activity_at, student_sessions.expires_at 
FROM student_sessions 
WHERE student_sessions.session_id = $1::VARCHAR
2025-12-02 22:40:41,915 - sqlalchemy.engine.Engine - INFO - [cached since 6.812s ago] ('cuCArYHR6bm4S73s0jZ_X9gCgnk9zEQDh-DflFtmd4w',)
2025-12-02 22:40:41,919 - sqlalchemy.engine.Engine - INFO - UPDATE student_sessions SET last_activity_at=$1::TIMESTAMP WITH TIME ZONE WHERE student_sessions.id = $2::INTEGER
2025-12-02 22:40:41,920 - sqlalchemy.engine.Engine - INFO - [cached since 6.81s ago] (datetime.datetime(2025, 12, 2, 17, 10, 41, 918463, tzinfo=datetime.timezone.utc), 19)
2025-12-02 22:40:41,921 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-02 22:40:41,984 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-02 22:40:41,985 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE examination_artifacts.artifact_uuid = $1::UUID
2025-12-02 22:40:41,986 - sqlalchemy.engine.Engine - INFO - [generated in 0.00067s] ('9900387b-884b-456a-8433-70489e226a40',)
2025-12-02 22:40:42,002 - sqlalchemy.engine.Engine - INFO - SELECT subject_mappings.id, subject_mappings.subject_code, subject_mappings.subject_name, subject_mappings.moodle_course_id, subject_mappings.moodle_course_idnumber, subject_mappings.moodle_assignment_id, subject_mappings.moodle_assignment_name, subject_mappings.exam_session, subject_mappings.is_active, subject_mappings.created_at, subject_mappings.updated_at, subject_mappings.last_verified_at 
FROM subject_mappings 
WHERE subject_mappings.subject_code = $1::VARCHAR AND subject_mappings.is_active = true
2025-12-02 22:40:42,003 - sqlalchemy.engine.Engine - INFO - [cached since 6.804s ago] ('19AI411',)
2025-12-02 22:40:42,005 - sqlalchemy.engine.Engine - INFO - UPDATE examination_artifacts SET moodle_user_id=$1::BIGINT, moodle_username=$2::VARCHAR, moodle_assignment_id=$3::INTEGER WHERE examination_artifacts.id = $4::INTEGER
2025-12-02 22:40:42,007 - sqlalchemy.engine.Engine - INFO - [generated in 0.00058s] (4, 'student2', 3, 17)
2025-12-02 22:40:42,008 - sqlalchemy.engine.Engine - INFO - INSERT INTO audit_logs (action, action_category, description, actor_type, actor_id, actor_username, actor_ip, artifact_id, target_type, target_id, request_data, response_data, moodle_api_function, moodle_response_code) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::INTEGER, $9::VARCHAR, $10::VARCHAR, $11::JSONB, $12::JSONB, $13::VARCHAR, $14::INTEGER) RETURNING audit_logs.id, audit_logs.created_at
2025-12-02 22:40:42,009 - sqlalchemy.engine.Engine - INFO - [cached since 14.88s ago] ('submission_started', 'submit', 'Starting submission for assignment 3', 'student', '4', 'student2', '127.0.0.1', 17, None, None, 'null', 'null', None, None)
2025-12-02 22:40:42,011 - app.services.submission_service - INFO - Step 1/3: Uploading file to draft area
2025-12-02 22:40:42,012 - sqlalchemy.engine.Engine - INFO - UPDATE examination_artifacts SET workflow_status=$1::workflowstatus WHERE examination_artifacts.id = $2::INTEGER
2025-12-02 22:40:42,012 - sqlalchemy.engine.Engine - INFO - [generated in 0.00033s] ('UPLOADING', 17)
2025-12-02 22:40:42,307 - app.services.moodle_client - INFO - Uploading file: 212223240065_19AI411.jpg (863266 bytes)
2025-12-02 22:40:42,307 - httpcore.connection - DEBUG - connect_tcp.started host='1844fdb23815.ngrok-free.app' port=443 local_address=None timeout=30.0 socket_options=None
2025-12-02 22:40:42,369 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000026ECE78DAD0>
2025-12-02 22:40:42,370 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000026ECE74A180> server_hostname='1844fdb23815.ngrok-free.app' timeout=30.0
2025-12-02 22:40:42,429 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000026ECE75E490>
2025-12-02 22:40:42,429 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-12-02 22:40:42,430 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-12-02 22:40:42,430 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-12-02 22:40:44,405 - httpcore.http11 - DEBUG - send_request_body.complete
2025-12-02 22:40:44,406 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-12-02 22:40:49,020 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Accept-Ranges', b'none'), (b'Access-Control-Allow-Origin', b'*'), (b'Cache-Control', b'no-store, no-cache, must-revalidate'), (b'Cache-Control', b'post-check=0, pre-check=0'), (b'Content-Length', b'293'), (b'Content-Type', b'text/plain; charset=utf-8'), (b'Date', b'Tue, 02 Dec 2025 17:10:42 GMT'), (b'Expires', b'Mon, 20 Aug 1969 09:23:00 GMT'), (b'Last-Modified', b'Tue, 02 Dec 2025 17:10:48 GMT'), (b'Ngrok-Agent-Ips', b'2401:4900:9157:667e:99c1:3a88:6025:b680'), (b'Pragma', b'no-cache'), (b'Server', b'Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.2.4'), (b'X-Powered-By', b'PHP/8.2.4')])
2025-12-02 22:40:49,021 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-12-02 22:40:49,022 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-12-02 22:40:49,022 - httpcore.http11 - DEBUG - response_closed.started
2025-12-02 22:40:49,022 - httpcore.http11 - DEBUG - response_closed.complete
2025-12-02 22:40:49,023 - app.services.moodle_client - INFO - Upload response: [{'component': 'user', 'contextid': 18, 'userid': '4', 'filearea': 'draft', 'filename': '212223240065_19AI411.jpg', 'filepath': '/', 'itemid': 16118978, 'license': 'unknown', 'author': 'student 212223240065', 'source': 'O:8:"stdClass":1:{s:6:"source";s:24:"212223240065_19AI411.jpg";}', 'filesize': 863266}]
2025-12-02 22:40:49,023 - app.services.moodle_client - INFO - File uploaded successfully. Item ID: 16118978
2025-12-02 22:40:49,024 - sqlalchemy.engine.Engine - INFO - UPDATE examination_artifacts SET moodle_draft_item_id=$1::BIGINT WHERE examination_artifacts.id = $2::INTEGER
2025-12-02 22:40:49,025 - sqlalchemy.engine.Engine - INFO - [generated in 0.00109s] (16118978, 17)
2025-12-02 22:40:49,026 - app.services.submission_service - INFO - Verifying assignment 3 exists and is accessible...
2025-12-02 22:40:49,027 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-12-02 22:40:49,027 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-12-02 22:40:49,027 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-12-02 22:40:49,027 - httpcore.http11 - DEBUG - send_request_body.complete
2025-12-02 22:40:49,027 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-12-02 22:40:49,320 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Accept-Ranges', b'none'), (b'Access-Control-Allow-Origin', b'*'), (b'Cache-Control', b'private, must-revalidate, pre-check=0, post-check=0, max-age=0'), (b'Content-Length', b'986'), (b'Content-Type', b'application/json'), (b'Date', b'Tue, 02 Dec 2025 17:10:49 GMT'), (b'Expires', b'Thu, 01 Jan 1970 00:00:00 GMT'), (b'Ngrok-Agent-Ips', b'2401:4900:9157:667e:99c1:3a88:6025:b680'), (b'Pragma', b'no-cache'), (b'Server', b'Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.2.4'), (b'X-Powered-By', b'PHP/8.2.4')])
2025-12-02 22:40:49,320 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-12-02 22:40:49,320 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-12-02 22:40:49,320 - httpcore.http11 - DEBUG - response_closed.started
2025-12-02 22:40:49,321 - httpcore.http11 - DEBUG - response_closed.complete
2025-12-02 22:40:49,321 - app.services.submission_service - INFO - Assignment 3 verified and accessible
2025-12-02 22:40:49,321 - app.services.submission_service - INFO - Step 2/3: Linking draft to assignment
2025-12-02 22:40:49,322 - sqlalchemy.engine.Engine - INFO - UPDATE examination_artifacts SET workflow_status=$1::workflowstatus WHERE examination_artifacts.id = $2::INTEGER
2025-12-02 22:40:49,322 - sqlalchemy.engine.Engine - INFO - [cached since 7.311s ago] ('SUBMITTING', 17)
2025-12-02 22:40:49,325 - app.services.moodle_client - INFO - Saving submission for assignment 3 with item 16118978
2025-12-02 22:40:49,325 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-12-02 22:40:49,325 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-12-02 22:40:49,325 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-12-02 22:40:49,326 - httpcore.http11 - DEBUG - send_request_body.complete
2025-12-02 22:40:49,326 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-12-02 22:40:49,744 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Accept-Ranges', b'none'), (b'Access-Control-Allow-Origin', b'*'), (b'Cache-Control', b'private, must-revalidate, pre-check=0, post-check=0, max-age=0'), (b'Content-Length', b'2'), (b'Content-Type', b'application/json'), (b'Date', b'Tue, 02 Dec 2025 17:10:49 GMT'), (b'Expires', b'Thu, 01 Jan 1970 00:00:00 GMT'), (b'Ngrok-Agent-Ips', b'2401:4900:9157:667e:99c1:3a88:6025:b680'), (b'Pragma', b'no-cache'), (b'Server', b'Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.2.4'), (b'X-Powered-By', b'PHP/8.2.4')])
2025-12-02 22:40:49,744 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-12-02 22:40:49,745 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-12-02 22:40:49,746 - httpcore.http11 - DEBUG - response_closed.started
2025-12-02 22:40:49,746 - httpcore.http11 - DEBUG - response_closed.complete
2025-12-02 22:40:49,746 - app.services.moodle_client - INFO - mod_assign_save_submission response: []
2025-12-02 22:40:49,746 - app.services.moodle_client - INFO - Submission saved successfully for assignment 3
2025-12-02 22:40:49,748 - app.services.submission_service - INFO - Verifying submission status after save...
2025-12-02 22:40:49,748 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-12-02 22:40:49,749 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-12-02 22:40:49,749 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-12-02 22:40:49,749 - httpcore.http11 - DEBUG - send_request_body.complete
2025-12-02 22:40:49,749 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-12-02 22:40:49,973 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Accept-Ranges', b'none'), (b'Access-Control-Allow-Origin', b'*'), (b'Cache-Control', b'private, must-revalidate, pre-check=0, post-check=0, max-age=0'), (b'Content-Length', b'986'), (b'Content-Type', b'application/json'), (b'Date', b'Tue, 02 Dec 2025 17:10:49 GMT'), (b'Expires', b'Thu, 01 Jan 1970 00:00:00 GMT'), (b'Ngrok-Agent-Ips', b'2401:4900:9157:667e:99c1:3a88:6025:b680'), (b'Pragma', b'no-cache'), (b'Server', b'Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.2.4'), (b'X-Powered-By', b'PHP/8.2.4')])
2025-12-02 22:40:49,974 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-12-02 22:40:49,974 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-12-02 22:40:49,974 - httpcore.http11 - DEBUG - response_closed.started
2025-12-02 22:40:49,974 - httpcore.http11 - DEBUG - response_closed.complete
2025-12-02 22:40:49,975 - app.services.submission_service - INFO - Full submission status response: {'lastattempt': {'submission': {'id': 7, 'userid': 4, 'attemptnumber': 0, 'timecreated': 1764684184, 'timemodified': 1764695449, 'timestarted': None, 'status': 'submitted', 'groupid': 0, 'assignment': 3, 'latest': 1, 'plugins': [{'type': 'file', 'name': 'File submissions', 'fileareas': [{'area': 'submission_files', 'files': [{'filename': '212223240065_19AI411.jpg', 'filepath': '/', 'filesize': 1206297, 'fileurl': 'https://1844fdb23815.ngrok-free.app/webservice/pluginfile.php/30/assignsubmission_file/submission_files/7/212223240065_19AI411.jpg', 'timemodified': 1764695449, 'mimetype': 'image/jpeg', 'isexternalfile': False, 'icon': 'f/image'}]}]}, {'type': 'comments', 'name': 'Submission comments'}]}, 'submissiongroupmemberswhoneedtosubmit': [], 'submissionsenabled': True, 'locked': False, 'graded': False, 'canedit': True, 'caneditowner': True, 'cansubmit': False, 'extensionduedate': None, 'timelimit': 0, 'blindmarking': False, 'gradingstatus': 'notgraded', 'usergroups': []}, 'assignmentdata': {'attachments': {'intro': []}}, 'warnings': []}
2025-12-02 22:40:49,975 - app.services.submission_service - INFO - Submission status: submitted
2025-12-02 22:40:49,975 - app.services.submission_service - INFO - Submission ID: 7
2025-12-02 22:40:49,975 - app.services.submission_service - INFO - Submission timecreated: 1764684184
2025-12-02 22:40:49,977 - app.services.submission_service - INFO - Submission timemodified: 1764695449
2025-12-02 22:40:49,977 - app.services.submission_service - INFO - Grading status: notgraded
2025-12-02 22:40:49,977 - app.services.submission_service - INFO - Submissions enabled: True
2025-12-02 22:40:49,977 - app.services.submission_service - INFO - Can edit: True
2025-12-02 22:40:49,977 - app.services.submission_service - INFO - Can submit: False
2025-12-02 22:40:49,977 - app.services.submission_service - INFO - Submission verification - Files found: 1
2025-12-02 22:40:49,977 - app.services.submission_service - INFO - Verified files: ['212223240065_19AI411.jpg']
2025-12-02 22:40:49,977 - app.services.submission_service - INFO - Skipping explicit submit_for_grading call because Moodle reports cansubmit=False. Treating current 'submitted' state as final.
2025-12-02 22:40:49,977 - httpcore.connection - DEBUG - close.started
2025-12-02 22:40:49,978 - httpcore.connection - DEBUG - close.complete
2025-12-02 22:40:49,978 - app.services.submission_service - INFO - Submission result: {'assignment_id': 3, 'steps_completed': ['upload', 'save'], 'item_id': 16118978, 'save_result': {'success': True, 'warnings': []}, 'submission_status': 'submitted', 'submission_id': '7', 'verified_files': ['212223240065_19AI411.jpg'], 'submit_skipped': True, 'success': True, 'transaction_id': 'TXN_9900387b-884b-456a-8433-70489e226a40_20251202171049'}
2025-12-02 22:40:49,978 - app.services.submission_service - INFO - Steps completed: ['upload', 'save']
2025-12-02 22:40:49,979 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE examination_artifacts.id = $1::INTEGER
2025-12-02 22:40:49,979 - sqlalchemy.engine.Engine - INFO - [generated in 0.00043s] (17,)
2025-12-02 22:40:49,980 - sqlalchemy.engine.Engine - INFO - UPDATE examination_artifacts SET workflow_status=$1::workflowstatus, moodle_submission_id=$2::VARCHAR, lms_transaction_id=$3::VARCHAR, submit_timestamp=$4::TIMESTAMP WITH TIME ZONE, completed_at=$5::TIMESTAMP WITH TIME ZONE WHERE examination_artifacts.id = $6::INTEGER
2025-12-02 22:40:49,981 - sqlalchemy.engine.Engine - INFO - [generated in 0.00039s] ('COMPLETED', '7', 'TXN_9900387b-884b-456a-8433-70489e226a40_20251202171049', datetime.datetime(2025, 12, 2, 17, 10, 49, 980504), datetime.datetime(2025, 12, 2, 17, 10, 49, 980504), 17)
2025-12-02 22:40:49,982 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE examination_artifacts.id = $1::INTEGER
2025-12-02 22:40:49,982 - sqlalchemy.engine.Engine - INFO - [cached since 22.86s ago] (17,)
2025-12-02 22:40:49,983 - app.services.artifact_service - INFO - Artifact 17 marked as submitted
2025-12-02 22:40:49,984 - sqlalchemy.engine.Engine - INFO - INSERT INTO audit_logs (action, action_category, description, actor_type, actor_id, actor_username, actor_ip, artifact_id, target_type, target_id, request_data, response_data, moodle_api_function, moodle_response_code) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::INTEGER, $9::VARCHAR, $10::VARCHAR, $11::JSONB, $12::JSONB, $13::VARCHAR, $14::INTEGER) RETURNING audit_logs.id, audit_logs.created_at
2025-12-02 22:40:49,984 - sqlalchemy.engine.Engine - INFO - [cached since 22.85s ago] ('submission_completed', 'submit', 'Submission completed successfully', 'student', '4', 'student2', '127.0.0.1', 17, None, None, 'null', '{"assignment_id": 3, "steps_completed": ["upload", "save"], "item_id": 16118978, "save_result": {"success": true, "warnings": []}, "submission_status ... (54 characters truncated) ... : ["212223240065_19AI411.jpg"], "submit_skipped": true, "success": true, "transaction_id": "TXN_9900387b-884b-456a-8433-70489e226a40_20251202171049"}', None, None)
2025-12-02 22:40:49,985 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-02 22:40:50,056 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-02 22:40:50,056 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE examination_artifacts.artifact_uuid = $1::UUID
2025-12-02 22:40:50,057 - sqlalchemy.engine.Engine - INFO - [cached since 8.073s ago] ('9900387b-884b-456a-8433-70489e226a40',)
2025-12-02 22:40:50,072 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-02 22:40:50,150 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-02 22:40:50,151 - sqlalchemy.engine.Engine - INFO - SELECT student_sessions.id, student_sessions.session_id, student_sessions.moodle_user_id, student_sessions.moodle_username, student_sessions.moodle_fullname, student_sessions.encrypted_token, student_sessions.token_expires_at, student_sessions.ip_address, student_sessions.user_agent, student_sessions.created_at, student_sessions.last_activity_at, student_sessions.expires_at 
FROM student_sessions 
WHERE student_sessions.session_id = $1::VARCHAR
2025-12-02 22:40:50,152 - sqlalchemy.engine.Engine - INFO - [cached since 15.05s ago] ('cuCArYHR6bm4S73s0jZ_X9gCgnk9zEQDh-DflFtmd4w',)
2025-12-02 22:40:50,156 - sqlalchemy.engine.Engine - INFO - UPDATE student_sessions SET last_activity_at=$1::TIMESTAMP WITH TIME ZONE WHERE student_sessions.id = $2::INTEGER
2025-12-02 22:40:50,156 - sqlalchemy.engine.Engine - INFO - [cached since 15.05s ago] (datetime.datetime(2025, 12, 2, 17, 10, 50, 155442, tzinfo=datetime.timezone.utc), 19)
2025-12-02 22:40:50,158 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-02 22:40:50,224 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-02 22:40:50,225 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE (examination_artifacts.parsed_reg_no = $1::VARCHAR OR examination_artifacts.moodle_username = $2::VARCHAR) AND examination_artifacts.workflow_status IN ($3::workflowstatus, $4::workflowstatus, $5::workflowstatus, $6::workflowstatus) ORDER BY examination_artifacts.uploaded_at DESC
2025-12-02 22:40:50,226 - sqlalchemy.engine.Engine - INFO - [cached since 15.05s ago] ('212223240065', '212223240065', 'PENDING', 'PENDING_REVIEW', 'VALIDATED', 'READY_FOR_REVIEW')
2025-12-02 22:40:50,239 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE examination_artifacts.parsed_reg_no = $1::VARCHAR AND examination_artifacts.workflow_status IN ($2::workflowstatus, $3::workflowstatus) ORDER BY examination_artifacts.submit_timestamp DESC
2025-12-02 22:40:50,240 - sqlalchemy.engine.Engine - INFO - [cached since 15.05s ago] ('212223240065', 'SUBMITTED_TO_LMS', 'COMPLETED')
2025-12-02 22:40:50,242 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-02 22:40:50,245 - app.db.database - ERROR - Database session error: [{'type': 'missing', 'loc': ('header', 'X-Session-ID'), 'msg': 'Field required', 'input': None, 'url': 'https://errors.pydantic.dev/2.5/v/missing'}]
2025-12-02 22:44:39,845 - app.main - INFO - Shutting down Examination Middleware...
2025-12-02 22:44:39,845 - app.main - INFO - Database connections closed
2025-12-02 22:44:41,368 - app.main - INFO - Starting Examination Middleware...
2025-12-02 22:44:41,415 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-12-02 22:44:41,416 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-02 22:44:41,417 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-12-02 22:44:41,417 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-02 22:44:41,418 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-12-02 22:44:41,418 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-02 22:44:41,419 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-02 22:44:41,421 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-12-02 22:44:41,421 - sqlalchemy.engine.Engine - INFO - [generated in 0.00035s] ('examination_artifacts', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-12-02 22:44:41,425 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-12-02 22:44:41,426 - sqlalchemy.engine.Engine - INFO - [cached since 0.004874s ago] ('subject_mappings', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-12-02 22:44:41,426 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-12-02 22:44:41,427 - sqlalchemy.engine.Engine - INFO - [cached since 0.005968s ago] ('staff_users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-12-02 22:44:41,427 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-12-02 22:44:41,427 - sqlalchemy.engine.Engine - INFO - [cached since 0.006716s ago] ('student_sessions', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-12-02 22:44:41,428 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-12-02 22:44:41,428 - sqlalchemy.engine.Engine - INFO - [cached since 0.007478s ago] ('audit_logs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-12-02 22:44:41,429 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-12-02 22:44:41,429 - sqlalchemy.engine.Engine - INFO - [cached since 0.008218s ago] ('submission_queue', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-12-02 22:44:41,429 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-12-02 22:44:41,430 - sqlalchemy.engine.Engine - INFO - [cached since 0.009082s ago] ('system_config', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-12-02 22:44:41,432 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2025-12-02 22:44:41,432 - sqlalchemy.engine.Engine - INFO - [generated in 0.00039s] ('workflowstatus', 'pg_catalog')
2025-12-02 22:44:41,433 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-02 22:44:41,439 - app.main - INFO - Database tables created/verified
2025-12-02 22:44:41,440 - app.main - INFO - Upload directory: D:\Test SAE-2\exam_middleware\uploads
2025-12-02 22:44:41,440 - app.main - INFO - Storage directory: D:\Test SAE-2\exam_middleware\storage
2025-12-02 22:44:41,440 - app.main - INFO - Examination Middleware started successfully
2025-12-02 22:46:35,853 - app.main - INFO - Starting Examination Middleware...
2025-12-02 22:46:35,909 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-12-02 22:46:35,910 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-02 22:46:35,911 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-12-02 22:46:35,911 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-02 22:46:35,913 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-12-02 22:46:35,913 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-02 22:46:35,914 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-02 22:46:35,916 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-12-02 22:46:35,916 - sqlalchemy.engine.Engine - INFO - [generated in 0.00050s] ('examination_artifacts', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-12-02 22:46:35,921 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-12-02 22:46:35,922 - sqlalchemy.engine.Engine - INFO - [cached since 0.005479s ago] ('subject_mappings', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-12-02 22:46:35,923 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-12-02 22:46:35,923 - sqlalchemy.engine.Engine - INFO - [cached since 0.006882s ago] ('staff_users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-12-02 22:46:35,924 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-12-02 22:46:35,924 - sqlalchemy.engine.Engine - INFO - [cached since 0.007601s ago] ('student_sessions', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-12-02 22:46:35,925 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-12-02 22:46:35,925 - sqlalchemy.engine.Engine - INFO - [cached since 0.008556s ago] ('audit_logs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-12-02 22:46:35,925 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-12-02 22:46:35,926 - sqlalchemy.engine.Engine - INFO - [cached since 0.0094s ago] ('submission_queue', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-12-02 22:46:35,926 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-12-02 22:46:35,927 - sqlalchemy.engine.Engine - INFO - [cached since 0.01031s ago] ('system_config', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-12-02 22:46:35,927 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2025-12-02 22:46:35,928 - sqlalchemy.engine.Engine - INFO - [generated in 0.00036s] ('workflowstatus', 'pg_catalog')
2025-12-02 22:46:35,929 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-02 22:46:35,940 - app.main - INFO - Database tables created/verified
2025-12-02 22:46:35,941 - app.main - INFO - Upload directory: D:\Test SAE-2\exam_middleware\uploads
2025-12-02 22:46:35,941 - app.main - INFO - Storage directory: D:\Test SAE-2\exam_middleware\storage
2025-12-02 22:46:35,941 - app.main - INFO - Examination Middleware started successfully
2025-12-02 22:46:46,232 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-12-02 22:46:46,233 - multipart.multipart - DEBUG - Calling on_header_field with data[42:61]
2025-12-02 22:46:46,233 - multipart.multipart - DEBUG - Calling on_header_value with data[63:89]
2025-12-02 22:46:46,234 - multipart.multipart - DEBUG - Calling on_header_end with no data
2025-12-02 22:46:46,234 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-12-02 22:46:46,234 - multipart.multipart - DEBUG - Calling on_part_data with data[93:98]
2025-12-02 22:46:46,234 - multipart.multipart - DEBUG - Calling on_part_end with no data
2025-12-02 22:46:46,234 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-12-02 22:46:46,234 - multipart.multipart - DEBUG - Calling on_header_field with data[142:161]
2025-12-02 22:46:46,235 - multipart.multipart - DEBUG - Calling on_header_value with data[163:189]
2025-12-02 22:46:46,235 - multipart.multipart - DEBUG - Calling on_header_end with no data
2025-12-02 22:46:46,235 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-12-02 22:46:46,235 - multipart.multipart - DEBUG - Calling on_part_data with data[193:201]
2025-12-02 22:46:46,235 - multipart.multipart - DEBUG - Calling on_part_end with no data
2025-12-02 22:46:46,235 - multipart.multipart - DEBUG - Calling on_end with no data
2025-12-02 22:46:46,317 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-02 22:46:46,330 - sqlalchemy.engine.Engine - INFO - SELECT staff_users.id, staff_users.username, staff_users.email, staff_users.hashed_password, staff_users.full_name, staff_users.role, staff_users.is_active, staff_users.created_at, staff_users.last_login_at 
FROM staff_users 
WHERE staff_users.username = $1::VARCHAR
2025-12-02 22:46:46,331 - sqlalchemy.engine.Engine - INFO - [generated in 0.00071s] ('admin',)
2025-12-02 22:46:46,577 - sqlalchemy.engine.Engine - INFO - UPDATE staff_users SET last_login_at=$1::TIMESTAMP WITH TIME ZONE WHERE staff_users.id = $2::INTEGER
2025-12-02 22:46:46,578 - sqlalchemy.engine.Engine - INFO - [generated in 0.00095s] (datetime.datetime(2025, 12, 2, 17, 16, 46, 576242, tzinfo=datetime.timezone.utc), 1)
2025-12-02 22:46:46,591 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-02 22:47:03,796 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-12-02 22:47:03,797 - multipart.multipart - DEBUG - Calling on_header_field with data[42:61]
2025-12-02 22:47:03,797 - multipart.multipart - DEBUG - Calling on_header_value with data[63:123]
2025-12-02 22:47:03,797 - multipart.multipart - DEBUG - Calling on_header_end with no data
2025-12-02 22:47:03,797 - multipart.multipart - DEBUG - Calling on_header_field with data[125:137]
2025-12-02 22:47:03,797 - multipart.multipart - DEBUG - Calling on_header_value with data[139:149]
2025-12-02 22:47:03,797 - multipart.multipart - DEBUG - Calling on_header_end with no data
2025-12-02 22:47:03,798 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-12-02 22:47:03,798 - multipart.multipart - DEBUG - Calling on_part_data with data[153:254]
2025-12-02 22:47:03,798 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-02 22:47:03,799 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-02 22:47:03,799 - multipart.multipart - DEBUG - Calling on_part_data with data[256:32768]
2025-12-02 22:47:03,800 - multipart.multipart - DEBUG - Calling on_part_data with data[0:102991]
2025-12-02 22:47:03,801 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-02 22:47:03,801 - multipart.multipart - DEBUG - Calling on_part_data with data[102992:111970]
2025-12-02 22:47:03,801 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-02 22:47:03,802 - multipart.multipart - DEBUG - Calling on_part_data with data[111971:202837]
2025-12-02 22:47:03,802 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-02 22:47:03,802 - multipart.multipart - DEBUG - Calling on_part_data with data[202838:262144]
2025-12-02 22:47:03,803 - multipart.multipart - DEBUG - Calling on_part_data with data[0:32443]
2025-12-02 22:47:03,803 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-02 22:47:03,803 - multipart.multipart - DEBUG - Calling on_part_data with data[32444:42888]
2025-12-02 22:47:03,803 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-02 22:47:03,804 - multipart.multipart - DEBUG - Calling on_part_data with data[42889:85350]
2025-12-02 22:47:03,804 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-02 22:47:03,804 - multipart.multipart - DEBUG - Calling on_part_data with data[85351:184779]
2025-12-02 22:47:03,804 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-02 22:47:03,805 - multipart.multipart - DEBUG - Calling on_part_data with data[184780:216956]
2025-12-02 22:47:03,805 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-02 22:47:03,805 - multipart.multipart - DEBUG - Calling on_part_data with data[216957:262144]
2025-12-02 22:47:03,806 - multipart.multipart - DEBUG - Calling on_part_data with data[0:23803]
2025-12-02 22:47:03,806 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-02 22:47:03,806 - multipart.multipart - DEBUG - Calling on_part_data with data[23804:34926]
2025-12-02 22:47:03,806 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-02 22:47:03,806 - multipart.multipart - DEBUG - Calling on_part_data with data[34927:69260]
2025-12-02 22:47:03,806 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-02 22:47:03,806 - multipart.multipart - DEBUG - Calling on_part_data with data[69261:178829]
2025-12-02 22:47:03,806 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-02 22:47:03,808 - multipart.multipart - DEBUG - Calling on_part_data with data[178830:262144]
2025-12-02 22:47:03,809 - multipart.multipart - DEBUG - Calling on_part_data with data[0:79692]
2025-12-02 22:47:03,809 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-02 22:47:03,809 - multipart.multipart - DEBUG - Calling on_part_data with data[79693:82325]
2025-12-02 22:47:03,809 - multipart.multipart - DEBUG - Calling on_part_end with no data
2025-12-02 22:47:03,809 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-12-02 22:47:03,810 - multipart.multipart - DEBUG - Calling on_header_field with data[82369:82388]
2025-12-02 22:47:03,810 - multipart.multipart - DEBUG - Calling on_header_value with data[82390:82420]
2025-12-02 22:47:03,810 - multipart.multipart - DEBUG - Calling on_header_end with no data
2025-12-02 22:47:03,811 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-12-02 22:47:03,811 - multipart.multipart - DEBUG - Calling on_part_data with data[82424:82432]
2025-12-02 22:47:03,811 - multipart.multipart - DEBUG - Calling on_part_end with no data
2025-12-02 22:47:03,811 - multipart.multipart - DEBUG - Calling on_end with no data
2025-12-02 22:47:03,876 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-02 22:47:03,878 - sqlalchemy.engine.Engine - INFO - SELECT staff_users.id, staff_users.username, staff_users.email, staff_users.hashed_password, staff_users.full_name, staff_users.role, staff_users.is_active, staff_users.created_at, staff_users.last_login_at 
FROM staff_users 
WHERE staff_users.id = $1::INTEGER
2025-12-02 22:47:03,878 - sqlalchemy.engine.Engine - INFO - [generated in 0.00047s] (1,)
2025-12-02 22:47:03,881 - app.services.file_processor - INFO - Parsed filename (strict): 212223240014, 19AI405
2025-12-02 22:47:03,883 - app.services.file_processor - INFO - Saved file: ./uploads\pending\2bff77d3bebc476aa5c41721e44a94a2.jpg (hash: 3a00d46e79102899...)
2025-12-02 22:47:03,886 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE examination_artifacts.transaction_id = $1::VARCHAR
2025-12-02 22:47:03,886 - sqlalchemy.engine.Engine - INFO - [generated in 0.00045s] ('9f46692b458d128fc49cc4c8df7273d1',)
2025-12-02 22:47:03,908 - sqlalchemy.engine.Engine - INFO - INSERT INTO examination_artifacts (artifact_uuid, raw_filename, original_filename, parsed_reg_no, parsed_subject_code, file_blob_path, file_hash, file_size_bytes, mime_type, moodle_user_id, moodle_username, moodle_course_id, moodle_assignment_id, workflow_status, moodle_draft_item_id, moodle_submission_id, lms_transaction_id, transaction_id, validated_at, submit_timestamp, completed_at, uploaded_by_staff_id, submitted_by_user_id, transaction_log, error_message, retry_count) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::BIGINT, $9::VARCHAR, $10::BIGINT, $11::VARCHAR, $12::INTEGER, $13::INTEGER, $14::workflowstatus, $15::BIGINT, $16::VARCHAR, $17::VARCHAR, $18::VARCHAR, $19::TIMESTAMP WITH TIME ZONE, $20::TIMESTAMP WITH TIME ZONE, $21::TIMESTAMP WITH TIME ZONE, $22::INTEGER, $23::BIGINT, $24::JSONB, $25::VARCHAR, $26::INTEGER) RETURNING examination_artifacts.id, examination_artifacts.uploaded_at
2025-12-02 22:47:03,909 - sqlalchemy.engine.Engine - INFO - [generated in 0.00088s] (UUID('0ff3069a-b578-404c-ac60-95451bc7f55c'), '212223240014_19AI405.jpg', '212223240014_19AI405.jpg', '212223240014', '19AI405', './uploads\\pending\\2bff77d3bebc476aa5c41721e44a94a2.jpg', '3a00d46e791028994365d24a1febf50b451f2fee472cf57c44b1c37bb58275dd', 901372, 'image/jpeg', None, None, None, None, 'PENDING', None, None, None, '9f46692b458d128fc49cc4c8df7273d1', None, None, None, 1, None, '[{"timestamp": "2025-12-02T17:17:03.905796", "action": "created", "details": {"filename": "212223240014_19AI405.jpg", "parsed_reg_no": "212223240014", "parsed_subject_code": "19AI405"}}]', None, 0)
2025-12-02 22:47:03,912 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE examination_artifacts.id = $1::INTEGER
2025-12-02 22:47:03,913 - sqlalchemy.engine.Engine - INFO - [generated in 0.00068s] (18,)
2025-12-02 22:47:03,914 - app.services.artifact_service - INFO - Created artifact: 0ff3069a-b578-404c-ac60-95451bc7f55c
2025-12-02 22:47:03,915 - sqlalchemy.engine.Engine - INFO - INSERT INTO audit_logs (action, action_category, description, actor_type, actor_id, actor_username, actor_ip, artifact_id, target_type, target_id, request_data, response_data, moodle_api_function, moodle_response_code) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::INTEGER, $9::VARCHAR, $10::VARCHAR, $11::JSONB, $12::JSONB, $13::VARCHAR, $14::INTEGER) RETURNING audit_logs.id, audit_logs.created_at
2025-12-02 22:47:03,916 - sqlalchemy.engine.Engine - INFO - [generated in 0.00051s] ('bulk_upload', 'upload', 'Bulk upload: 1 successful, 0 failed', 'staff', '1', 'admin', '127.0.0.1', None, None, None, '{"total": 1, "successful": 1, "failed": 0}', 'null', None, None)
2025-12-02 22:47:03,917 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-02 22:47:13,164 - app.api.routes.auth - INFO - Authenticating student: student1
2025-12-02 22:47:13,414 - app.services.moodle_client - INFO - Authenticating user: student1
2025-12-02 22:47:13,414 - httpcore.connection - DEBUG - connect_tcp.started host='1844fdb23815.ngrok-free.app' port=443 local_address=None timeout=30.0 socket_options=None
2025-12-02 22:47:13,603 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001C75116F2D0>
2025-12-02 22:47:13,604 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000001C7512EACC0> server_hostname='1844fdb23815.ngrok-free.app' timeout=30.0
2025-12-02 22:47:13,666 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001C7511DE410>
2025-12-02 22:47:13,668 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-12-02 22:47:13,668 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-12-02 22:47:13,669 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-12-02 22:47:13,669 - httpcore.http11 - DEBUG - send_request_body.complete
2025-12-02 22:47:13,669 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-12-02 22:47:14,178 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Accept-Ranges', b'none'), (b'Access-Control-Allow-Origin', b'*'), (b'Cache-Control', b'no-store, no-cache, must-revalidate'), (b'Cache-Control', b'post-check=0, pre-check=0'), (b'Content-Length', b'126'), (b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Tue, 02 Dec 2025 17:17:13 GMT'), (b'Expires', b'Mon, 20 Aug 1969 09:23:00 GMT'), (b'Last-Modified', b'Tue, 02 Dec 2025 17:17:13 GMT'), (b'Ngrok-Agent-Ips', b'2401:4900:9157:667e:99c1:3a88:6025:b680'), (b'Pragma', b'no-cache'), (b'Server', b'Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.2.4'), (b'X-Powered-By', b'PHP/8.2.4')])
2025-12-02 22:47:14,179 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-12-02 22:47:14,179 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-12-02 22:47:14,179 - httpcore.http11 - DEBUG - response_closed.started
2025-12-02 22:47:14,180 - httpcore.http11 - DEBUG - response_closed.complete
2025-12-02 22:47:14,180 - app.services.moodle_client - INFO - Successfully authenticated user: student1
2025-12-02 22:47:14,180 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-12-02 22:47:14,182 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-12-02 22:47:14,182 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-12-02 22:47:14,182 - httpcore.http11 - DEBUG - send_request_body.complete
2025-12-02 22:47:14,182 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-12-02 22:47:14,406 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Accept-Ranges', b'none'), (b'Access-Control-Allow-Origin', b'*'), (b'Cache-Control', b'private, must-revalidate, pre-check=0, post-check=0, max-age=0'), (b'Content-Type', b'application/json'), (b'Date', b'Tue, 02 Dec 2025 17:17:14 GMT'), (b'Expires', b'Thu, 01 Jan 1970 00:00:00 GMT'), (b'Ngrok-Agent-Ips', b'2401:4900:9157:667e:99c1:3a88:6025:b680'), (b'Pragma', b'no-cache'), (b'Server', b'Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.2.4'), (b'X-Powered-By', b'PHP/8.2.4'), (b'Transfer-Encoding', b'chunked')])
2025-12-02 22:47:14,406 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-12-02 22:47:14,461 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-12-02 22:47:14,461 - httpcore.http11 - DEBUG - response_closed.started
2025-12-02 22:47:14,462 - httpcore.http11 - DEBUG - response_closed.complete
2025-12-02 22:47:14,462 - app.services.moodle_client - INFO - Got site info for user: student1
2025-12-02 22:47:14,525 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-02 22:47:14,527 - sqlalchemy.engine.Engine - INFO - INSERT INTO student_sessions (session_id, moodle_user_id, moodle_username, moodle_fullname, encrypted_token, token_expires_at, ip_address, user_agent, expires_at) VALUES ($1::VARCHAR, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::TIMESTAMP WITH TIME ZONE, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITH TIME ZONE) RETURNING student_sessions.id, student_sessions.created_at, student_sessions.last_activity_at
2025-12-02 22:47:14,528 - sqlalchemy.engine.Engine - INFO - [generated in 0.00061s] ('Zg1ktiEWhIQptjS6DpJL1oQaByvJxGx3wuZH2hX6gSs', 3, 'student1', 'student 212223240014', 'Z0FBQUFBQnBMeDhhM1VlZ1pPUzZreXVaRl9fZkZDeUhubGNPdC1mSGtQaFk5Z191aHd3LVJHV1dicFJpR3c2cWNoZTRVdUVfRFhNTzgyU1hJTUlKcU5zQWduZFFVYjl5bllTVUlWVlI3djU2cTQ0WFF3dzZUUk5fYnBydUVTZ1JPWk5GZGpLdzJMN3E=', None, '127.0.0.1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36', datetime.datetime(2025, 12, 2, 18, 17, 14, 463609, tzinfo=datetime.timezone.utc))
2025-12-02 22:47:14,530 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-02 22:47:14,587 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-02 22:47:14,588 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE (examination_artifacts.parsed_reg_no = $1::VARCHAR OR examination_artifacts.moodle_username = $2::VARCHAR) AND examination_artifacts.workflow_status IN ($3::workflowstatus, $4::workflowstatus, $5::workflowstatus, $6::workflowstatus) ORDER BY examination_artifacts.uploaded_at DESC
2025-12-02 22:47:14,588 - sqlalchemy.engine.Engine - INFO - [generated in 0.00055s] ('212223240014', '212223240014', 'PENDING', 'PENDING_REVIEW', 'VALIDATED', 'READY_FOR_REVIEW')
2025-12-02 22:47:14,602 - app.api.routes.auth - INFO - Student student1 (reg: 212223240014) logged in. Pending papers: 1
2025-12-02 22:47:14,602 - httpcore.connection - DEBUG - close.started
2025-12-02 22:47:14,602 - httpcore.connection - DEBUG - close.complete
2025-12-02 22:47:14,603 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-02 22:47:14,669 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-02 22:47:14,671 - sqlalchemy.engine.Engine - INFO - SELECT student_sessions.id, student_sessions.session_id, student_sessions.moodle_user_id, student_sessions.moodle_username, student_sessions.moodle_fullname, student_sessions.encrypted_token, student_sessions.token_expires_at, student_sessions.ip_address, student_sessions.user_agent, student_sessions.created_at, student_sessions.last_activity_at, student_sessions.expires_at 
FROM student_sessions 
WHERE student_sessions.session_id = $1::VARCHAR
2025-12-02 22:47:14,672 - sqlalchemy.engine.Engine - INFO - [generated in 0.00044s] ('Zg1ktiEWhIQptjS6DpJL1oQaByvJxGx3wuZH2hX6gSs',)
2025-12-02 22:47:14,675 - sqlalchemy.engine.Engine - INFO - UPDATE student_sessions SET last_activity_at=$1::TIMESTAMP WITH TIME ZONE WHERE student_sessions.id = $2::INTEGER
2025-12-02 22:47:14,675 - sqlalchemy.engine.Engine - INFO - [generated in 0.00037s] (datetime.datetime(2025, 12, 2, 17, 17, 14, 674005, tzinfo=datetime.timezone.utc), 20)
2025-12-02 22:47:14,676 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-02 22:47:14,745 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-02 22:47:14,746 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE (examination_artifacts.parsed_reg_no = $1::VARCHAR OR examination_artifacts.moodle_username = $2::VARCHAR) AND examination_artifacts.workflow_status IN ($3::workflowstatus, $4::workflowstatus, $5::workflowstatus, $6::workflowstatus) ORDER BY examination_artifacts.uploaded_at DESC
2025-12-02 22:47:14,746 - sqlalchemy.engine.Engine - INFO - [cached since 0.1585s ago] ('212223240014', '212223240014', 'PENDING', 'PENDING_REVIEW', 'VALIDATED', 'READY_FOR_REVIEW')
2025-12-02 22:47:14,759 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE examination_artifacts.parsed_reg_no = $1::VARCHAR AND examination_artifacts.workflow_status IN ($2::workflowstatus, $3::workflowstatus) ORDER BY examination_artifacts.submit_timestamp DESC
2025-12-02 22:47:14,760 - sqlalchemy.engine.Engine - INFO - [generated in 0.00057s] ('212223240014', 'SUBMITTED_TO_LMS', 'COMPLETED')
2025-12-02 22:47:14,761 - sqlalchemy.engine.Engine - INFO - SELECT subject_mappings.id, subject_mappings.subject_code, subject_mappings.subject_name, subject_mappings.moodle_course_id, subject_mappings.moodle_course_idnumber, subject_mappings.moodle_assignment_id, subject_mappings.moodle_assignment_name, subject_mappings.exam_session, subject_mappings.is_active, subject_mappings.created_at, subject_mappings.updated_at, subject_mappings.last_verified_at 
FROM subject_mappings 
WHERE subject_mappings.subject_code = $1::VARCHAR AND subject_mappings.is_active = true
2025-12-02 22:47:14,762 - sqlalchemy.engine.Engine - INFO - [generated in 0.00048s] ('19AI405',)
2025-12-02 22:47:14,763 - sqlalchemy.engine.Engine - INFO - SELECT subject_mappings.id, subject_mappings.subject_code, subject_mappings.subject_name, subject_mappings.moodle_course_id, subject_mappings.moodle_course_idnumber, subject_mappings.moodle_assignment_id, subject_mappings.moodle_assignment_name, subject_mappings.exam_session, subject_mappings.is_active, subject_mappings.created_at, subject_mappings.updated_at, subject_mappings.last_verified_at 
FROM subject_mappings 
WHERE subject_mappings.subject_code = $1::VARCHAR AND subject_mappings.is_active = true
2025-12-02 22:47:14,764 - sqlalchemy.engine.Engine - INFO - [cached since 0.002746s ago] ('19AI405',)
2025-12-02 22:47:14,765 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-02 22:47:14,768 - app.db.database - ERROR - Database session error: [{'type': 'missing', 'loc': ('header', 'X-Session-ID'), 'msg': 'Field required', 'input': None, 'url': 'https://errors.pydantic.dev/2.5/v/missing'}]
2025-12-02 22:47:24,742 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-02 22:47:24,742 - sqlalchemy.engine.Engine - INFO - SELECT student_sessions.id, student_sessions.session_id, student_sessions.moodle_user_id, student_sessions.moodle_username, student_sessions.moodle_fullname, student_sessions.encrypted_token, student_sessions.token_expires_at, student_sessions.ip_address, student_sessions.user_agent, student_sessions.created_at, student_sessions.last_activity_at, student_sessions.expires_at 
FROM student_sessions 
WHERE student_sessions.session_id = $1::VARCHAR
2025-12-02 22:47:24,744 - sqlalchemy.engine.Engine - INFO - [cached since 10.07s ago] ('Zg1ktiEWhIQptjS6DpJL1oQaByvJxGx3wuZH2hX6gSs',)
2025-12-02 22:47:24,746 - sqlalchemy.engine.Engine - INFO - UPDATE student_sessions SET last_activity_at=$1::TIMESTAMP WITH TIME ZONE WHERE student_sessions.id = $2::INTEGER
2025-12-02 22:47:24,746 - sqlalchemy.engine.Engine - INFO - [cached since 10.07s ago] (datetime.datetime(2025, 12, 2, 17, 17, 24, 746557, tzinfo=datetime.timezone.utc), 20)
2025-12-02 22:47:24,747 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-02 22:47:24,805 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-02 22:47:24,806 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE examination_artifacts.artifact_uuid = $1::UUID
2025-12-02 22:47:24,806 - sqlalchemy.engine.Engine - INFO - [generated in 0.00049s] ('0ff3069a-b578-404c-ac60-95451bc7f55c',)
2025-12-02 22:47:24,818 - sqlalchemy.engine.Engine - INFO - SELECT subject_mappings.id, subject_mappings.subject_code, subject_mappings.subject_name, subject_mappings.moodle_course_id, subject_mappings.moodle_course_idnumber, subject_mappings.moodle_assignment_id, subject_mappings.moodle_assignment_name, subject_mappings.exam_session, subject_mappings.is_active, subject_mappings.created_at, subject_mappings.updated_at, subject_mappings.last_verified_at 
FROM subject_mappings 
WHERE subject_mappings.subject_code = $1::VARCHAR AND subject_mappings.is_active = true
2025-12-02 22:47:24,819 - sqlalchemy.engine.Engine - INFO - [cached since 10.06s ago] ('19AI405',)
2025-12-02 22:47:24,823 - sqlalchemy.engine.Engine - INFO - UPDATE examination_artifacts SET moodle_user_id=$1::BIGINT, moodle_username=$2::VARCHAR, moodle_assignment_id=$3::INTEGER WHERE examination_artifacts.id = $4::INTEGER
2025-12-02 22:47:24,823 - sqlalchemy.engine.Engine - INFO - [generated in 0.00050s] (3, 'student1', 2, 18)
2025-12-02 22:47:24,824 - sqlalchemy.engine.Engine - INFO - INSERT INTO audit_logs (action, action_category, description, actor_type, actor_id, actor_username, actor_ip, artifact_id, target_type, target_id, request_data, response_data, moodle_api_function, moodle_response_code) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::INTEGER, $9::VARCHAR, $10::VARCHAR, $11::JSONB, $12::JSONB, $13::VARCHAR, $14::INTEGER) RETURNING audit_logs.id, audit_logs.created_at
2025-12-02 22:47:24,824 - sqlalchemy.engine.Engine - INFO - [cached since 20.91s ago] ('submission_started', 'submit', 'Starting submission for assignment 2', 'student', '3', 'student1', '127.0.0.1', 18, None, None, 'null', 'null', None, None)
2025-12-02 22:47:24,827 - app.services.submission_service - INFO - Step 1/3: Uploading file to draft area
2025-12-02 22:47:24,828 - sqlalchemy.engine.Engine - INFO - UPDATE examination_artifacts SET workflow_status=$1::workflowstatus WHERE examination_artifacts.id = $2::INTEGER
2025-12-02 22:47:24,828 - sqlalchemy.engine.Engine - INFO - [generated in 0.00028s] ('UPLOADING', 18)
2025-12-02 22:47:25,087 - app.services.moodle_client - INFO - Uploading file: 212223240014_19AI405.jpg (901372 bytes)
2025-12-02 22:47:25,087 - httpcore.connection - DEBUG - connect_tcp.started host='1844fdb23815.ngrok-free.app' port=443 local_address=None timeout=30.0 socket_options=None
2025-12-02 22:47:25,145 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001C7513A0F50>
2025-12-02 22:47:25,146 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000001C7512EB020> server_hostname='1844fdb23815.ngrok-free.app' timeout=30.0
2025-12-02 22:47:25,233 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001C75115E390>
2025-12-02 22:47:25,233 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-12-02 22:47:25,234 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-12-02 22:47:25,234 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-12-02 22:47:27,065 - httpcore.http11 - DEBUG - send_request_body.complete
2025-12-02 22:47:27,066 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-12-02 22:47:38,570 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Accept-Ranges', b'none'), (b'Access-Control-Allow-Origin', b'*'), (b'Cache-Control', b'no-store, no-cache, must-revalidate'), (b'Cache-Control', b'post-check=0, pre-check=0'), (b'Content-Length', b'294'), (b'Content-Type', b'text/plain; charset=utf-8'), (b'Date', b'Tue, 02 Dec 2025 17:17:25 GMT'), (b'Expires', b'Mon, 20 Aug 1969 09:23:00 GMT'), (b'Last-Modified', b'Tue, 02 Dec 2025 17:17:38 GMT'), (b'Ngrok-Agent-Ips', b'2401:4900:9157:667e:99c1:3a88:6025:b680'), (b'Pragma', b'no-cache'), (b'Server', b'Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.2.4'), (b'X-Powered-By', b'PHP/8.2.4')])
2025-12-02 22:47:38,570 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-12-02 22:47:38,570 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-12-02 22:47:38,570 - httpcore.http11 - DEBUG - response_closed.started
2025-12-02 22:47:38,570 - httpcore.http11 - DEBUG - response_closed.complete
2025-12-02 22:47:38,571 - app.services.moodle_client - INFO - Upload response: [{'component': 'user', 'contextid': 17, 'userid': '3', 'filearea': 'draft', 'filename': '212223240014_19AI405.jpg', 'filepath': '/', 'itemid': 394725041, 'license': 'unknown', 'author': 'student 212223240014', 'source': 'O:8:"stdClass":1:{s:6:"source";s:24:"212223240014_19AI405.jpg";}', 'filesize': 901372}]
2025-12-02 22:47:38,571 - app.services.moodle_client - INFO - File uploaded successfully. Item ID: 394725041
2025-12-02 22:47:38,571 - sqlalchemy.engine.Engine - INFO - UPDATE examination_artifacts SET moodle_draft_item_id=$1::BIGINT WHERE examination_artifacts.id = $2::INTEGER
2025-12-02 22:47:38,571 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] (394725041, 18)
2025-12-02 22:47:38,573 - app.services.submission_service - INFO - Verifying assignment 2 exists and is accessible...
2025-12-02 22:47:38,574 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-12-02 22:47:38,574 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-12-02 22:47:38,574 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-12-02 22:47:38,574 - httpcore.http11 - DEBUG - send_request_body.complete
2025-12-02 22:47:38,574 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-12-02 22:47:38,799 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Accept-Ranges', b'none'), (b'Access-Control-Allow-Origin', b'*'), (b'Cache-Control', b'private, must-revalidate, pre-check=0, post-check=0, max-age=0'), (b'Content-Length', b'662'), (b'Content-Type', b'application/json'), (b'Date', b'Tue, 02 Dec 2025 17:17:38 GMT'), (b'Expires', b'Thu, 01 Jan 1970 00:00:00 GMT'), (b'Ngrok-Agent-Ips', b'2401:4900:9157:667e:99c1:3a88:6025:b680'), (b'Pragma', b'no-cache'), (b'Server', b'Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.2.4'), (b'X-Powered-By', b'PHP/8.2.4')])
2025-12-02 22:47:38,799 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-12-02 22:47:38,800 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-12-02 22:47:38,800 - httpcore.http11 - DEBUG - response_closed.started
2025-12-02 22:47:38,800 - httpcore.http11 - DEBUG - response_closed.complete
2025-12-02 22:47:38,801 - app.services.submission_service - INFO - Assignment 2 verified and accessible
2025-12-02 22:47:38,801 - app.services.submission_service - INFO - Step 2/3: Linking draft to assignment
2025-12-02 22:47:38,802 - sqlalchemy.engine.Engine - INFO - UPDATE examination_artifacts SET workflow_status=$1::workflowstatus WHERE examination_artifacts.id = $2::INTEGER
2025-12-02 22:47:38,802 - sqlalchemy.engine.Engine - INFO - [cached since 13.98s ago] ('SUBMITTING', 18)
2025-12-02 22:47:38,803 - app.services.moodle_client - INFO - Saving submission for assignment 2 with item 394725041
2025-12-02 22:47:38,804 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-12-02 22:47:38,804 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-12-02 22:47:38,804 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-12-02 22:47:38,805 - httpcore.http11 - DEBUG - send_request_body.complete
2025-12-02 22:47:38,805 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-12-02 22:47:39,114 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Accept-Ranges', b'none'), (b'Access-Control-Allow-Origin', b'*'), (b'Cache-Control', b'private, must-revalidate, pre-check=0, post-check=0, max-age=0'), (b'Content-Length', b'2'), (b'Content-Type', b'application/json'), (b'Date', b'Tue, 02 Dec 2025 17:17:38 GMT'), (b'Expires', b'Thu, 01 Jan 1970 00:00:00 GMT'), (b'Ngrok-Agent-Ips', b'2401:4900:9157:667e:99c1:3a88:6025:b680'), (b'Pragma', b'no-cache'), (b'Server', b'Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.2.4'), (b'X-Powered-By', b'PHP/8.2.4')])
2025-12-02 22:47:39,115 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-12-02 22:47:39,116 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-12-02 22:47:39,117 - httpcore.http11 - DEBUG - response_closed.started
2025-12-02 22:47:39,117 - httpcore.http11 - DEBUG - response_closed.complete
2025-12-02 22:47:39,118 - app.services.moodle_client - INFO - mod_assign_save_submission response: []
2025-12-02 22:47:39,119 - app.services.moodle_client - INFO - Submission saved successfully for assignment 2
2025-12-02 22:47:39,119 - app.services.submission_service - INFO - Verifying submission status after save...
2025-12-02 22:47:39,120 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-12-02 22:47:39,121 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-12-02 22:47:39,121 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-12-02 22:47:39,122 - httpcore.http11 - DEBUG - send_request_body.complete
2025-12-02 22:47:39,122 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-12-02 22:47:39,278 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Accept-Ranges', b'none'), (b'Access-Control-Allow-Origin', b'*'), (b'Cache-Control', b'private, must-revalidate, pre-check=0, post-check=0, max-age=0'), (b'Content-Length', b'986'), (b'Content-Type', b'application/json'), (b'Date', b'Tue, 02 Dec 2025 17:17:39 GMT'), (b'Expires', b'Thu, 01 Jan 1970 00:00:00 GMT'), (b'Ngrok-Agent-Ips', b'2401:4900:9157:667e:99c1:3a88:6025:b680'), (b'Pragma', b'no-cache'), (b'Server', b'Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.2.4'), (b'X-Powered-By', b'PHP/8.2.4')])
2025-12-02 22:47:39,279 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-12-02 22:47:39,279 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-12-02 22:47:39,279 - httpcore.http11 - DEBUG - response_closed.started
2025-12-02 22:47:39,279 - httpcore.http11 - DEBUG - response_closed.complete
2025-12-02 22:47:39,279 - app.services.submission_service - INFO - Full submission status response: {'lastattempt': {'submission': {'id': 9, 'userid': 3, 'attemptnumber': 0, 'timecreated': 1764694261, 'timemodified': 1764695858, 'timestarted': None, 'status': 'submitted', 'groupid': 0, 'assignment': 2, 'latest': 1, 'plugins': [{'type': 'file', 'name': 'File submissions', 'fileareas': [{'area': 'submission_files', 'files': [{'filename': '212223240014_19AI405.jpg', 'filepath': '/', 'filesize': 1268488, 'fileurl': 'https://1844fdb23815.ngrok-free.app/webservice/pluginfile.php/26/assignsubmission_file/submission_files/9/212223240014_19AI405.jpg', 'timemodified': 1764695858, 'mimetype': 'image/jpeg', 'isexternalfile': False, 'icon': 'f/image'}]}]}, {'type': 'comments', 'name': 'Submission comments'}]}, 'submissiongroupmemberswhoneedtosubmit': [], 'submissionsenabled': True, 'locked': False, 'graded': False, 'canedit': True, 'caneditowner': True, 'cansubmit': False, 'extensionduedate': None, 'timelimit': 0, 'blindmarking': False, 'gradingstatus': 'notgraded', 'usergroups': []}, 'assignmentdata': {'attachments': {'intro': []}}, 'warnings': []}
2025-12-02 22:47:39,279 - app.services.submission_service - INFO - Submission status: submitted
2025-12-02 22:47:39,280 - app.services.submission_service - INFO - Submission ID: 9
2025-12-02 22:47:39,280 - app.services.submission_service - INFO - Submission timecreated: 1764694261
2025-12-02 22:47:39,280 - app.services.submission_service - INFO - Submission timemodified: 1764695858
2025-12-02 22:47:39,280 - app.services.submission_service - INFO - Grading status: notgraded
2025-12-02 22:47:39,280 - app.services.submission_service - INFO - Submissions enabled: True
2025-12-02 22:47:39,280 - app.services.submission_service - INFO - Can edit: True
2025-12-02 22:47:39,280 - app.services.submission_service - INFO - Can submit: False
2025-12-02 22:47:39,280 - app.services.submission_service - INFO - Submission verification - Files found: 1
2025-12-02 22:47:39,280 - app.services.submission_service - INFO - Verified files: ['212223240014_19AI405.jpg']
2025-12-02 22:47:39,280 - app.services.submission_service - INFO - Skipping explicit submit_for_grading call because Moodle reports cansubmit=False. Treating current 'submitted' state as final.
2025-12-02 22:47:39,281 - httpcore.connection - DEBUG - close.started
2025-12-02 22:47:39,281 - httpcore.connection - DEBUG - close.complete
2025-12-02 22:47:39,281 - app.services.submission_service - INFO - Submission result: {'assignment_id': 2, 'steps_completed': ['upload', 'save'], 'item_id': 394725041, 'save_result': {'success': True, 'warnings': []}, 'submission_status': 'submitted', 'submission_id': '9', 'verified_files': ['212223240014_19AI405.jpg'], 'submit_skipped': True, 'success': True, 'transaction_id': 'TXN_0ff3069a-b578-404c-ac60-95451bc7f55c_20251202171739'}
2025-12-02 22:47:39,281 - app.services.submission_service - INFO - Steps completed: ['upload', 'save']
2025-12-02 22:47:39,282 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE examination_artifacts.id = $1::INTEGER
2025-12-02 22:47:39,282 - sqlalchemy.engine.Engine - INFO - [generated in 0.00047s] (18,)
2025-12-02 22:47:39,285 - sqlalchemy.engine.Engine - INFO - UPDATE examination_artifacts SET workflow_status=$1::workflowstatus, moodle_submission_id=$2::VARCHAR, lms_transaction_id=$3::VARCHAR, submit_timestamp=$4::TIMESTAMP WITH TIME ZONE, completed_at=$5::TIMESTAMP WITH TIME ZONE WHERE examination_artifacts.id = $6::INTEGER
2025-12-02 22:47:39,285 - sqlalchemy.engine.Engine - INFO - [generated in 0.00028s] ('COMPLETED', '9', 'TXN_0ff3069a-b578-404c-ac60-95451bc7f55c_20251202171739', datetime.datetime(2025, 12, 2, 17, 17, 39, 284552), datetime.datetime(2025, 12, 2, 17, 17, 39, 284552), 18)
2025-12-02 22:47:39,287 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE examination_artifacts.id = $1::INTEGER
2025-12-02 22:47:39,287 - sqlalchemy.engine.Engine - INFO - [cached since 35.38s ago] (18,)
2025-12-02 22:47:39,288 - app.services.artifact_service - INFO - Artifact 18 marked as submitted
2025-12-02 22:47:39,289 - sqlalchemy.engine.Engine - INFO - INSERT INTO audit_logs (action, action_category, description, actor_type, actor_id, actor_username, actor_ip, artifact_id, target_type, target_id, request_data, response_data, moodle_api_function, moodle_response_code) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::INTEGER, $9::VARCHAR, $10::VARCHAR, $11::JSONB, $12::JSONB, $13::VARCHAR, $14::INTEGER) RETURNING audit_logs.id, audit_logs.created_at
2025-12-02 22:47:39,289 - sqlalchemy.engine.Engine - INFO - [cached since 35.38s ago] ('submission_completed', 'submit', 'Submission completed successfully', 'student', '3', 'student1', '127.0.0.1', 18, None, None, 'null', '{"assignment_id": 2, "steps_completed": ["upload", "save"], "item_id": 394725041, "save_result": {"success": true, "warnings": []}, "submission_statu ... (55 characters truncated) ... : ["212223240014_19AI405.jpg"], "submit_skipped": true, "success": true, "transaction_id": "TXN_0ff3069a-b578-404c-ac60-95451bc7f55c_20251202171739"}', None, None)
2025-12-02 22:47:39,290 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-02 22:47:39,450 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-02 22:47:39,451 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE examination_artifacts.artifact_uuid = $1::UUID
2025-12-02 22:47:39,451 - sqlalchemy.engine.Engine - INFO - [cached since 14.65s ago] ('0ff3069a-b578-404c-ac60-95451bc7f55c',)
2025-12-02 22:47:39,465 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-02 22:47:39,618 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-02 22:47:39,618 - sqlalchemy.engine.Engine - INFO - SELECT student_sessions.id, student_sessions.session_id, student_sessions.moodle_user_id, student_sessions.moodle_username, student_sessions.moodle_fullname, student_sessions.encrypted_token, student_sessions.token_expires_at, student_sessions.ip_address, student_sessions.user_agent, student_sessions.created_at, student_sessions.last_activity_at, student_sessions.expires_at 
FROM student_sessions 
WHERE student_sessions.session_id = $1::VARCHAR
2025-12-02 22:47:39,618 - sqlalchemy.engine.Engine - INFO - [cached since 24.95s ago] ('Zg1ktiEWhIQptjS6DpJL1oQaByvJxGx3wuZH2hX6gSs',)
2025-12-02 22:47:39,621 - sqlalchemy.engine.Engine - INFO - UPDATE student_sessions SET last_activity_at=$1::TIMESTAMP WITH TIME ZONE WHERE student_sessions.id = $2::INTEGER
2025-12-02 22:47:39,622 - sqlalchemy.engine.Engine - INFO - [cached since 24.95s ago] (datetime.datetime(2025, 12, 2, 17, 17, 39, 621467, tzinfo=datetime.timezone.utc), 20)
2025-12-02 22:47:39,623 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-02 22:47:39,835 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-02 22:47:39,836 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE (examination_artifacts.parsed_reg_no = $1::VARCHAR OR examination_artifacts.moodle_username = $2::VARCHAR) AND examination_artifacts.workflow_status IN ($3::workflowstatus, $4::workflowstatus, $5::workflowstatus, $6::workflowstatus) ORDER BY examination_artifacts.uploaded_at DESC
2025-12-02 22:47:39,837 - sqlalchemy.engine.Engine - INFO - [cached since 25.25s ago] ('212223240014', '212223240014', 'PENDING', 'PENDING_REVIEW', 'VALIDATED', 'READY_FOR_REVIEW')
2025-12-02 22:47:39,859 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE examination_artifacts.parsed_reg_no = $1::VARCHAR AND examination_artifacts.workflow_status IN ($2::workflowstatus, $3::workflowstatus) ORDER BY examination_artifacts.submit_timestamp DESC
2025-12-02 22:47:39,860 - sqlalchemy.engine.Engine - INFO - [cached since 25.1s ago] ('212223240014', 'SUBMITTED_TO_LMS', 'COMPLETED')
2025-12-02 22:47:39,862 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-02 22:47:39,866 - app.db.database - ERROR - Database session error: [{'type': 'missing', 'loc': ('header', 'X-Session-ID'), 'msg': 'Field required', 'input': None, 'url': 'https://errors.pydantic.dev/2.5/v/missing'}]
2025-12-02 22:51:43,043 - app.main - INFO - Shutting down Examination Middleware...
2025-12-02 22:51:43,043 - app.main - INFO - Database connections closed
2025-12-23 13:14:16,265 - app.main - INFO - Starting Examination Middleware...
2025-12-23 13:14:16,326 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-12-23 13:14:16,326 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-23 13:14:16,329 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-12-23 13:14:16,330 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-23 13:14:16,331 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-12-23 13:14:16,331 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-23 13:14:16,332 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-23 13:14:16,334 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-12-23 13:14:16,335 - sqlalchemy.engine.Engine - INFO - [generated in 0.00039s] ('examination_artifacts', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-12-23 13:14:16,348 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-12-23 13:14:16,348 - sqlalchemy.engine.Engine - INFO - [cached since 0.01375s ago] ('subject_mappings', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-12-23 13:14:16,348 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-12-23 13:14:16,349 - sqlalchemy.engine.Engine - INFO - [cached since 0.015s ago] ('staff_users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-12-23 13:14:16,349 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-12-23 13:14:16,350 - sqlalchemy.engine.Engine - INFO - [cached since 0.01594s ago] ('student_sessions', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-12-23 13:14:16,350 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-12-23 13:14:16,351 - sqlalchemy.engine.Engine - INFO - [cached since 0.01709s ago] ('audit_logs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-12-23 13:14:16,352 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-12-23 13:14:16,352 - sqlalchemy.engine.Engine - INFO - [cached since 0.01817s ago] ('submission_queue', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-12-23 13:14:16,352 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2025-12-23 13:14:16,353 - sqlalchemy.engine.Engine - INFO - [cached since 0.01919s ago] ('system_config', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2025-12-23 13:14:16,355 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2025-12-23 13:14:16,355 - sqlalchemy.engine.Engine - INFO - [generated in 0.00053s] ('workflowstatus', 'pg_catalog')
2025-12-23 13:14:16,358 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-23 13:14:16,361 - app.main - INFO - Database tables created/verified
2025-12-23 13:14:16,361 - app.main - INFO - Upload directory: D:\LMS-SAE\exam_middleware\uploads
2025-12-23 13:14:16,361 - app.main - INFO - Storage directory: D:\LMS-SAE\exam_middleware\storage
2025-12-23 13:14:16,362 - app.main - INFO - Examination Middleware started successfully
2025-12-23 13:14:53,921 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-23 13:14:53,928 - sqlalchemy.engine.Engine - INFO - SELECT student_sessions.id, student_sessions.session_id, student_sessions.moodle_user_id, student_sessions.moodle_username, student_sessions.moodle_fullname, student_sessions.encrypted_token, student_sessions.token_expires_at, student_sessions.ip_address, student_sessions.user_agent, student_sessions.created_at, student_sessions.last_activity_at, student_sessions.expires_at 
FROM student_sessions 
WHERE student_sessions.session_id = $1::VARCHAR
2025-12-23 13:14:53,929 - sqlalchemy.engine.Engine - INFO - [generated in 0.00077s] ('0Crl-CJP2owmc09tGRPCkfIAKbRBsIC0cWe0KWbDVXk',)
2025-12-23 13:14:53,941 - sqlalchemy.engine.Engine - INFO - DELETE FROM student_sessions WHERE student_sessions.id = $1::INTEGER
2025-12-23 13:14:53,941 - sqlalchemy.engine.Engine - INFO - [generated in 0.00066s] (22,)
2025-12-23 13:14:53,942 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-23 13:14:53,945 - app.db.database - ERROR - Database session error: 
2025-12-23 13:15:24,281 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-12-23 13:15:24,282 - multipart.multipart - DEBUG - Calling on_header_field with data[42:61]
2025-12-23 13:15:24,283 - multipart.multipart - DEBUG - Calling on_header_value with data[63:123]
2025-12-23 13:15:24,283 - multipart.multipart - DEBUG - Calling on_header_end with no data
2025-12-23 13:15:24,283 - multipart.multipart - DEBUG - Calling on_header_field with data[125:137]
2025-12-23 13:15:24,283 - multipart.multipart - DEBUG - Calling on_header_value with data[139:149]
2025-12-23 13:15:24,284 - multipart.multipart - DEBUG - Calling on_header_end with no data
2025-12-23 13:15:24,284 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-12-23 13:15:24,284 - multipart.multipart - DEBUG - Calling on_part_data with data[153:32768]
2025-12-23 13:15:24,284 - multipart.multipart - DEBUG - Calling on_part_data with data[0:12340]
2025-12-23 13:15:24,286 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:15:24,286 - multipart.multipart - DEBUG - Calling on_part_data with data[12341:32768]
2025-12-23 13:15:24,293 - multipart.multipart - DEBUG - Calling on_part_data with data[0:16384]
2025-12-23 13:15:24,293 - multipart.multipart - DEBUG - Calling on_part_data with data[0:16384]
2025-12-23 13:15:24,293 - multipart.multipart - DEBUG - Calling on_part_data with data[0:16384]
2025-12-23 13:15:24,294 - multipart.multipart - DEBUG - Calling on_part_data with data[0:8597]
2025-12-23 13:15:24,294 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:15:24,294 - multipart.multipart - DEBUG - Calling on_part_data with data[8598:32768]
2025-12-23 13:15:24,295 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1557]
2025-12-23 13:15:24,295 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:15:24,295 - multipart.multipart - DEBUG - Calling on_part_data with data[1558:32768]
2025-12-23 13:15:24,295 - multipart.multipart - DEBUG - Calling on_part_data with data[0:32768]
2025-12-23 13:15:24,296 - multipart.multipart - DEBUG - Calling on_part_data with data[0:14193]
2025-12-23 13:15:24,296 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:15:24,296 - multipart.multipart - DEBUG - Calling on_part_data with data[14194:32768]
2025-12-23 13:15:24,296 - multipart.multipart - DEBUG - Calling on_part_data with data[0:21089]
2025-12-23 13:15:24,296 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:15:24,296 - multipart.multipart - DEBUG - Calling on_part_data with data[21090:32768]
2025-12-23 13:15:24,298 - multipart.multipart - DEBUG - Calling on_part_data with data[0:49152]
2025-12-23 13:15:24,298 - multipart.multipart - DEBUG - Calling on_part_data with data[0:4213]
2025-12-23 13:15:24,298 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:15:24,298 - multipart.multipart - DEBUG - Calling on_part_data with data[4214:30072]
2025-12-23 13:15:24,298 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:15:24,298 - multipart.multipart - DEBUG - Calling on_part_data with data[30073:32768]
2025-12-23 13:15:24,298 - multipart.multipart - DEBUG - Calling on_part_data with data[0:65536]
2025-12-23 13:15:24,299 - multipart.multipart - DEBUG - Calling on_part_data with data[0:32764]
2025-12-23 13:15:24,299 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:15:24,299 - multipart.multipart - DEBUG - Calling on_part_data with data[32765:32768]
2025-12-23 13:15:24,299 - multipart.multipart - DEBUG - Calling on_part_data with data[0:12260]
2025-12-23 13:15:24,299 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:15:24,299 - multipart.multipart - DEBUG - Calling on_part_data with data[12261:16384]
2025-12-23 13:15:24,300 - multipart.multipart - DEBUG - Calling on_part_data with data[0:32768]
2025-12-23 13:15:24,300 - multipart.multipart - DEBUG - Calling on_part_data with data[0:16384]
2025-12-23 13:15:24,300 - multipart.multipart - DEBUG - Calling on_part_data with data[0:32768]
2025-12-23 13:15:24,301 - multipart.multipart - DEBUG - Calling on_part_data with data[0:16384]
2025-12-23 13:15:24,301 - multipart.multipart - DEBUG - Calling on_part_data with data[0:6024]
2025-12-23 13:15:24,301 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:15:24,301 - multipart.multipart - DEBUG - Calling on_part_data with data[6025:16384]
2025-12-23 13:15:24,301 - multipart.multipart - DEBUG - Calling on_part_data with data[0:32768]
2025-12-23 13:15:24,301 - multipart.multipart - DEBUG - Calling on_part_data with data[0:29760]
2025-12-23 13:15:24,301 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:15:24,301 - multipart.multipart - DEBUG - Calling on_part_data with data[29761:32768]
2025-12-23 13:15:24,301 - multipart.multipart - DEBUG - Calling on_part_data with data[0:32768]
2025-12-23 13:15:24,303 - multipart.multipart - DEBUG - Calling on_part_data with data[0:9601]
2025-12-23 13:15:24,303 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:15:24,303 - multipart.multipart - DEBUG - Calling on_part_data with data[9602:16384]
2025-12-23 13:15:24,303 - multipart.multipart - DEBUG - Calling on_part_data with data[0:49152]
2025-12-23 13:15:24,303 - multipart.multipart - DEBUG - Calling on_part_data with data[0:16384]
2025-12-23 13:15:24,304 - multipart.multipart - DEBUG - Calling on_part_data with data[0:16384]
2025-12-23 13:15:24,304 - multipart.multipart - DEBUG - Calling on_part_data with data[0:4044]
2025-12-23 13:15:24,304 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:15:24,304 - multipart.multipart - DEBUG - Calling on_part_data with data[4045:17483]
2025-12-23 13:15:24,304 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:15:24,304 - multipart.multipart - DEBUG - Calling on_part_data with data[17484:32768]
2025-12-23 13:15:24,305 - multipart.multipart - DEBUG - Calling on_part_data with data[0:44219]
2025-12-23 13:15:24,305 - multipart.multipart - DEBUG - Calling on_part_end with no data
2025-12-23 13:15:24,305 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-12-23 13:15:24,305 - multipart.multipart - DEBUG - Calling on_header_field with data[44263:44282]
2025-12-23 13:15:24,305 - multipart.multipart - DEBUG - Calling on_header_value with data[44284:44314]
2025-12-23 13:15:24,305 - multipart.multipart - DEBUG - Calling on_header_end with no data
2025-12-23 13:15:24,305 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-12-23 13:15:24,305 - multipart.multipart - DEBUG - Calling on_part_data with data[44318:44326]
2025-12-23 13:15:24,305 - multipart.multipart - DEBUG - Calling on_part_end with no data
2025-12-23 13:15:24,305 - multipart.multipart - DEBUG - Calling on_end with no data
2025-12-23 13:15:24,314 - app.db.database - ERROR - Database session error: 
2025-12-23 13:15:29,325 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-12-23 13:15:29,326 - multipart.multipart - DEBUG - Calling on_header_field with data[42:61]
2025-12-23 13:15:29,326 - multipart.multipart - DEBUG - Calling on_header_value with data[63:123]
2025-12-23 13:15:29,326 - multipart.multipart - DEBUG - Calling on_header_end with no data
2025-12-23 13:15:29,326 - multipart.multipart - DEBUG - Calling on_header_field with data[125:137]
2025-12-23 13:15:29,326 - multipart.multipart - DEBUG - Calling on_header_value with data[139:149]
2025-12-23 13:15:29,326 - multipart.multipart - DEBUG - Calling on_header_end with no data
2025-12-23 13:15:29,326 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-12-23 13:15:29,326 - multipart.multipart - DEBUG - Calling on_part_data with data[153:32768]
2025-12-23 13:15:29,328 - multipart.multipart - DEBUG - Calling on_part_data with data[0:5936]
2025-12-23 13:15:29,328 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:15:29,328 - multipart.multipart - DEBUG - Calling on_part_data with data[5937:54746]
2025-12-23 13:15:29,328 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:15:29,328 - multipart.multipart - DEBUG - Calling on_part_data with data[54747:229376]
2025-12-23 13:15:29,329 - multipart.multipart - DEBUG - Calling on_part_data with data[0:8808]
2025-12-23 13:15:29,329 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:15:29,329 - multipart.multipart - DEBUG - Calling on_part_data with data[8809:138027]
2025-12-23 13:15:29,329 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:15:29,329 - multipart.multipart - DEBUG - Calling on_part_data with data[138028:147927]
2025-12-23 13:15:29,330 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:15:29,330 - multipart.multipart - DEBUG - Calling on_part_data with data[147928:208868]
2025-12-23 13:15:29,330 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:15:29,330 - multipart.multipart - DEBUG - Calling on_part_data with data[208869:229376]
2025-12-23 13:15:29,332 - multipart.multipart - DEBUG - Calling on_part_data with data[0:8849]
2025-12-23 13:15:29,332 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:15:29,332 - multipart.multipart - DEBUG - Calling on_part_data with data[8850:136354]
2025-12-23 13:15:29,332 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:15:29,333 - multipart.multipart - DEBUG - Calling on_part_data with data[136355:206209]
2025-12-23 13:15:29,333 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:15:29,333 - multipart.multipart - DEBUG - Calling on_part_data with data[206210:262144]
2025-12-23 13:15:29,334 - multipart.multipart - DEBUG - Calling on_part_data with data[0:50636]
2025-12-23 13:15:29,334 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:15:29,334 - multipart.multipart - DEBUG - Calling on_part_data with data[50637:86901]
2025-12-23 13:15:29,334 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:15:29,335 - multipart.multipart - DEBUG - Calling on_part_data with data[86902:109755]
2025-12-23 13:15:29,335 - multipart.multipart - DEBUG - Calling on_part_end with no data
2025-12-23 13:15:29,335 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-12-23 13:15:29,335 - multipart.multipart - DEBUG - Calling on_header_field with data[109799:109818]
2025-12-23 13:15:29,335 - multipart.multipart - DEBUG - Calling on_header_value with data[109820:109850]
2025-12-23 13:15:29,336 - multipart.multipart - DEBUG - Calling on_header_end with no data
2025-12-23 13:15:29,336 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-12-23 13:15:29,336 - multipart.multipart - DEBUG - Calling on_part_data with data[109854:109862]
2025-12-23 13:15:29,337 - multipart.multipart - DEBUG - Calling on_part_end with no data
2025-12-23 13:15:29,337 - multipart.multipart - DEBUG - Calling on_end with no data
2025-12-23 13:15:29,337 - app.db.database - ERROR - Database session error: 
2025-12-23 13:15:38,904 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-12-23 13:15:38,904 - multipart.multipart - DEBUG - Calling on_header_field with data[42:61]
2025-12-23 13:15:38,904 - multipart.multipart - DEBUG - Calling on_header_value with data[63:123]
2025-12-23 13:15:38,905 - multipart.multipart - DEBUG - Calling on_header_end with no data
2025-12-23 13:15:38,905 - multipart.multipart - DEBUG - Calling on_header_field with data[125:137]
2025-12-23 13:15:38,905 - multipart.multipart - DEBUG - Calling on_header_value with data[139:149]
2025-12-23 13:15:38,905 - multipart.multipart - DEBUG - Calling on_header_end with no data
2025-12-23 13:15:38,905 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-12-23 13:15:38,905 - multipart.multipart - DEBUG - Calling on_part_data with data[153:254]
2025-12-23 13:15:38,906 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:15:38,906 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:15:38,906 - multipart.multipart - DEBUG - Calling on_part_data with data[256:2417]
2025-12-23 13:15:38,906 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:15:38,906 - multipart.multipart - DEBUG - Calling on_part_data with data[2418:49152]
2025-12-23 13:15:38,906 - multipart.multipart - DEBUG - Calling on_part_data with data[0:98304]
2025-12-23 13:15:38,907 - multipart.multipart - DEBUG - Calling on_part_data with data[0:19423]
2025-12-23 13:15:38,907 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:15:38,907 - multipart.multipart - DEBUG - Calling on_part_data with data[19424:32768]
2025-12-23 13:15:38,907 - multipart.multipart - DEBUG - Calling on_part_data with data[0:49152]
2025-12-23 13:15:38,907 - multipart.multipart - DEBUG - Calling on_part_data with data[0:11838]
2025-12-23 13:15:38,907 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:15:38,907 - multipart.multipart - DEBUG - Calling on_part_data with data[11839:16384]
2025-12-23 13:15:38,908 - multipart.multipart - DEBUG - Calling on_part_data with data[0:49152]
2025-12-23 13:15:38,908 - multipart.multipart - DEBUG - Calling on_part_data with data[0:16384]
2025-12-23 13:15:38,908 - multipart.multipart - DEBUG - Calling on_part_data with data[0:16384]
2025-12-23 13:15:38,908 - multipart.multipart - DEBUG - Calling on_part_data with data[0:16384]
2025-12-23 13:15:38,908 - multipart.multipart - DEBUG - Calling on_part_data with data[0:16384]
2025-12-23 13:15:38,908 - multipart.multipart - DEBUG - Calling on_part_data with data[0:16384]
2025-12-23 13:15:38,910 - multipart.multipart - DEBUG - Calling on_part_data with data[0:16384]
2025-12-23 13:15:38,910 - multipart.multipart - DEBUG - Calling on_part_data with data[0:16384]
2025-12-23 13:15:38,910 - multipart.multipart - DEBUG - Calling on_part_data with data[0:16384]
2025-12-23 13:15:38,910 - multipart.multipart - DEBUG - Calling on_part_data with data[0:12855]
2025-12-23 13:15:38,911 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:15:38,911 - multipart.multipart - DEBUG - Calling on_part_data with data[12856:16384]
2025-12-23 13:15:38,911 - multipart.multipart - DEBUG - Calling on_part_data with data[0:16384]
2025-12-23 13:15:38,911 - multipart.multipart - DEBUG - Calling on_part_data with data[0:32768]
2025-12-23 13:15:38,911 - multipart.multipart - DEBUG - Calling on_part_data with data[0:16384]
2025-12-23 13:15:38,912 - multipart.multipart - DEBUG - Calling on_part_data with data[0:5987]
2025-12-23 13:15:38,912 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:15:38,912 - multipart.multipart - DEBUG - Calling on_part_data with data[5988:16384]
2025-12-23 13:15:38,912 - multipart.multipart - DEBUG - Calling on_part_data with data[0:32768]
2025-12-23 13:15:38,913 - multipart.multipart - DEBUG - Calling on_part_data with data[0:61509]
2025-12-23 13:15:38,913 - multipart.multipart - DEBUG - Calling on_part_end with no data
2025-12-23 13:15:38,913 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-12-23 13:15:38,913 - multipart.multipart - DEBUG - Calling on_header_field with data[61553:61572]
2025-12-23 13:15:38,913 - multipart.multipart - DEBUG - Calling on_header_value with data[61574:61604]
2025-12-23 13:15:38,913 - multipart.multipart - DEBUG - Calling on_header_end with no data
2025-12-23 13:15:38,913 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-12-23 13:15:38,913 - multipart.multipart - DEBUG - Calling on_part_data with data[61608:61616]
2025-12-23 13:15:38,913 - multipart.multipart - DEBUG - Calling on_part_end with no data
2025-12-23 13:15:38,913 - multipart.multipart - DEBUG - Calling on_end with no data
2025-12-23 13:15:38,915 - app.db.database - ERROR - Database session error: 
2025-12-23 13:15:51,389 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-12-23 13:15:51,390 - multipart.multipart - DEBUG - Calling on_header_field with data[42:61]
2025-12-23 13:15:51,391 - multipart.multipart - DEBUG - Calling on_header_value with data[63:89]
2025-12-23 13:15:51,391 - multipart.multipart - DEBUG - Calling on_header_end with no data
2025-12-23 13:15:51,392 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-12-23 13:15:51,392 - multipart.multipart - DEBUG - Calling on_part_data with data[93:98]
2025-12-23 13:15:51,393 - multipart.multipart - DEBUG - Calling on_part_end with no data
2025-12-23 13:15:51,393 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-12-23 13:15:51,394 - multipart.multipart - DEBUG - Calling on_header_field with data[142:161]
2025-12-23 13:15:51,394 - multipart.multipart - DEBUG - Calling on_header_value with data[163:189]
2025-12-23 13:15:51,394 - multipart.multipart - DEBUG - Calling on_header_end with no data
2025-12-23 13:15:51,395 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-12-23 13:15:51,395 - multipart.multipart - DEBUG - Calling on_part_data with data[193:201]
2025-12-23 13:15:51,396 - multipart.multipart - DEBUG - Calling on_part_end with no data
2025-12-23 13:15:51,396 - multipart.multipart - DEBUG - Calling on_end with no data
2025-12-23 13:15:51,485 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-23 13:15:51,487 - sqlalchemy.engine.Engine - INFO - SELECT staff_users.id, staff_users.username, staff_users.email, staff_users.hashed_password, staff_users.full_name, staff_users.role, staff_users.is_active, staff_users.created_at, staff_users.last_login_at 
FROM staff_users 
WHERE staff_users.username = $1::VARCHAR
2025-12-23 13:15:51,487 - sqlalchemy.engine.Engine - INFO - [generated in 0.00072s] ('admin',)
2025-12-23 13:15:51,725 - sqlalchemy.engine.Engine - INFO - UPDATE staff_users SET last_login_at=$1::TIMESTAMP WITH TIME ZONE WHERE staff_users.id = $2::INTEGER
2025-12-23 13:15:51,726 - sqlalchemy.engine.Engine - INFO - [generated in 0.00072s] (datetime.datetime(2025, 12, 23, 7, 45, 51, 724030, tzinfo=datetime.timezone.utc), 1)
2025-12-23 13:15:51,739 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-23 13:16:00,002 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-12-23 13:16:00,002 - multipart.multipart - DEBUG - Calling on_header_field with data[42:61]
2025-12-23 13:16:00,003 - multipart.multipart - DEBUG - Calling on_header_value with data[63:123]
2025-12-23 13:16:00,003 - multipart.multipart - DEBUG - Calling on_header_end with no data
2025-12-23 13:16:00,003 - multipart.multipart - DEBUG - Calling on_header_field with data[125:137]
2025-12-23 13:16:00,003 - multipart.multipart - DEBUG - Calling on_header_value with data[139:149]
2025-12-23 13:16:00,003 - multipart.multipart - DEBUG - Calling on_header_end with no data
2025-12-23 13:16:00,003 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-12-23 13:16:00,003 - multipart.multipart - DEBUG - Calling on_part_data with data[153:46897]
2025-12-23 13:16:00,004 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:16:00,004 - multipart.multipart - DEBUG - Calling on_part_data with data[46898:65536]
2025-12-23 13:16:00,012 - multipart.multipart - DEBUG - Calling on_part_data with data[0:16384]
2025-12-23 13:16:00,012 - multipart.multipart - DEBUG - Calling on_part_data with data[0:16384]
2025-12-23 13:16:00,013 - multipart.multipart - DEBUG - Calling on_part_data with data[0:5684]
2025-12-23 13:16:00,013 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:16:00,013 - multipart.multipart - DEBUG - Calling on_part_data with data[5685:32768]
2025-12-23 13:16:00,014 - multipart.multipart - DEBUG - Calling on_part_data with data[0:32768]
2025-12-23 13:16:00,014 - multipart.multipart - DEBUG - Calling on_part_data with data[0:16384]
2025-12-23 13:16:00,015 - multipart.multipart - DEBUG - Calling on_part_data with data[0:16384]
2025-12-23 13:16:00,015 - multipart.multipart - DEBUG - Calling on_part_data with data[0:11619]
2025-12-23 13:16:00,015 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:16:00,016 - multipart.multipart - DEBUG - Calling on_part_data with data[11620:16384]
2025-12-23 13:16:00,016 - multipart.multipart - DEBUG - Calling on_part_data with data[0:37589]
2025-12-23 13:16:00,016 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:16:00,016 - multipart.multipart - DEBUG - Calling on_part_data with data[37590:81920]
2025-12-23 13:16:00,016 - multipart.multipart - DEBUG - Calling on_part_data with data[0:47559]
2025-12-23 13:16:00,016 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:16:00,016 - multipart.multipart - DEBUG - Calling on_part_data with data[47560:65536]
2025-12-23 13:16:00,016 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1599]
2025-12-23 13:16:00,018 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:16:00,018 - multipart.multipart - DEBUG - Calling on_part_data with data[1600:50475]
2025-12-23 13:16:00,018 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:16:00,018 - multipart.multipart - DEBUG - Calling on_part_data with data[50476:65536]
2025-12-23 13:16:00,018 - multipart.multipart - DEBUG - Calling on_part_data with data[0:81920]
2025-12-23 13:16:00,019 - multipart.multipart - DEBUG - Calling on_part_data with data[0:49152]
2025-12-23 13:16:00,019 - multipart.multipart - DEBUG - Calling on_part_data with data[0:11031]
2025-12-23 13:16:00,019 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:16:00,020 - multipart.multipart - DEBUG - Calling on_part_data with data[11032:16384]
2025-12-23 13:16:00,020 - multipart.multipart - DEBUG - Calling on_part_data with data[0:49143]
2025-12-23 13:16:00,020 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:16:00,020 - multipart.multipart - DEBUG - Calling on_part_data with data[49144:49152]
2025-12-23 13:16:00,020 - multipart.multipart - DEBUG - Calling on_part_data with data[0:32768]
2025-12-23 13:16:00,021 - multipart.multipart - DEBUG - Calling on_part_data with data[0:13142]
2025-12-23 13:16:00,021 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:16:00,021 - multipart.multipart - DEBUG - Calling on_part_data with data[13143:32768]
2025-12-23 13:16:00,021 - multipart.multipart - DEBUG - Calling on_part_data with data[0:4765]
2025-12-23 13:16:00,021 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:16:00,022 - multipart.multipart - DEBUG - Calling on_part_data with data[4766:32768]
2025-12-23 13:16:00,022 - multipart.multipart - DEBUG - Calling on_part_data with data[0:81920]
2025-12-23 13:16:00,022 - multipart.multipart - DEBUG - Calling on_part_data with data[0:16700]
2025-12-23 13:16:00,022 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:16:00,023 - multipart.multipart - DEBUG - Calling on_part_data with data[16701:55535]
2025-12-23 13:16:00,023 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:16:00,023 - multipart.multipart - DEBUG - Calling on_part_data with data[55536:85871]
2025-12-23 13:16:00,023 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2025-12-23 13:16:00,023 - multipart.multipart - DEBUG - Calling on_part_data with data[85872:98709]
2025-12-23 13:16:00,023 - multipart.multipart - DEBUG - Calling on_part_end with no data
2025-12-23 13:16:00,023 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-12-23 13:16:00,023 - multipart.multipart - DEBUG - Calling on_header_field with data[98753:98772]
2025-12-23 13:16:00,023 - multipart.multipart - DEBUG - Calling on_header_value with data[98774:98804]
2025-12-23 13:16:00,023 - multipart.multipart - DEBUG - Calling on_header_end with no data
2025-12-23 13:16:00,023 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-12-23 13:16:00,023 - multipart.multipart - DEBUG - Calling on_part_data with data[98808:98816]
2025-12-23 13:16:00,023 - multipart.multipart - DEBUG - Calling on_part_end with no data
2025-12-23 13:16:00,024 - multipart.multipart - DEBUG - Calling on_end with no data
2025-12-23 13:16:00,089 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-23 13:16:00,090 - sqlalchemy.engine.Engine - INFO - SELECT staff_users.id, staff_users.username, staff_users.email, staff_users.hashed_password, staff_users.full_name, staff_users.role, staff_users.is_active, staff_users.created_at, staff_users.last_login_at 
FROM staff_users 
WHERE staff_users.id = $1::INTEGER
2025-12-23 13:16:00,091 - sqlalchemy.engine.Engine - INFO - [generated in 0.00078s] (1,)
2025-12-23 13:16:00,096 - app.services.file_processor - INFO - Parsed filename (strict): 212223240169, 19AI405
2025-12-23 13:16:00,100 - app.services.file_processor - INFO - Saved file: ./uploads\pending\6319af54aec14c0ea55fdcca0601b72a.jpg (hash: 3a00d46e79102899...)
2025-12-23 13:16:00,102 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE examination_artifacts.transaction_id = $1::VARCHAR
2025-12-23 13:16:00,103 - sqlalchemy.engine.Engine - INFO - [generated in 0.00063s] ('6363709433549754e2ca1e8b2598b80e',)
2025-12-23 13:16:00,133 - app.services.artifact_service - WARNING - Duplicate artifact detected: 6363709433549754e2ca1e8b2598b80e
2025-12-23 13:16:00,135 - sqlalchemy.engine.Engine - INFO - INSERT INTO audit_logs (action, action_category, description, actor_type, actor_id, actor_username, actor_ip, artifact_id, target_type, target_id, request_data, response_data, moodle_api_function, moodle_response_code) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::INTEGER, $9::VARCHAR, $10::VARCHAR, $11::JSONB, $12::JSONB, $13::VARCHAR, $14::INTEGER) RETURNING audit_logs.id, audit_logs.created_at
2025-12-23 13:16:00,136 - sqlalchemy.engine.Engine - INFO - [generated in 0.00091s] ('bulk_upload', 'upload', 'Bulk upload: 1 successful, 0 failed', 'staff', '1', 'admin', '127.0.0.1', None, None, None, '{"total": 1, "successful": 1, "failed": 0}', 'null', None, None)
2025-12-23 13:16:00,142 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-23 13:16:27,271 - app.api.routes.auth - INFO - Authenticating student: student1
2025-12-23 13:16:27,574 - app.services.moodle_client - INFO - Authenticating user: student1
2025-12-23 13:16:27,575 - httpcore.connection - DEBUG - connect_tcp.started host='1844fdb23815.ngrok-free.app' port=443 local_address=None timeout=30.0 socket_options=None
2025-12-23 13:16:27,628 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000002AB0E32AFD0>
2025-12-23 13:16:27,628 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000002AB0E45B800> server_hostname='1844fdb23815.ngrok-free.app' timeout=30.0
2025-12-23 13:16:27,672 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000002AB0E42EC50>
2025-12-23 13:16:27,673 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-12-23 13:16:27,673 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-12-23 13:16:27,673 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-12-23 13:16:27,673 - httpcore.http11 - DEBUG - send_request_body.complete
2025-12-23 13:16:27,673 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-12-23 13:16:27,708 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 404, b'Not Found', [(b'Connection', b'close'), (b'Content-Type', b'text/plain'), (b'Ngrok-Error-Code', b'ERR_NGROK_3200'), (b'Date', b'Tue, 23 Dec 2025 07:46:27 GMT'), (b'Content-Length', b'72')])
2025-12-23 13:16:27,709 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-12-23 13:16:27,709 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-12-23 13:16:27,709 - httpcore.http11 - DEBUG - response_closed.started
2025-12-23 13:16:27,709 - httpcore.http11 - DEBUG - response_closed.complete
2025-12-23 13:16:27,710 - app.services.moodle_client - ERROR - HTTP error during authentication: Client error '404 Not Found' for url 'https://1844fdb23815.ngrok-free.app/login/token.php'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-12-23 13:16:27,710 - app.api.routes.auth - WARNING - Moodle authentication failed for student1: HTTP error: 404
2025-12-23 13:16:27,710 - app.db.database - ERROR - Database session error: 
2025-12-23 13:16:42,194 - app.api.routes.auth - INFO - Authenticating student: 23004568
2025-12-23 13:16:42,444 - app.services.moodle_client - INFO - Authenticating user: 23004568
2025-12-23 13:16:42,445 - httpcore.connection - DEBUG - connect_tcp.started host='1844fdb23815.ngrok-free.app' port=443 local_address=None timeout=30.0 socket_options=None
2025-12-23 13:16:42,491 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000002AB0E529590>
2025-12-23 13:16:42,492 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000002AB0E4BC5F0> server_hostname='1844fdb23815.ngrok-free.app' timeout=30.0
2025-12-23 13:16:42,530 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000002AB0E5294D0>
2025-12-23 13:16:42,531 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-12-23 13:16:42,532 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-12-23 13:16:42,532 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-12-23 13:16:42,533 - httpcore.http11 - DEBUG - send_request_body.complete
2025-12-23 13:16:42,533 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-12-23 13:16:42,568 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 404, b'Not Found', [(b'Connection', b'close'), (b'Content-Type', b'text/plain'), (b'Ngrok-Error-Code', b'ERR_NGROK_3200'), (b'Date', b'Tue, 23 Dec 2025 07:46:42 GMT'), (b'Content-Length', b'72')])
2025-12-23 13:16:42,569 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-12-23 13:16:42,569 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-12-23 13:16:42,569 - httpcore.http11 - DEBUG - response_closed.started
2025-12-23 13:16:42,570 - httpcore.http11 - DEBUG - response_closed.complete
2025-12-23 13:16:42,570 - app.services.moodle_client - ERROR - HTTP error during authentication: Client error '404 Not Found' for url 'https://1844fdb23815.ngrok-free.app/login/token.php'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-12-23 13:16:42,570 - app.api.routes.auth - WARNING - Moodle authentication failed for 23004568: HTTP error: 404
2025-12-23 13:16:42,570 - app.db.database - ERROR - Database session error: 
2025-12-23 13:16:54,545 - app.api.routes.auth - INFO - Authenticating student: 23004568
2025-12-23 13:16:54,741 - app.services.moodle_client - INFO - Authenticating user: 23004568
2025-12-23 13:16:54,741 - httpcore.connection - DEBUG - connect_tcp.started host='1844fdb23815.ngrok-free.app' port=443 local_address=None timeout=30.0 socket_options=None
2025-12-23 13:16:54,779 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000002AB0E4FF610>
2025-12-23 13:16:54,780 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000002AB0E45B800> server_hostname='1844fdb23815.ngrok-free.app' timeout=30.0
2025-12-23 13:16:54,815 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000002AB0E49D6D0>
2025-12-23 13:16:54,816 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-12-23 13:16:54,816 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-12-23 13:16:54,816 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-12-23 13:16:54,816 - httpcore.http11 - DEBUG - send_request_body.complete
2025-12-23 13:16:54,816 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-12-23 13:16:54,849 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 404, b'Not Found', [(b'Connection', b'close'), (b'Content-Type', b'text/plain'), (b'Ngrok-Error-Code', b'ERR_NGROK_3200'), (b'Date', b'Tue, 23 Dec 2025 07:46:54 GMT'), (b'Content-Length', b'72')])
2025-12-23 13:16:54,849 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-12-23 13:16:54,849 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-12-23 13:16:54,849 - httpcore.http11 - DEBUG - response_closed.started
2025-12-23 13:16:54,849 - httpcore.http11 - DEBUG - response_closed.complete
2025-12-23 13:16:54,850 - app.services.moodle_client - ERROR - HTTP error during authentication: Client error '404 Not Found' for url 'https://1844fdb23815.ngrok-free.app/login/token.php'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2025-12-23 13:16:54,850 - app.api.routes.auth - WARNING - Moodle authentication failed for 23004568: HTTP error: 404
2025-12-23 13:16:54,850 - app.db.database - ERROR - Database session error: 
2025-12-23 20:53:48,009 - app.main - INFO - Shutting down Examination Middleware...
2025-12-23 20:53:48,010 - app.main - INFO - Database connections closed
2026-01-04 00:36:41,794 - app.main - INFO - Starting Examination Middleware...
2026-01-04 00:36:41,846 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2026-01-04 00:36:41,847 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-04 00:36:41,849 - sqlalchemy.engine.Engine - INFO - select current_schema()
2026-01-04 00:36:41,849 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-04 00:36:41,851 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2026-01-04 00:36:41,851 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-04 00:36:41,852 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 00:36:41,854 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:36:41,854 - sqlalchemy.engine.Engine - INFO - [generated in 0.00046s] ('examination_artifacts', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:36:41,859 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:36:41,859 - sqlalchemy.engine.Engine - INFO - [cached since 0.005311s ago] ('subject_mappings', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:36:41,859 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:36:41,860 - sqlalchemy.engine.Engine - INFO - [cached since 0.006057s ago] ('staff_users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:36:41,860 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:36:41,860 - sqlalchemy.engine.Engine - INFO - [cached since 0.006923s ago] ('student_sessions', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:36:41,861 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:36:41,861 - sqlalchemy.engine.Engine - INFO - [cached since 0.007685s ago] ('audit_logs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:36:41,861 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:36:41,863 - sqlalchemy.engine.Engine - INFO - [cached since 0.008691s ago] ('submission_queue', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:36:41,863 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:36:41,864 - sqlalchemy.engine.Engine - INFO - [cached since 0.009613s ago] ('system_config', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:36:41,865 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-01-04 00:36:41,865 - sqlalchemy.engine.Engine - INFO - [generated in 0.00032s] ('workflowstatus', 'pg_catalog')
2026-01-04 00:36:41,866 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 00:36:41,866 - app.main - INFO - Database tables created/verified
2026-01-04 00:36:41,868 - app.main - INFO - Upload directory: D:\LMS-SAE\exam_middleware\uploads
2026-01-04 00:36:41,868 - app.main - INFO - Storage directory: D:\LMS-SAE\exam_middleware\storage
2026-01-04 00:36:41,868 - app.main - INFO - Examination Middleware started successfully
2026-01-04 00:36:53,711 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2026-01-04 00:36:53,711 - multipart.multipart - DEBUG - Calling on_header_field with data[42:61]
2026-01-04 00:36:53,711 - multipart.multipart - DEBUG - Calling on_header_value with data[63:89]
2026-01-04 00:36:53,711 - multipart.multipart - DEBUG - Calling on_header_end with no data
2026-01-04 00:36:53,711 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2026-01-04 00:36:53,711 - multipart.multipart - DEBUG - Calling on_part_data with data[93:98]
2026-01-04 00:36:53,712 - multipart.multipart - DEBUG - Calling on_part_end with no data
2026-01-04 00:36:53,712 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2026-01-04 00:36:53,712 - multipart.multipart - DEBUG - Calling on_header_field with data[142:161]
2026-01-04 00:36:53,712 - multipart.multipart - DEBUG - Calling on_header_value with data[163:189]
2026-01-04 00:36:53,712 - multipart.multipart - DEBUG - Calling on_header_end with no data
2026-01-04 00:36:53,712 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2026-01-04 00:36:53,712 - multipart.multipart - DEBUG - Calling on_part_data with data[193:201]
2026-01-04 00:36:53,712 - multipart.multipart - DEBUG - Calling on_part_end with no data
2026-01-04 00:36:53,712 - multipart.multipart - DEBUG - Calling on_end with no data
2026-01-04 00:36:53,733 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 00:36:53,740 - sqlalchemy.engine.Engine - INFO - SELECT staff_users.id, staff_users.username, staff_users.email, staff_users.hashed_password, staff_users.full_name, staff_users.role, staff_users.is_active, staff_users.created_at, staff_users.last_login_at 
FROM staff_users 
WHERE staff_users.username = $1::VARCHAR
2026-01-04 00:36:53,740 - sqlalchemy.engine.Engine - INFO - [generated in 0.00034s] ('admin',)
2026-01-04 00:36:53,962 - sqlalchemy.engine.Engine - INFO - UPDATE staff_users SET last_login_at=$1::TIMESTAMP WITH TIME ZONE WHERE staff_users.id = $2::INTEGER
2026-01-04 00:36:53,962 - sqlalchemy.engine.Engine - INFO - [generated in 0.00039s] (datetime.datetime(2026, 1, 3, 19, 6, 53, 961476, tzinfo=datetime.timezone.utc), 1)
2026-01-04 00:36:53,966 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 00:37:07,575 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2026-01-04 00:37:07,575 - multipart.multipart - DEBUG - Calling on_header_field with data[42:61]
2026-01-04 00:37:07,575 - multipart.multipart - DEBUG - Calling on_header_value with data[63:123]
2026-01-04 00:37:07,575 - multipart.multipart - DEBUG - Calling on_header_end with no data
2026-01-04 00:37:07,575 - multipart.multipart - DEBUG - Calling on_header_field with data[125:137]
2026-01-04 00:37:07,575 - multipart.multipart - DEBUG - Calling on_header_value with data[139:149]
2026-01-04 00:37:07,575 - multipart.multipart - DEBUG - Calling on_header_end with no data
2026-01-04 00:37:07,576 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2026-01-04 00:37:07,576 - multipart.multipart - DEBUG - Calling on_part_data with data[153:16384]
2026-01-04 00:37:07,576 - multipart.multipart - DEBUG - Calling on_part_data with data[0:5895]
2026-01-04 00:37:07,577 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:37:07,577 - multipart.multipart - DEBUG - Calling on_part_data with data[5896:114688]
2026-01-04 00:37:07,577 - multipart.multipart - DEBUG - Calling on_part_data with data[0:13515]
2026-01-04 00:37:07,577 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:37:07,577 - multipart.multipart - DEBUG - Calling on_part_data with data[13516:65536]
2026-01-04 00:37:07,577 - multipart.multipart - DEBUG - Calling on_part_data with data[0:32768]
2026-01-04 00:37:07,578 - multipart.multipart - DEBUG - Calling on_part_data with data[0:12220]
2026-01-04 00:37:07,578 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:37:07,578 - multipart.multipart - DEBUG - Calling on_part_data with data[12221:16384]
2026-01-04 00:37:07,578 - multipart.multipart - DEBUG - Calling on_part_data with data[0:49152]
2026-01-04 00:37:07,578 - multipart.multipart - DEBUG - Calling on_part_data with data[0:32768]
2026-01-04 00:37:07,580 - multipart.multipart - DEBUG - Calling on_part_data with data[0:16384]
2026-01-04 00:37:07,580 - multipart.multipart - DEBUG - Calling on_part_data with data[0:16384]
2026-01-04 00:37:07,580 - multipart.multipart - DEBUG - Calling on_part_data with data[0:2527]
2026-01-04 00:37:07,580 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:37:07,580 - multipart.multipart - DEBUG - Calling on_part_data with data[2528:16384]
2026-01-04 00:37:07,580 - multipart.multipart - DEBUG - Calling on_part_data with data[0:32768]
2026-01-04 00:37:07,581 - multipart.multipart - DEBUG - Calling on_part_data with data[0:6356]
2026-01-04 00:37:07,582 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:37:07,582 - multipart.multipart - DEBUG - Calling on_part_data with data[6357:7411]
2026-01-04 00:37:07,582 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:37:07,582 - multipart.multipart - DEBUG - Calling on_part_data with data[7412:32768]
2026-01-04 00:37:07,582 - multipart.multipart - DEBUG - Calling on_part_data with data[0:49152]
2026-01-04 00:37:07,582 - multipart.multipart - DEBUG - Calling on_part_data with data[0:16384]
2026-01-04 00:37:07,583 - multipart.multipart - DEBUG - Calling on_part_data with data[0:32768]
2026-01-04 00:37:07,583 - multipart.multipart - DEBUG - Calling on_part_data with data[0:24606]
2026-01-04 00:37:07,583 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:37:07,583 - multipart.multipart - DEBUG - Calling on_part_data with data[24607:32768]
2026-01-04 00:37:07,583 - multipart.multipart - DEBUG - Calling on_part_data with data[0:23602]
2026-01-04 00:37:07,583 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:37:07,585 - multipart.multipart - DEBUG - Calling on_part_data with data[23603:32768]
2026-01-04 00:37:07,585 - multipart.multipart - DEBUG - Calling on_part_data with data[0:32513]
2026-01-04 00:37:07,585 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:37:07,585 - multipart.multipart - DEBUG - Calling on_part_data with data[32514:32768]
2026-01-04 00:37:07,585 - multipart.multipart - DEBUG - Calling on_part_data with data[0:4505]
2026-01-04 00:37:07,586 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:37:07,586 - multipart.multipart - DEBUG - Calling on_part_data with data[4506:46536]
2026-01-04 00:37:07,586 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:37:07,586 - multipart.multipart - DEBUG - Calling on_part_data with data[46537:49152]
2026-01-04 00:37:07,586 - multipart.multipart - DEBUG - Calling on_part_data with data[0:81920]
2026-01-04 00:37:07,588 - multipart.multipart - DEBUG - Calling on_part_data with data[0:15503]
2026-01-04 00:37:07,588 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:37:07,589 - multipart.multipart - DEBUG - Calling on_part_data with data[15504:41991]
2026-01-04 00:37:07,589 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:37:07,589 - multipart.multipart - DEBUG - Calling on_part_data with data[41992:98304]
2026-01-04 00:37:07,590 - multipart.multipart - DEBUG - Calling on_part_data with data[0:27159]
2026-01-04 00:37:07,590 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:37:07,590 - multipart.multipart - DEBUG - Calling on_part_data with data[27160:33173]
2026-01-04 00:37:07,590 - multipart.multipart - DEBUG - Calling on_part_end with no data
2026-01-04 00:37:07,590 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2026-01-04 00:37:07,590 - multipart.multipart - DEBUG - Calling on_header_field with data[33217:33236]
2026-01-04 00:37:07,590 - multipart.multipart - DEBUG - Calling on_header_value with data[33238:33268]
2026-01-04 00:37:07,590 - multipart.multipart - DEBUG - Calling on_header_end with no data
2026-01-04 00:37:07,592 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2026-01-04 00:37:07,592 - multipart.multipart - DEBUG - Calling on_part_data with data[33272:33280]
2026-01-04 00:37:07,592 - multipart.multipart - DEBUG - Calling on_part_end with no data
2026-01-04 00:37:07,592 - multipart.multipart - DEBUG - Calling on_end with no data
2026-01-04 00:37:07,593 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 00:37:07,593 - sqlalchemy.engine.Engine - INFO - SELECT staff_users.id, staff_users.username, staff_users.email, staff_users.hashed_password, staff_users.full_name, staff_users.role, staff_users.is_active, staff_users.created_at, staff_users.last_login_at 
FROM staff_users 
WHERE staff_users.id = $1::INTEGER
2026-01-04 00:37:07,594 - sqlalchemy.engine.Engine - INFO - [generated in 0.00029s] (1,)
2026-01-04 00:37:07,595 - app.services.file_processor - INFO - Parsed filename (strict): 212223240169, 19AI405
2026-01-04 00:37:07,597 - app.services.file_processor - INFO - Saved file: ./uploads\pending\9836c94d977542e5a12ef92b33bb6133.jpg (hash: 3a00d46e79102899...)
2026-01-04 00:37:07,600 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE examination_artifacts.transaction_id = $1::VARCHAR
2026-01-04 00:37:07,600 - sqlalchemy.engine.Engine - INFO - [generated in 0.00057s] ('89a533d0edfc3ea69075c828290dbe4f',)
2026-01-04 00:37:07,617 - sqlalchemy.engine.Engine - INFO - INSERT INTO examination_artifacts (artifact_uuid, raw_filename, original_filename, parsed_reg_no, parsed_subject_code, file_blob_path, file_hash, file_size_bytes, mime_type, moodle_user_id, moodle_username, moodle_course_id, moodle_assignment_id, workflow_status, moodle_draft_item_id, moodle_submission_id, lms_transaction_id, transaction_id, validated_at, submit_timestamp, completed_at, uploaded_by_staff_id, submitted_by_user_id, transaction_log, error_message, retry_count) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::BIGINT, $9::VARCHAR, $10::BIGINT, $11::VARCHAR, $12::INTEGER, $13::INTEGER, $14::workflowstatus, $15::BIGINT, $16::VARCHAR, $17::VARCHAR, $18::VARCHAR, $19::TIMESTAMP WITH TIME ZONE, $20::TIMESTAMP WITH TIME ZONE, $21::TIMESTAMP WITH TIME ZONE, $22::INTEGER, $23::BIGINT, $24::JSONB, $25::VARCHAR, $26::INTEGER) RETURNING examination_artifacts.id, examination_artifacts.uploaded_at
2026-01-04 00:37:07,617 - sqlalchemy.engine.Engine - INFO - [generated in 0.00064s] (UUID('302c753a-e208-4b0e-a992-e628c6bbe6d1'), '212223240169_19AI405.jpg', '212223240169_19AI405.jpg', '212223240169', '19AI405', './uploads\\pending\\9836c94d977542e5a12ef92b33bb6133.jpg', '3a00d46e791028994365d24a1febf50b451f2fee472cf57c44b1c37bb58275dd', 901372, 'image/jpeg', None, None, None, None, 'PENDING', None, None, None, '89a533d0edfc3ea69075c828290dbe4f', None, None, None, 1, None, '[{"timestamp": "2026-01-03T19:07:07.615894", "action": "created", "details": {"filename": "212223240169_19AI405.jpg", "parsed_reg_no": "212223240169", "parsed_subject_code": "19AI405"}}]', None, 0)
2026-01-04 00:37:07,622 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE examination_artifacts.id = $1::INTEGER
2026-01-04 00:37:07,622 - sqlalchemy.engine.Engine - INFO - [generated in 0.00039s] (2,)
2026-01-04 00:37:07,623 - app.services.artifact_service - INFO - Created artifact: 302c753a-e208-4b0e-a992-e628c6bbe6d1
2026-01-04 00:37:07,625 - sqlalchemy.engine.Engine - INFO - INSERT INTO audit_logs (action, action_category, description, actor_type, actor_id, actor_username, actor_ip, artifact_id, target_type, target_id, request_data, response_data, moodle_api_function, moodle_response_code) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::INTEGER, $9::VARCHAR, $10::VARCHAR, $11::JSONB, $12::JSONB, $13::VARCHAR, $14::INTEGER) RETURNING audit_logs.id, audit_logs.created_at
2026-01-04 00:37:07,625 - sqlalchemy.engine.Engine - INFO - [generated in 0.00037s] ('bulk_upload', 'upload', 'Bulk upload: 1 successful, 0 failed', 'staff', '1', 'admin', '127.0.0.1', None, None, None, '{"total": 1, "successful": 1, "failed": 0}', 'null', None, None)
2026-01-04 00:37:07,628 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 00:37:11,124 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 00:37:11,125 - sqlalchemy.engine.Engine - INFO - SELECT student_sessions.id, student_sessions.session_id, student_sessions.moodle_user_id, student_sessions.moodle_username, student_sessions.moodle_fullname, student_sessions.encrypted_token, student_sessions.token_expires_at, student_sessions.ip_address, student_sessions.user_agent, student_sessions.created_at, student_sessions.last_activity_at, student_sessions.expires_at 
FROM student_sessions 
WHERE student_sessions.session_id = $1::VARCHAR
2026-01-04 00:37:11,125 - sqlalchemy.engine.Engine - INFO - [generated in 0.00030s] ('_54sPe5F1tiBwZiCjXb9fZEpvor5uInFYyARS0MaOB0',)
2026-01-04 00:37:11,129 - sqlalchemy.engine.Engine - INFO - UPDATE student_sessions SET last_activity_at=$1::TIMESTAMP WITH TIME ZONE WHERE student_sessions.id = $2::INTEGER
2026-01-04 00:37:11,129 - sqlalchemy.engine.Engine - INFO - [generated in 0.00028s] (datetime.datetime(2026, 1, 3, 19, 7, 11, 129329, tzinfo=datetime.timezone.utc), 1)
2026-01-04 00:37:11,130 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 00:37:11,132 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 00:37:11,133 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE (examination_artifacts.parsed_reg_no = $1::VARCHAR OR examination_artifacts.moodle_username = $2::VARCHAR) AND examination_artifacts.workflow_status IN ($3::workflowstatus, $4::workflowstatus, $5::workflowstatus, $6::workflowstatus) ORDER BY examination_artifacts.uploaded_at DESC
2026-01-04 00:37:11,133 - sqlalchemy.engine.Engine - INFO - [generated in 0.00037s] ('212223240065', '212223240065', 'PENDING', 'PENDING_REVIEW', 'VALIDATED', 'READY_FOR_REVIEW')
2026-01-04 00:37:11,135 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE examination_artifacts.parsed_reg_no = $1::VARCHAR AND examination_artifacts.workflow_status IN ($2::workflowstatus, $3::workflowstatus) ORDER BY examination_artifacts.submit_timestamp DESC
2026-01-04 00:37:11,136 - sqlalchemy.engine.Engine - INFO - [generated in 0.00055s] ('212223240065', 'SUBMITTED_TO_LMS', 'COMPLETED')
2026-01-04 00:37:11,138 - sqlalchemy.engine.Engine - INFO - SELECT subject_mappings.id, subject_mappings.subject_code, subject_mappings.subject_name, subject_mappings.moodle_course_id, subject_mappings.moodle_course_idnumber, subject_mappings.moodle_assignment_id, subject_mappings.moodle_assignment_name, subject_mappings.exam_session, subject_mappings.is_active, subject_mappings.created_at, subject_mappings.updated_at, subject_mappings.last_verified_at 
FROM subject_mappings 
WHERE subject_mappings.subject_code = $1::VARCHAR AND subject_mappings.is_active = true
2026-01-04 00:37:11,138 - sqlalchemy.engine.Engine - INFO - [generated in 0.00037s] ('19AI411',)
2026-01-04 00:37:11,141 - sqlalchemy.engine.Engine - INFO - SELECT subject_mappings.id, subject_mappings.subject_code, subject_mappings.subject_name, subject_mappings.moodle_course_id, subject_mappings.moodle_course_idnumber, subject_mappings.moodle_assignment_id, subject_mappings.moodle_assignment_name, subject_mappings.exam_session, subject_mappings.is_active, subject_mappings.created_at, subject_mappings.updated_at, subject_mappings.last_verified_at 
FROM subject_mappings 
WHERE subject_mappings.subject_code = $1::VARCHAR AND subject_mappings.is_active = true
2026-01-04 00:37:11,141 - sqlalchemy.engine.Engine - INFO - [cached since 0.002944s ago] ('19AI411',)
2026-01-04 00:37:11,142 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 00:37:11,145 - app.db.database - ERROR - Database session error: [{'type': 'missing', 'loc': ('header', 'X-Session-ID'), 'msg': 'Field required', 'input': None, 'url': 'https://errors.pydantic.dev/2.5/v/missing'}]
2026-01-04 00:37:28,965 - app.api.routes.auth - INFO - Authenticating student: 23009466
2026-01-04 00:37:29,154 - app.services.moodle_client - INFO - Authenticating user: 23009466
2026-01-04 00:37:29,155 - httpcore.connection - DEBUG - connect_tcp.started host='1844fdb23815.ngrok-free.app' port=443 local_address=None timeout=30.0 socket_options=None
2026-01-04 00:37:29,219 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001586E86C750>
2026-01-04 00:37:29,219 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000001586EAA05F0> server_hostname='1844fdb23815.ngrok-free.app' timeout=30.0
2026-01-04 00:37:29,262 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001586EA697D0>
2026-01-04 00:37:29,263 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-01-04 00:37:29,263 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-01-04 00:37:29,263 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-01-04 00:37:29,263 - httpcore.http11 - DEBUG - send_request_body.complete
2026-01-04 00:37:29,263 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-01-04 00:37:29,306 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 404, b'Not Found', [(b'Connection', b'close'), (b'Content-Type', b'text/plain'), (b'Ngrok-Error-Code', b'ERR_NGROK_3200'), (b'Date', b'Sat, 03 Jan 2026 19:07:26 GMT'), (b'Content-Length', b'72')])
2026-01-04 00:37:29,307 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-01-04 00:37:29,307 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-01-04 00:37:29,307 - httpcore.http11 - DEBUG - response_closed.started
2026-01-04 00:37:29,307 - httpcore.http11 - DEBUG - response_closed.complete
2026-01-04 00:37:29,308 - app.services.moodle_client - ERROR - HTTP error during authentication: Client error '404 Not Found' for url 'https://1844fdb23815.ngrok-free.app/login/token.php'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2026-01-04 00:37:29,308 - app.api.routes.auth - WARNING - Moodle authentication failed for 23009466: HTTP error: 404
2026-01-04 00:37:29,308 - app.db.database - ERROR - Database session error: 
2026-01-04 00:38:23,457 - app.api.routes.auth - INFO - Authenticating student: 23004568
2026-01-04 00:38:23,624 - app.services.moodle_client - INFO - Authenticating user: 23004568
2026-01-04 00:38:23,625 - httpcore.connection - DEBUG - connect_tcp.started host='1844fdb23815.ngrok-free.app' port=443 local_address=None timeout=30.0 socket_options=None
2026-01-04 00:38:23,680 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001586EA8FC10>
2026-01-04 00:38:23,680 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000001586EAA0B00> server_hostname='1844fdb23815.ngrok-free.app' timeout=30.0
2026-01-04 00:38:23,735 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001586EA73810>
2026-01-04 00:38:23,735 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-01-04 00:38:23,736 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-01-04 00:38:23,736 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-01-04 00:38:23,736 - httpcore.http11 - DEBUG - send_request_body.complete
2026-01-04 00:38:23,736 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-01-04 00:38:23,789 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 404, b'Not Found', [(b'Connection', b'close'), (b'Content-Type', b'text/plain'), (b'Ngrok-Error-Code', b'ERR_NGROK_3200'), (b'Date', b'Sat, 03 Jan 2026 19:08:21 GMT'), (b'Content-Length', b'72')])
2026-01-04 00:38:23,789 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-01-04 00:38:23,789 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-01-04 00:38:23,790 - httpcore.http11 - DEBUG - response_closed.started
2026-01-04 00:38:23,790 - httpcore.http11 - DEBUG - response_closed.complete
2026-01-04 00:38:23,790 - app.services.moodle_client - ERROR - HTTP error during authentication: Client error '404 Not Found' for url 'https://1844fdb23815.ngrok-free.app/login/token.php'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2026-01-04 00:38:23,790 - app.api.routes.auth - WARNING - Moodle authentication failed for 23004568: HTTP error: 404
2026-01-04 00:38:23,790 - app.db.database - ERROR - Database session error: 
2026-01-04 00:39:24,146 - app.api.routes.auth - INFO - Authenticating student: 23004568
2026-01-04 00:39:24,313 - app.services.moodle_client - INFO - Authenticating user: 23004568
2026-01-04 00:39:24,314 - httpcore.connection - DEBUG - connect_tcp.started host='1844fdb23815.ngrok-free.app' port=443 local_address=None timeout=30.0 socket_options=None
2026-01-04 00:39:24,382 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001586EAC6550>
2026-01-04 00:39:24,383 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000001586EAA05F0> server_hostname='1844fdb23815.ngrok-free.app' timeout=30.0
2026-01-04 00:39:24,433 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001586EAC4150>
2026-01-04 00:39:24,433 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-01-04 00:39:24,433 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-01-04 00:39:24,433 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-01-04 00:39:24,435 - httpcore.http11 - DEBUG - send_request_body.complete
2026-01-04 00:39:24,435 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-01-04 00:39:24,477 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 404, b'Not Found', [(b'Connection', b'close'), (b'Content-Type', b'text/plain'), (b'Ngrok-Error-Code', b'ERR_NGROK_3200'), (b'Date', b'Sat, 03 Jan 2026 19:09:21 GMT'), (b'Content-Length', b'72')])
2026-01-04 00:39:24,477 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-01-04 00:39:24,477 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-01-04 00:39:24,478 - httpcore.http11 - DEBUG - response_closed.started
2026-01-04 00:39:24,478 - httpcore.http11 - DEBUG - response_closed.complete
2026-01-04 00:39:24,478 - app.services.moodle_client - ERROR - HTTP error during authentication: Client error '404 Not Found' for url 'https://1844fdb23815.ngrok-free.app/login/token.php'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2026-01-04 00:39:24,478 - app.api.routes.auth - WARNING - Moodle authentication failed for 23004568: HTTP error: 404
2026-01-04 00:39:24,478 - app.db.database - ERROR - Database session error: 
2026-01-04 00:39:46,811 - app.api.routes.auth - INFO - Authenticating student: 23004568
2026-01-04 00:39:46,980 - app.services.moodle_client - INFO - Authenticating user: 23004568
2026-01-04 00:39:46,981 - httpcore.connection - DEBUG - connect_tcp.started host='1844fdb23815.ngrok-free.app' port=443 local_address=None timeout=30.0 socket_options=None
2026-01-04 00:39:47,040 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001586EACDCD0>
2026-01-04 00:39:47,040 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000001586EAA0B90> server_hostname='1844fdb23815.ngrok-free.app' timeout=30.0
2026-01-04 00:39:47,100 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001586EACDC10>
2026-01-04 00:39:47,100 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-01-04 00:39:47,101 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-01-04 00:39:47,101 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-01-04 00:39:47,101 - httpcore.http11 - DEBUG - send_request_body.complete
2026-01-04 00:39:47,101 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-01-04 00:39:47,151 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 404, b'Not Found', [(b'Connection', b'close'), (b'Content-Type', b'text/plain'), (b'Ngrok-Error-Code', b'ERR_NGROK_3200'), (b'Date', b'Sat, 03 Jan 2026 19:09:44 GMT'), (b'Content-Length', b'72')])
2026-01-04 00:39:47,152 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-01-04 00:39:47,152 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-01-04 00:39:47,152 - httpcore.http11 - DEBUG - response_closed.started
2026-01-04 00:39:47,152 - httpcore.http11 - DEBUG - response_closed.complete
2026-01-04 00:39:47,152 - app.services.moodle_client - ERROR - HTTP error during authentication: Client error '404 Not Found' for url 'https://1844fdb23815.ngrok-free.app/login/token.php'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2026-01-04 00:39:47,153 - app.api.routes.auth - WARNING - Moodle authentication failed for 23004568: HTTP error: 404
2026-01-04 00:39:47,153 - app.db.database - ERROR - Database session error: 
2026-01-04 00:40:34,539 - app.api.routes.auth - INFO - Authenticating student: admin
2026-01-04 00:40:34,706 - app.services.moodle_client - INFO - Authenticating user: admin
2026-01-04 00:40:34,707 - httpcore.connection - DEBUG - connect_tcp.started host='1844fdb23815.ngrok-free.app' port=443 local_address=None timeout=30.0 socket_options=None
2026-01-04 00:40:35,848 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001586EA73810>
2026-01-04 00:40:35,848 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000001586E7E2B10> server_hostname='1844fdb23815.ngrok-free.app' timeout=30.0
2026-01-04 00:40:35,904 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001586EA8E310>
2026-01-04 00:40:35,904 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-01-04 00:40:35,904 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-01-04 00:40:35,904 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-01-04 00:40:35,905 - httpcore.http11 - DEBUG - send_request_body.complete
2026-01-04 00:40:35,905 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-01-04 00:40:35,953 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 404, b'Not Found', [(b'Connection', b'close'), (b'Content-Type', b'text/plain'), (b'Ngrok-Error-Code', b'ERR_NGROK_3200'), (b'Date', b'Sat, 03 Jan 2026 19:10:33 GMT'), (b'Content-Length', b'72')])
2026-01-04 00:40:35,953 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-01-04 00:40:35,953 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-01-04 00:40:35,953 - httpcore.http11 - DEBUG - response_closed.started
2026-01-04 00:40:35,954 - httpcore.http11 - DEBUG - response_closed.complete
2026-01-04 00:40:35,954 - app.services.moodle_client - ERROR - HTTP error during authentication: Client error '404 Not Found' for url 'https://1844fdb23815.ngrok-free.app/login/token.php'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2026-01-04 00:40:35,954 - app.api.routes.auth - WARNING - Moodle authentication failed for admin: HTTP error: 404
2026-01-04 00:40:35,954 - app.db.database - ERROR - Database session error: 
2026-01-04 00:40:48,096 - app.api.routes.auth - INFO - Authenticating student: admin
2026-01-04 00:40:48,298 - app.services.moodle_client - INFO - Authenticating user: admin
2026-01-04 00:40:48,298 - httpcore.connection - DEBUG - connect_tcp.started host='1844fdb23815.ngrok-free.app' port=443 local_address=None timeout=30.0 socket_options=None
2026-01-04 00:40:48,357 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001586EACF6D0>
2026-01-04 00:40:48,357 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000001586EAA0320> server_hostname='1844fdb23815.ngrok-free.app' timeout=30.0
2026-01-04 00:40:48,413 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001586EACC7D0>
2026-01-04 00:40:48,414 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-01-04 00:40:48,414 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-01-04 00:40:48,414 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-01-04 00:40:48,414 - httpcore.http11 - DEBUG - send_request_body.complete
2026-01-04 00:40:48,414 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-01-04 00:40:48,465 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 404, b'Not Found', [(b'Connection', b'close'), (b'Content-Type', b'text/plain'), (b'Ngrok-Error-Code', b'ERR_NGROK_3200'), (b'Date', b'Sat, 03 Jan 2026 19:10:45 GMT'), (b'Content-Length', b'72')])
2026-01-04 00:40:48,466 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-01-04 00:40:48,466 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-01-04 00:40:48,466 - httpcore.http11 - DEBUG - response_closed.started
2026-01-04 00:40:48,466 - httpcore.http11 - DEBUG - response_closed.complete
2026-01-04 00:40:48,466 - app.services.moodle_client - ERROR - HTTP error during authentication: Client error '404 Not Found' for url 'https://1844fdb23815.ngrok-free.app/login/token.php'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
2026-01-04 00:40:48,466 - app.api.routes.auth - WARNING - Moodle authentication failed for admin: HTTP error: 404
2026-01-04 00:40:48,466 - app.db.database - ERROR - Database session error: 
2026-01-04 00:46:01,697 - app.main - INFO - Shutting down Examination Middleware...
2026-01-04 00:46:01,709 - app.main - INFO - Database connections closed
2026-01-04 00:46:03,737 - app.main - INFO - Starting Examination Middleware...
2026-01-04 00:46:03,796 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2026-01-04 00:46:03,796 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-04 00:46:03,798 - sqlalchemy.engine.Engine - INFO - select current_schema()
2026-01-04 00:46:03,798 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-04 00:46:03,799 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2026-01-04 00:46:03,799 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-04 00:46:03,800 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 00:46:03,803 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:46:03,803 - sqlalchemy.engine.Engine - INFO - [generated in 0.00033s] ('examination_artifacts', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:46:03,808 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:46:03,808 - sqlalchemy.engine.Engine - INFO - [cached since 0.005177s ago] ('subject_mappings', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:46:03,809 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:46:03,809 - sqlalchemy.engine.Engine - INFO - [cached since 0.006111s ago] ('staff_users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:46:03,810 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:46:03,810 - sqlalchemy.engine.Engine - INFO - [cached since 0.007268s ago] ('student_sessions', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:46:03,811 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:46:03,812 - sqlalchemy.engine.Engine - INFO - [cached since 0.008649s ago] ('audit_logs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:46:03,812 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:46:03,812 - sqlalchemy.engine.Engine - INFO - [cached since 0.009575s ago] ('submission_queue', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:46:03,813 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:46:03,813 - sqlalchemy.engine.Engine - INFO - [cached since 0.01034s ago] ('system_config', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:46:03,814 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-01-04 00:46:03,814 - sqlalchemy.engine.Engine - INFO - [generated in 0.00028s] ('workflowstatus', 'pg_catalog')
2026-01-04 00:46:03,815 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 00:46:03,816 - app.main - INFO - Database tables created/verified
2026-01-04 00:46:03,816 - app.main - INFO - Upload directory: D:\LMS-SAE\exam_middleware\uploads
2026-01-04 00:46:03,816 - app.main - INFO - Storage directory: D:\LMS-SAE\exam_middleware\storage
2026-01-04 00:46:03,817 - app.main - INFO - Examination Middleware started successfully
2026-01-04 00:46:20,130 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2026-01-04 00:46:20,130 - multipart.multipart - DEBUG - Calling on_header_field with data[42:61]
2026-01-04 00:46:20,130 - multipart.multipart - DEBUG - Calling on_header_value with data[63:123]
2026-01-04 00:46:20,130 - multipart.multipart - DEBUG - Calling on_header_end with no data
2026-01-04 00:46:20,130 - multipart.multipart - DEBUG - Calling on_header_field with data[125:137]
2026-01-04 00:46:20,130 - multipart.multipart - DEBUG - Calling on_header_value with data[139:149]
2026-01-04 00:46:20,130 - multipart.multipart - DEBUG - Calling on_header_end with no data
2026-01-04 00:46:20,130 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2026-01-04 00:46:20,130 - multipart.multipart - DEBUG - Calling on_part_data with data[153:32768]
2026-01-04 00:46:20,132 - multipart.multipart - DEBUG - Calling on_part_data with data[0:76893]
2026-01-04 00:46:20,133 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:46:20,133 - multipart.multipart - DEBUG - Calling on_part_data with data[76894:79128]
2026-01-04 00:46:20,133 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:46:20,133 - multipart.multipart - DEBUG - Calling on_part_data with data[79129:114691]
2026-01-04 00:46:20,133 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:46:20,134 - multipart.multipart - DEBUG - Calling on_part_data with data[114692:181807]
2026-01-04 00:46:20,134 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:46:20,134 - multipart.multipart - DEBUG - Calling on_part_data with data[181808:190505]
2026-01-04 00:46:20,134 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:46:20,134 - multipart.multipart - DEBUG - Calling on_part_data with data[190506:193960]
2026-01-04 00:46:20,134 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:46:20,134 - multipart.multipart - DEBUG - Calling on_part_data with data[193961:196608]
2026-01-04 00:46:20,135 - multipart.multipart - DEBUG - Calling on_part_data with data[0:139202]
2026-01-04 00:46:20,135 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:46:20,136 - multipart.multipart - DEBUG - Calling on_part_data with data[139203:245760]
2026-01-04 00:46:20,136 - multipart.multipart - DEBUG - Calling on_part_data with data[0:22623]
2026-01-04 00:46:20,136 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:46:20,136 - multipart.multipart - DEBUG - Calling on_part_data with data[22624:28012]
2026-01-04 00:46:20,137 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:46:20,137 - multipart.multipart - DEBUG - Calling on_part_data with data[28013:36732]
2026-01-04 00:46:20,137 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:46:20,138 - multipart.multipart - DEBUG - Calling on_part_data with data[36733:78066]
2026-01-04 00:46:20,138 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:46:20,139 - multipart.multipart - DEBUG - Calling on_part_data with data[78067:151094]
2026-01-04 00:46:20,139 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:46:20,139 - multipart.multipart - DEBUG - Calling on_part_data with data[151095:151180]
2026-01-04 00:46:20,139 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:46:20,139 - multipart.multipart - DEBUG - Calling on_part_data with data[151181:262144]
2026-01-04 00:46:20,140 - multipart.multipart - DEBUG - Calling on_part_data with data[0:16181]
2026-01-04 00:46:20,140 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:46:20,141 - multipart.multipart - DEBUG - Calling on_part_data with data[16182:155656]
2026-01-04 00:46:20,141 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:46:20,141 - multipart.multipart - DEBUG - Calling on_part_data with data[155657:164245]
2026-01-04 00:46:20,141 - multipart.multipart - DEBUG - Calling on_part_end with no data
2026-01-04 00:46:20,141 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2026-01-04 00:46:20,141 - multipart.multipart - DEBUG - Calling on_header_field with data[164289:164308]
2026-01-04 00:46:20,141 - multipart.multipart - DEBUG - Calling on_header_value with data[164310:164340]
2026-01-04 00:46:20,141 - multipart.multipart - DEBUG - Calling on_header_end with no data
2026-01-04 00:46:20,141 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2026-01-04 00:46:20,141 - multipart.multipart - DEBUG - Calling on_part_data with data[164344:164352]
2026-01-04 00:46:20,141 - multipart.multipart - DEBUG - Calling on_part_end with no data
2026-01-04 00:46:20,142 - multipart.multipart - DEBUG - Calling on_end with no data
2026-01-04 00:46:20,145 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 00:46:20,152 - sqlalchemy.engine.Engine - INFO - SELECT staff_users.id, staff_users.username, staff_users.email, staff_users.hashed_password, staff_users.full_name, staff_users.role, staff_users.is_active, staff_users.created_at, staff_users.last_login_at 
FROM staff_users 
WHERE staff_users.id = $1::INTEGER
2026-01-04 00:46:20,152 - sqlalchemy.engine.Engine - INFO - [generated in 0.00049s] (1,)
2026-01-04 00:46:20,155 - app.services.file_processor - INFO - Parsed filename (strict): 212223240169, 19AI405
2026-01-04 00:46:20,157 - app.services.file_processor - INFO - Saved file: ./uploads\pending\b684379b3ef04bbbaf4c882397e7a1a7.jpg (hash: 3a00d46e79102899...)
2026-01-04 00:46:20,160 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE examination_artifacts.transaction_id = $1::VARCHAR
2026-01-04 00:46:20,160 - sqlalchemy.engine.Engine - INFO - [generated in 0.00047s] ('89a533d0edfc3ea69075c828290dbe4f',)
2026-01-04 00:46:20,173 - app.services.artifact_service - WARNING - Duplicate artifact detected: 89a533d0edfc3ea69075c828290dbe4f
2026-01-04 00:46:20,175 - sqlalchemy.engine.Engine - INFO - INSERT INTO audit_logs (action, action_category, description, actor_type, actor_id, actor_username, actor_ip, artifact_id, target_type, target_id, request_data, response_data, moodle_api_function, moodle_response_code) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::INTEGER, $9::VARCHAR, $10::VARCHAR, $11::JSONB, $12::JSONB, $13::VARCHAR, $14::INTEGER) RETURNING audit_logs.id, audit_logs.created_at
2026-01-04 00:46:20,175 - sqlalchemy.engine.Engine - INFO - [generated in 0.00044s] ('bulk_upload', 'upload', 'Bulk upload: 1 successful, 0 failed', 'staff', '1', 'admin', '127.0.0.1', None, None, None, '{"total": 1, "successful": 1, "failed": 0}', 'null', None, None)
2026-01-04 00:46:20,178 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 00:46:30,270 - app.api.routes.auth - INFO - Authenticating student: 23009466
2026-01-04 00:46:30,439 - app.services.moodle_client - INFO - Authenticating user: 23009466
2026-01-04 00:46:30,442 - httpcore.connection - DEBUG - connect_tcp.started host='183a70678909.ngrok-free.app' port=443 local_address=None timeout=30.0 socket_options=None
2026-01-04 00:46:30,535 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000002035B64C190>
2026-01-04 00:46:30,535 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000002035B796690> server_hostname='183a70678909.ngrok-free.app' timeout=30.0
2026-01-04 00:46:30,590 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000002035B65D6D0>
2026-01-04 00:46:30,591 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-01-04 00:46:30,591 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-01-04 00:46:30,591 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-01-04 00:46:30,591 - httpcore.http11 - DEBUG - send_request_body.complete
2026-01-04 00:46:30,601 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-01-04 00:46:31,000 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Accept-Ranges', b'none'), (b'Access-Control-Allow-Origin', b'*'), (b'Cache-Control', b'no-store, no-cache, must-revalidate'), (b'Cache-Control', b'post-check=0, pre-check=0'), (b'Content-Length', b'126'), (b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Sat, 03 Jan 2026 19:16:30 GMT'), (b'Expires', b'Mon, 20 Aug 1969 09:23:00 GMT'), (b'Last-Modified', b'Sat, 03 Jan 2026 19:16:30 GMT'), (b'Ngrok-Agent-Ips', b'2406:7400:3b:ec84:45c4:688:4cd7:ce08'), (b'Pragma', b'no-cache'), (b'Server', b'Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.2.4'), (b'X-Powered-By', b'PHP/8.2.4')])
2026-01-04 00:46:31,001 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-01-04 00:46:31,001 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-01-04 00:46:31,001 - httpcore.http11 - DEBUG - response_closed.started
2026-01-04 00:46:31,001 - httpcore.http11 - DEBUG - response_closed.complete
2026-01-04 00:46:31,002 - app.services.moodle_client - INFO - Successfully authenticated user: 23009466
2026-01-04 00:46:31,002 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-01-04 00:46:31,002 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-01-04 00:46:31,003 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-01-04 00:46:31,003 - httpcore.http11 - DEBUG - send_request_body.complete
2026-01-04 00:46:31,003 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-01-04 00:46:31,199 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Accept-Ranges', b'none'), (b'Access-Control-Allow-Origin', b'*'), (b'Cache-Control', b'private, must-revalidate, pre-check=0, post-check=0, max-age=0'), (b'Content-Type', b'application/json'), (b'Date', b'Sat, 03 Jan 2026 19:16:31 GMT'), (b'Expires', b'Thu, 01 Jan 1970 00:00:00 GMT'), (b'Ngrok-Agent-Ips', b'2406:7400:3b:ec84:45c4:688:4cd7:ce08'), (b'Pragma', b'no-cache'), (b'Server', b'Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.2.4'), (b'X-Powered-By', b'PHP/8.2.4'), (b'Transfer-Encoding', b'chunked')])
2026-01-04 00:46:31,199 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-01-04 00:46:31,253 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-01-04 00:46:31,253 - httpcore.http11 - DEBUG - response_closed.started
2026-01-04 00:46:31,253 - httpcore.http11 - DEBUG - response_closed.complete
2026-01-04 00:46:31,254 - app.services.moodle_client - INFO - Got site info for user: 23009466
2026-01-04 00:46:31,255 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 00:46:31,257 - sqlalchemy.engine.Engine - INFO - INSERT INTO student_sessions (session_id, moodle_user_id, moodle_username, moodle_fullname, encrypted_token, token_expires_at, ip_address, user_agent, expires_at) VALUES ($1::VARCHAR, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::TIMESTAMP WITH TIME ZONE, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITH TIME ZONE) RETURNING student_sessions.id, student_sessions.created_at, student_sessions.last_activity_at
2026-01-04 00:46:31,257 - sqlalchemy.engine.Engine - INFO - [generated in 0.00030s] ('QonBsnGZS-4wobEOWxlR1G0hJ9-Y9WtbCL5E29Ror08', 6, '23009466', 'Arikatla Hari Veera Prasad 212223240014', 'Z0FBQUFBQnBXV3NQYjNsVHVFQ0wzNzZWa1FGYXhPTzV1STZuTWIwNUtTMEkzZnVjdTIyTDNJdV9ubzR6UlZ5TTNSb25NS3AwMnJyajlHdjFTdzFWOHg0SDdfRllwLXFGd3J2R3BMLW1nYW9kOUhDQkhPcEZVbzJqdEltTEg5R3NJTDJYb3J4NHlNRmE=', None, '127.0.0.1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36', datetime.datetime(2026, 1, 3, 20, 16, 31, 254644, tzinfo=datetime.timezone.utc))
2026-01-04 00:46:31,259 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 00:46:31,260 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 00:46:31,262 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE (examination_artifacts.parsed_reg_no = $1::VARCHAR OR examination_artifacts.moodle_username = $2::VARCHAR) AND examination_artifacts.workflow_status IN ($3::workflowstatus, $4::workflowstatus, $5::workflowstatus, $6::workflowstatus) ORDER BY examination_artifacts.uploaded_at DESC
2026-01-04 00:46:31,262 - sqlalchemy.engine.Engine - INFO - [generated in 0.00039s] ('212223240169', '212223240169', 'PENDING', 'PENDING_REVIEW', 'VALIDATED', 'READY_FOR_REVIEW')
2026-01-04 00:46:31,263 - app.api.routes.auth - INFO - Student 23009466 (reg: 212223240169) logged in. Pending papers: 1
2026-01-04 00:46:31,263 - httpcore.connection - DEBUG - close.started
2026-01-04 00:46:31,263 - httpcore.connection - DEBUG - close.complete
2026-01-04 00:46:31,265 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 00:46:31,267 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 00:46:31,268 - sqlalchemy.engine.Engine - INFO - SELECT student_sessions.id, student_sessions.session_id, student_sessions.moodle_user_id, student_sessions.moodle_username, student_sessions.moodle_fullname, student_sessions.encrypted_token, student_sessions.token_expires_at, student_sessions.ip_address, student_sessions.user_agent, student_sessions.created_at, student_sessions.last_activity_at, student_sessions.expires_at 
FROM student_sessions 
WHERE student_sessions.session_id = $1::VARCHAR
2026-01-04 00:46:31,268 - sqlalchemy.engine.Engine - INFO - [generated in 0.00036s] ('QonBsnGZS-4wobEOWxlR1G0hJ9-Y9WtbCL5E29Ror08',)
2026-01-04 00:46:31,272 - sqlalchemy.engine.Engine - INFO - UPDATE student_sessions SET last_activity_at=$1::TIMESTAMP WITH TIME ZONE WHERE student_sessions.id = $2::INTEGER
2026-01-04 00:46:31,272 - sqlalchemy.engine.Engine - INFO - [generated in 0.00047s] (datetime.datetime(2026, 1, 3, 19, 16, 31, 270516, tzinfo=datetime.timezone.utc), 2)
2026-01-04 00:46:31,274 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 00:46:31,275 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 00:46:31,276 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE (examination_artifacts.parsed_reg_no = $1::VARCHAR OR examination_artifacts.moodle_username = $2::VARCHAR) AND examination_artifacts.workflow_status IN ($3::workflowstatus, $4::workflowstatus, $5::workflowstatus, $6::workflowstatus) ORDER BY examination_artifacts.uploaded_at DESC
2026-01-04 00:46:31,276 - sqlalchemy.engine.Engine - INFO - [cached since 0.01503s ago] ('212223240014', '212223240014', 'PENDING', 'PENDING_REVIEW', 'VALIDATED', 'READY_FOR_REVIEW')
2026-01-04 00:46:31,278 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE examination_artifacts.parsed_reg_no = $1::VARCHAR AND examination_artifacts.workflow_status IN ($2::workflowstatus, $3::workflowstatus) ORDER BY examination_artifacts.submit_timestamp DESC
2026-01-04 00:46:31,278 - sqlalchemy.engine.Engine - INFO - [generated in 0.00047s] ('212223240014', 'SUBMITTED_TO_LMS', 'COMPLETED')
2026-01-04 00:46:31,280 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 00:47:00,840 - app.api.routes.auth - INFO - Authenticating student: admin
2026-01-04 00:47:01,015 - app.services.moodle_client - INFO - Authenticating user: admin
2026-01-04 00:47:01,016 - httpcore.connection - DEBUG - connect_tcp.started host='183a70678909.ngrok-free.app' port=443 local_address=None timeout=30.0 socket_options=None
2026-01-04 00:47:01,077 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000002035B7FD350>
2026-01-04 00:47:01,077 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000002035B797530> server_hostname='183a70678909.ngrok-free.app' timeout=30.0
2026-01-04 00:47:01,134 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000002035B85AB90>
2026-01-04 00:47:01,134 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-01-04 00:47:01,134 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-01-04 00:47:01,134 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-01-04 00:47:01,135 - httpcore.http11 - DEBUG - send_request_body.complete
2026-01-04 00:47:01,135 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-01-04 00:47:01,292 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Accept-Ranges', b'none'), (b'Access-Control-Allow-Origin', b'*'), (b'Cache-Control', b'no-store, no-cache, must-revalidate'), (b'Cache-Control', b'post-check=0, pre-check=0'), (b'Content-Length', b'129'), (b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Sat, 03 Jan 2026 19:17:01 GMT'), (b'Expires', b'Mon, 20 Aug 1969 09:23:00 GMT'), (b'Last-Modified', b'Sat, 03 Jan 2026 19:17:01 GMT'), (b'Ngrok-Agent-Ips', b'2406:7400:3b:ec84:45c4:688:4cd7:ce08'), (b'Pragma', b'no-cache'), (b'Server', b'Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.2.4'), (b'X-Powered-By', b'PHP/8.2.4')])
2026-01-04 00:47:01,292 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-01-04 00:47:01,293 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-01-04 00:47:01,293 - httpcore.http11 - DEBUG - response_closed.started
2026-01-04 00:47:01,293 - httpcore.http11 - DEBUG - response_closed.complete
2026-01-04 00:47:01,294 - app.services.moodle_client - ERROR - Authentication error: Authentication failed: Invalid login, please try again
2026-01-04 00:47:01,294 - app.api.routes.auth - WARNING - Moodle authentication failed for admin: Authentication failed: Invalid login, please try again
2026-01-04 00:47:01,294 - httpcore.connection - DEBUG - close.started
2026-01-04 00:47:01,294 - httpcore.connection - DEBUG - close.complete
2026-01-04 00:47:01,294 - app.db.database - ERROR - Database session error: 
2026-01-04 00:47:20,807 - app.api.routes.auth - INFO - Authenticating student: 23004568
2026-01-04 00:47:20,970 - app.services.moodle_client - INFO - Authenticating user: 23004568
2026-01-04 00:47:20,970 - httpcore.connection - DEBUG - connect_tcp.started host='183a70678909.ngrok-free.app' port=443 local_address=None timeout=30.0 socket_options=None
2026-01-04 00:47:21,020 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000002035B8A4390>
2026-01-04 00:47:21,020 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000002035B797F50> server_hostname='183a70678909.ngrok-free.app' timeout=30.0
2026-01-04 00:47:21,075 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000002035B8A42D0>
2026-01-04 00:47:21,075 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-01-04 00:47:21,075 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-01-04 00:47:21,075 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-01-04 00:47:21,075 - httpcore.http11 - DEBUG - send_request_body.complete
2026-01-04 00:47:21,075 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-01-04 00:47:21,295 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Accept-Ranges', b'none'), (b'Access-Control-Allow-Origin', b'*'), (b'Cache-Control', b'no-store, no-cache, must-revalidate'), (b'Cache-Control', b'post-check=0, pre-check=0'), (b'Content-Length', b'126'), (b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Sat, 03 Jan 2026 19:17:21 GMT'), (b'Expires', b'Mon, 20 Aug 1969 09:23:00 GMT'), (b'Last-Modified', b'Sat, 03 Jan 2026 19:17:21 GMT'), (b'Ngrok-Agent-Ips', b'2406:7400:3b:ec84:45c4:688:4cd7:ce08'), (b'Pragma', b'no-cache'), (b'Server', b'Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.2.4'), (b'X-Powered-By', b'PHP/8.2.4')])
2026-01-04 00:47:21,296 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-01-04 00:47:21,296 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-01-04 00:47:21,296 - httpcore.http11 - DEBUG - response_closed.started
2026-01-04 00:47:21,296 - httpcore.http11 - DEBUG - response_closed.complete
2026-01-04 00:47:21,296 - app.services.moodle_client - INFO - Successfully authenticated user: 23004568
2026-01-04 00:47:21,298 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-01-04 00:47:21,298 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-01-04 00:47:21,298 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-01-04 00:47:21,299 - httpcore.http11 - DEBUG - send_request_body.complete
2026-01-04 00:47:21,299 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-01-04 00:47:21,453 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Accept-Ranges', b'none'), (b'Access-Control-Allow-Origin', b'*'), (b'Cache-Control', b'private, must-revalidate, pre-check=0, post-check=0, max-age=0'), (b'Content-Type', b'application/json'), (b'Date', b'Sat, 03 Jan 2026 19:17:21 GMT'), (b'Expires', b'Thu, 01 Jan 1970 00:00:00 GMT'), (b'Ngrok-Agent-Ips', b'2406:7400:3b:ec84:45c4:688:4cd7:ce08'), (b'Pragma', b'no-cache'), (b'Server', b'Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.2.4'), (b'X-Powered-By', b'PHP/8.2.4'), (b'Transfer-Encoding', b'chunked')])
2026-01-04 00:47:21,453 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-01-04 00:47:21,505 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-01-04 00:47:21,505 - httpcore.http11 - DEBUG - response_closed.started
2026-01-04 00:47:21,505 - httpcore.http11 - DEBUG - response_closed.complete
2026-01-04 00:47:21,506 - app.services.moodle_client - INFO - Got site info for user: 23004568
2026-01-04 00:47:21,507 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 00:47:21,507 - sqlalchemy.engine.Engine - INFO - INSERT INTO student_sessions (session_id, moodle_user_id, moodle_username, moodle_fullname, encrypted_token, token_expires_at, ip_address, user_agent, expires_at) VALUES ($1::VARCHAR, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::TIMESTAMP WITH TIME ZONE, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITH TIME ZONE) RETURNING student_sessions.id, student_sessions.created_at, student_sessions.last_activity_at
2026-01-04 00:47:21,507 - sqlalchemy.engine.Engine - INFO - [cached since 50.25s ago] ('5aVlnHWkiy8kqNewupwiVzFLMMNPh1GofFsBy7cCl5Y', 5, '23004568', 'Santhan Kumar 212222020029', 'Z0FBQUFBQnBXV3RCNmRlX2xtcGlzSG53ZDIzZzJ1MmZEZGllYTNtcDdLVGxRRVlpSGVudC1mblg1Sk42alVOazh6bXozX3laYkNvZnFPanVtYkIwWi1MSWdOd2lWZWhXMU5zdHFEc2hlaGYyQzNyQnJ0ZzdzdjBUcFJKWjJFVXctdnU2TXVoa1h1UFA=', None, '127.0.0.1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36', datetime.datetime(2026, 1, 3, 20, 17, 21, 506119, tzinfo=datetime.timezone.utc))
2026-01-04 00:47:21,509 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 00:47:21,511 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 00:47:21,512 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE (examination_artifacts.parsed_reg_no = $1::VARCHAR OR examination_artifacts.moodle_username = $2::VARCHAR) AND examination_artifacts.workflow_status IN ($3::workflowstatus, $4::workflowstatus, $5::workflowstatus, $6::workflowstatus) ORDER BY examination_artifacts.uploaded_at DESC
2026-01-04 00:47:21,512 - sqlalchemy.engine.Engine - INFO - [cached since 50.25s ago] ('212223240169', '212223240169', 'PENDING', 'PENDING_REVIEW', 'VALIDATED', 'READY_FOR_REVIEW')
2026-01-04 00:47:21,513 - app.api.routes.auth - INFO - Student 23004568 (reg: 212223240169) logged in. Pending papers: 1
2026-01-04 00:47:21,513 - httpcore.connection - DEBUG - close.started
2026-01-04 00:47:21,513 - httpcore.connection - DEBUG - close.complete
2026-01-04 00:47:21,513 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 00:47:21,517 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 00:47:21,517 - sqlalchemy.engine.Engine - INFO - SELECT student_sessions.id, student_sessions.session_id, student_sessions.moodle_user_id, student_sessions.moodle_username, student_sessions.moodle_fullname, student_sessions.encrypted_token, student_sessions.token_expires_at, student_sessions.ip_address, student_sessions.user_agent, student_sessions.created_at, student_sessions.last_activity_at, student_sessions.expires_at 
FROM student_sessions 
WHERE student_sessions.session_id = $1::VARCHAR
2026-01-04 00:47:21,518 - sqlalchemy.engine.Engine - INFO - [cached since 50.25s ago] ('5aVlnHWkiy8kqNewupwiVzFLMMNPh1GofFsBy7cCl5Y',)
2026-01-04 00:47:21,518 - sqlalchemy.engine.Engine - INFO - UPDATE student_sessions SET last_activity_at=$1::TIMESTAMP WITH TIME ZONE WHERE student_sessions.id = $2::INTEGER
2026-01-04 00:47:21,519 - sqlalchemy.engine.Engine - INFO - [cached since 50.25s ago] (datetime.datetime(2026, 1, 3, 19, 17, 21, 518182, tzinfo=datetime.timezone.utc), 3)
2026-01-04 00:47:21,519 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 00:47:21,520 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 00:47:21,521 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE (examination_artifacts.parsed_reg_no = $1::VARCHAR OR examination_artifacts.moodle_username = $2::VARCHAR) AND examination_artifacts.workflow_status IN ($3::workflowstatus, $4::workflowstatus, $5::workflowstatus, $6::workflowstatus) ORDER BY examination_artifacts.uploaded_at DESC
2026-01-04 00:47:21,521 - sqlalchemy.engine.Engine - INFO - [cached since 50.26s ago] ('212222020029', '212222020029', 'PENDING', 'PENDING_REVIEW', 'VALIDATED', 'READY_FOR_REVIEW')
2026-01-04 00:47:21,522 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE examination_artifacts.parsed_reg_no = $1::VARCHAR AND examination_artifacts.workflow_status IN ($2::workflowstatus, $3::workflowstatus) ORDER BY examination_artifacts.submit_timestamp DESC
2026-01-04 00:47:21,522 - sqlalchemy.engine.Engine - INFO - [cached since 50.24s ago] ('212222020029', 'SUBMITTED_TO_LMS', 'COMPLETED')
2026-01-04 00:47:21,524 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 00:47:34,143 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2026-01-04 00:47:34,144 - multipart.multipart - DEBUG - Calling on_header_field with data[42:61]
2026-01-04 00:47:34,145 - multipart.multipart - DEBUG - Calling on_header_value with data[63:123]
2026-01-04 00:47:34,145 - multipart.multipart - DEBUG - Calling on_header_end with no data
2026-01-04 00:47:34,145 - multipart.multipart - DEBUG - Calling on_header_field with data[125:137]
2026-01-04 00:47:34,145 - multipart.multipart - DEBUG - Calling on_header_value with data[139:149]
2026-01-04 00:47:34,145 - multipart.multipart - DEBUG - Calling on_header_end with no data
2026-01-04 00:47:34,145 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2026-01-04 00:47:34,145 - multipart.multipart - DEBUG - Calling on_part_data with data[153:254]
2026-01-04 00:47:34,145 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:47:34,145 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:47:34,145 - multipart.multipart - DEBUG - Calling on_part_data with data[256:2210]
2026-01-04 00:47:34,145 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:47:34,145 - multipart.multipart - DEBUG - Calling on_part_data with data[2211:46463]
2026-01-04 00:47:34,145 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:47:34,145 - multipart.multipart - DEBUG - Calling on_part_data with data[46464:49152]
2026-01-04 00:47:34,147 - multipart.multipart - DEBUG - Calling on_part_data with data[0:17965]
2026-01-04 00:47:34,147 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:47:34,147 - multipart.multipart - DEBUG - Calling on_part_data with data[17966:212981]
2026-01-04 00:47:34,147 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:47:34,147 - multipart.multipart - DEBUG - Calling on_part_data with data[212982:212992]
2026-01-04 00:47:34,148 - multipart.multipart - DEBUG - Calling on_part_data with data[0:112711]
2026-01-04 00:47:34,148 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:47:34,149 - multipart.multipart - DEBUG - Calling on_part_data with data[112712:245760]
2026-01-04 00:47:34,150 - multipart.multipart - DEBUG - Calling on_part_data with data[0:2239]
2026-01-04 00:47:34,150 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:47:34,150 - multipart.multipart - DEBUG - Calling on_part_data with data[2240:135577]
2026-01-04 00:47:34,150 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:47:34,150 - multipart.multipart - DEBUG - Calling on_part_data with data[135578:262144]
2026-01-04 00:47:34,151 - multipart.multipart - DEBUG - Calling on_part_data with data[0:23421]
2026-01-04 00:47:34,151 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:47:34,151 - multipart.multipart - DEBUG - Calling on_part_data with data[23422:40862]
2026-01-04 00:47:34,151 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:47:34,151 - multipart.multipart - DEBUG - Calling on_part_data with data[40863:128844]
2026-01-04 00:47:34,151 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:47:34,151 - multipart.multipart - DEBUG - Calling on_part_data with data[128845:131477]
2026-01-04 00:47:34,151 - multipart.multipart - DEBUG - Calling on_part_end with no data
2026-01-04 00:47:34,153 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2026-01-04 00:47:34,153 - multipart.multipart - DEBUG - Calling on_header_field with data[131521:131540]
2026-01-04 00:47:34,153 - multipart.multipart - DEBUG - Calling on_header_value with data[131542:131602]
2026-01-04 00:47:34,153 - multipart.multipart - DEBUG - Calling on_header_end with no data
2026-01-04 00:47:34,153 - multipart.multipart - DEBUG - Calling on_header_field with data[131604:131616]
2026-01-04 00:47:34,153 - multipart.multipart - DEBUG - Calling on_header_value with data[131618:131628]
2026-01-04 00:47:34,154 - multipart.multipart - DEBUG - Calling on_header_end with no data
2026-01-04 00:47:34,154 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2026-01-04 00:47:34,154 - multipart.multipart - DEBUG - Calling on_part_data with data[131632:131733]
2026-01-04 00:47:34,154 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:47:34,154 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:47:34,154 - multipart.multipart - DEBUG - Calling on_part_data with data[131735:160929]
2026-01-04 00:47:34,155 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:47:34,155 - multipart.multipart - DEBUG - Calling on_part_data with data[160930:262144]
2026-01-04 00:47:34,155 - multipart.multipart - DEBUG - Calling on_part_data with data[0:166990]
2026-01-04 00:47:34,157 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:47:34,157 - multipart.multipart - DEBUG - Calling on_part_data with data[166991:187170]
2026-01-04 00:47:34,157 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:47:34,157 - multipart.multipart - DEBUG - Calling on_part_data with data[187171:188641]
2026-01-04 00:47:34,158 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:47:34,158 - multipart.multipart - DEBUG - Calling on_part_data with data[188642:223611]
2026-01-04 00:47:34,158 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:47:34,158 - multipart.multipart - DEBUG - Calling on_part_data with data[223612:262144]
2026-01-04 00:47:34,159 - multipart.multipart - DEBUG - Calling on_part_data with data[0:69259]
2026-01-04 00:47:34,159 - multipart.multipart - DEBUG - Calling on_part_data with data[0:1]
2026-01-04 00:47:34,160 - multipart.multipart - DEBUG - Calling on_part_data with data[69260:225756]
2026-01-04 00:47:34,160 - multipart.multipart - DEBUG - Calling on_part_end with no data
2026-01-04 00:47:34,160 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2026-01-04 00:47:34,160 - multipart.multipart - DEBUG - Calling on_header_field with data[225800:225819]
2026-01-04 00:47:34,160 - multipart.multipart - DEBUG - Calling on_header_value with data[225821:225851]
2026-01-04 00:47:34,160 - multipart.multipart - DEBUG - Calling on_header_end with no data
2026-01-04 00:47:34,160 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2026-01-04 00:47:34,160 - multipart.multipart - DEBUG - Calling on_part_data with data[225855:225863]
2026-01-04 00:47:34,160 - multipart.multipart - DEBUG - Calling on_part_end with no data
2026-01-04 00:47:34,160 - multipart.multipart - DEBUG - Calling on_end with no data
2026-01-04 00:47:34,162 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 00:47:34,162 - sqlalchemy.engine.Engine - INFO - SELECT staff_users.id, staff_users.username, staff_users.email, staff_users.hashed_password, staff_users.full_name, staff_users.role, staff_users.is_active, staff_users.created_at, staff_users.last_login_at 
FROM staff_users 
WHERE staff_users.id = $1::INTEGER
2026-01-04 00:47:34,162 - sqlalchemy.engine.Engine - INFO - [cached since 74.01s ago] (1,)
2026-01-04 00:47:34,164 - app.services.file_processor - INFO - Parsed filename (strict): 212223240169, 19AI405
2026-01-04 00:47:34,168 - app.services.file_processor - INFO - Saved file: ./uploads\pending\8ea35c53ba6a4335ba5661c1e49b606c.jpg (hash: 3a00d46e79102899...)
2026-01-04 00:47:34,169 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE examination_artifacts.transaction_id = $1::VARCHAR
2026-01-04 00:47:34,169 - sqlalchemy.engine.Engine - INFO - [cached since 74.01s ago] ('89a533d0edfc3ea69075c828290dbe4f',)
2026-01-04 00:47:34,170 - app.services.artifact_service - WARNING - Duplicate artifact detected: 89a533d0edfc3ea69075c828290dbe4f
2026-01-04 00:47:34,170 - app.services.file_processor - INFO - Parsed filename (strict): 212222020029, 19AI415
2026-01-04 00:47:34,172 - app.services.file_processor - INFO - Saved file: ./uploads\pending\85ac0df4007d43bf949c43aa6a93a6eb.jpg (hash: bf5f59858d0e443c...)
2026-01-04 00:47:34,173 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE examination_artifacts.transaction_id = $1::VARCHAR
2026-01-04 00:47:34,173 - sqlalchemy.engine.Engine - INFO - [cached since 74.01s ago] ('02e03c5eeac40f9d2d9a0219085e0d9a',)
2026-01-04 00:47:34,176 - sqlalchemy.engine.Engine - INFO - INSERT INTO examination_artifacts (artifact_uuid, raw_filename, original_filename, parsed_reg_no, parsed_subject_code, file_blob_path, file_hash, file_size_bytes, mime_type, moodle_user_id, moodle_username, moodle_course_id, moodle_assignment_id, workflow_status, moodle_draft_item_id, moodle_submission_id, lms_transaction_id, transaction_id, validated_at, submit_timestamp, completed_at, uploaded_by_staff_id, submitted_by_user_id, transaction_log, error_message, retry_count) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::BIGINT, $9::VARCHAR, $10::BIGINT, $11::VARCHAR, $12::INTEGER, $13::INTEGER, $14::workflowstatus, $15::BIGINT, $16::VARCHAR, $17::VARCHAR, $18::VARCHAR, $19::TIMESTAMP WITH TIME ZONE, $20::TIMESTAMP WITH TIME ZONE, $21::TIMESTAMP WITH TIME ZONE, $22::INTEGER, $23::BIGINT, $24::JSONB, $25::VARCHAR, $26::INTEGER) RETURNING examination_artifacts.id, examination_artifacts.uploaded_at
2026-01-04 00:47:34,176 - sqlalchemy.engine.Engine - INFO - [generated in 0.00068s] (UUID('f8db74f9-c8dd-4fbf-b8cd-ad42c65aaae6'), '212222020029_19AI415.jpg', '212222020029_19AI415.jpg', '212222020029', '19AI415', './uploads\\pending\\85ac0df4007d43bf949c43aa6a93a6eb.jpg', 'bf5f59858d0e443c1ede0c8ddd6142a0126dccbcdbd0051db3245a71f19a7fe9', 618412, 'image/jpeg', None, None, None, None, 'PENDING', None, None, None, '02e03c5eeac40f9d2d9a0219085e0d9a', None, None, None, 1, None, '[{"timestamp": "2026-01-03T19:17:34.174687", "action": "created", "details": {"filename": "212222020029_19AI415.jpg", "parsed_reg_no": "212222020029", "parsed_subject_code": "19AI415"}}]', None, 0)
2026-01-04 00:47:34,179 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE examination_artifacts.id = $1::INTEGER
2026-01-04 00:47:34,179 - sqlalchemy.engine.Engine - INFO - [generated in 0.00042s] (3,)
2026-01-04 00:47:34,182 - app.services.artifact_service - INFO - Created artifact: f8db74f9-c8dd-4fbf-b8cd-ad42c65aaae6
2026-01-04 00:47:34,183 - sqlalchemy.engine.Engine - INFO - INSERT INTO audit_logs (action, action_category, description, actor_type, actor_id, actor_username, actor_ip, artifact_id, target_type, target_id, request_data, response_data, moodle_api_function, moodle_response_code) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::INTEGER, $9::VARCHAR, $10::VARCHAR, $11::JSONB, $12::JSONB, $13::VARCHAR, $14::INTEGER) RETURNING audit_logs.id, audit_logs.created_at
2026-01-04 00:47:34,183 - sqlalchemy.engine.Engine - INFO - [cached since 74.01s ago] ('bulk_upload', 'upload', 'Bulk upload: 2 successful, 0 failed', 'staff', '1', 'admin', '127.0.0.1', None, None, None, '{"total": 2, "successful": 2, "failed": 0}', 'null', None, None)
2026-01-04 00:47:34,183 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 00:47:37,241 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 00:47:37,241 - sqlalchemy.engine.Engine - INFO - SELECT student_sessions.id, student_sessions.session_id, student_sessions.moodle_user_id, student_sessions.moodle_username, student_sessions.moodle_fullname, student_sessions.encrypted_token, student_sessions.token_expires_at, student_sessions.ip_address, student_sessions.user_agent, student_sessions.created_at, student_sessions.last_activity_at, student_sessions.expires_at 
FROM student_sessions 
WHERE student_sessions.session_id = $1::VARCHAR
2026-01-04 00:47:37,242 - sqlalchemy.engine.Engine - INFO - [cached since 65.97s ago] ('5aVlnHWkiy8kqNewupwiVzFLMMNPh1GofFsBy7cCl5Y',)
2026-01-04 00:47:37,243 - sqlalchemy.engine.Engine - INFO - UPDATE student_sessions SET last_activity_at=$1::TIMESTAMP WITH TIME ZONE WHERE student_sessions.id = $2::INTEGER
2026-01-04 00:47:37,244 - sqlalchemy.engine.Engine - INFO - [cached since 65.97s ago] (datetime.datetime(2026, 1, 3, 19, 17, 37, 243644, tzinfo=datetime.timezone.utc), 3)
2026-01-04 00:47:37,244 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 00:47:37,246 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 00:47:37,247 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE (examination_artifacts.parsed_reg_no = $1::VARCHAR OR examination_artifacts.moodle_username = $2::VARCHAR) AND examination_artifacts.workflow_status IN ($3::workflowstatus, $4::workflowstatus, $5::workflowstatus, $6::workflowstatus) ORDER BY examination_artifacts.uploaded_at DESC
2026-01-04 00:47:37,247 - sqlalchemy.engine.Engine - INFO - [cached since 65.99s ago] ('212222020029', '212222020029', 'PENDING', 'PENDING_REVIEW', 'VALIDATED', 'READY_FOR_REVIEW')
2026-01-04 00:47:37,248 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE examination_artifacts.parsed_reg_no = $1::VARCHAR AND examination_artifacts.workflow_status IN ($2::workflowstatus, $3::workflowstatus) ORDER BY examination_artifacts.submit_timestamp DESC
2026-01-04 00:47:37,248 - sqlalchemy.engine.Engine - INFO - [cached since 65.97s ago] ('212222020029', 'SUBMITTED_TO_LMS', 'COMPLETED')
2026-01-04 00:47:37,249 - sqlalchemy.engine.Engine - INFO - SELECT subject_mappings.id, subject_mappings.subject_code, subject_mappings.subject_name, subject_mappings.moodle_course_id, subject_mappings.moodle_course_idnumber, subject_mappings.moodle_assignment_id, subject_mappings.moodle_assignment_name, subject_mappings.exam_session, subject_mappings.is_active, subject_mappings.created_at, subject_mappings.updated_at, subject_mappings.last_verified_at 
FROM subject_mappings 
WHERE subject_mappings.subject_code = $1::VARCHAR AND subject_mappings.is_active = true
2026-01-04 00:47:37,251 - sqlalchemy.engine.Engine - INFO - [generated in 0.00050s] ('19AI415',)
2026-01-04 00:47:37,253 - sqlalchemy.engine.Engine - INFO - SELECT subject_mappings.id, subject_mappings.subject_code, subject_mappings.subject_name, subject_mappings.moodle_course_id, subject_mappings.moodle_course_idnumber, subject_mappings.moodle_assignment_id, subject_mappings.moodle_assignment_name, subject_mappings.exam_session, subject_mappings.is_active, subject_mappings.created_at, subject_mappings.updated_at, subject_mappings.last_verified_at 
FROM subject_mappings 
WHERE subject_mappings.subject_code = $1::VARCHAR AND subject_mappings.is_active = true
2026-01-04 00:47:37,253 - sqlalchemy.engine.Engine - INFO - [cached since 0.003246s ago] ('19AI415',)
2026-01-04 00:47:37,254 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 00:47:37,262 - app.db.database - ERROR - Database session error: [{'type': 'missing', 'loc': ('header', 'X-Session-ID'), 'msg': 'Field required', 'input': None, 'url': 'https://errors.pydantic.dev/2.5/v/missing'}]
2026-01-04 00:47:43,093 - app.db.database - ERROR - Database session error: [{'type': 'missing', 'loc': ('header', 'X-Session-ID'), 'msg': 'Field required', 'input': None, 'url': 'https://errors.pydantic.dev/2.5/v/missing'}]
2026-01-04 00:49:04,986 - app.db.database - ERROR - Database session error: [{'type': 'missing', 'loc': ('header', 'X-Session-ID'), 'msg': 'Field required', 'input': None, 'url': 'https://errors.pydantic.dev/2.5/v/missing'}]
2026-01-04 00:49:58,951 - app.main - INFO - Shutting down Examination Middleware...
2026-01-04 00:49:58,955 - app.main - INFO - Database connections closed
2026-01-04 00:49:59,929 - app.main - INFO - Starting Examination Middleware...
2026-01-04 00:49:59,976 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2026-01-04 00:49:59,977 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-04 00:49:59,978 - sqlalchemy.engine.Engine - INFO - select current_schema()
2026-01-04 00:49:59,978 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-04 00:49:59,979 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2026-01-04 00:49:59,979 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-04 00:49:59,980 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 00:49:59,983 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:49:59,983 - sqlalchemy.engine.Engine - INFO - [generated in 0.00037s] ('examination_artifacts', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:49:59,987 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:49:59,987 - sqlalchemy.engine.Engine - INFO - [cached since 0.004815s ago] ('subject_mappings', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:49:59,987 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:49:59,988 - sqlalchemy.engine.Engine - INFO - [cached since 0.005983s ago] ('staff_users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:49:59,989 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:49:59,989 - sqlalchemy.engine.Engine - INFO - [cached since 0.007004s ago] ('student_sessions', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:49:59,990 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:49:59,990 - sqlalchemy.engine.Engine - INFO - [cached since 0.007934s ago] ('audit_logs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:49:59,990 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:49:59,990 - sqlalchemy.engine.Engine - INFO - [cached since 0.008757s ago] ('submission_queue', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:49:59,992 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:49:59,992 - sqlalchemy.engine.Engine - INFO - [cached since 0.009554s ago] ('system_config', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:49:59,993 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-01-04 00:49:59,993 - sqlalchemy.engine.Engine - INFO - [generated in 0.00043s] ('workflowstatus', 'pg_catalog')
2026-01-04 00:49:59,994 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 00:49:59,995 - app.main - INFO - Database tables created/verified
2026-01-04 00:49:59,995 - app.main - INFO - Upload directory: D:\LMS-SAE\exam_middleware\uploads
2026-01-04 00:49:59,995 - app.main - INFO - Storage directory: D:\LMS-SAE\exam_middleware\storage
2026-01-04 00:49:59,995 - app.main - INFO - Examination Middleware started successfully
2026-01-04 00:50:03,241 - app.main - INFO - Shutting down Examination Middleware...
2026-01-04 00:50:03,255 - app.main - INFO - Database connections closed
2026-01-04 00:51:18,617 - app.main - INFO - Starting Examination Middleware...
2026-01-04 00:51:18,662 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2026-01-04 00:51:18,662 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-04 00:51:18,663 - sqlalchemy.engine.Engine - INFO - select current_schema()
2026-01-04 00:51:18,663 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-04 00:51:18,664 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2026-01-04 00:51:18,664 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-04 00:51:18,665 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 00:51:18,667 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:51:18,667 - sqlalchemy.engine.Engine - INFO - [generated in 0.00033s] ('examination_artifacts', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:51:18,671 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:51:18,672 - sqlalchemy.engine.Engine - INFO - [cached since 0.004209s ago] ('subject_mappings', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:51:18,672 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:51:18,672 - sqlalchemy.engine.Engine - INFO - [cached since 0.005062s ago] ('staff_users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:51:18,673 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:51:18,673 - sqlalchemy.engine.Engine - INFO - [cached since 0.005858s ago] ('student_sessions', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:51:18,673 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:51:18,674 - sqlalchemy.engine.Engine - INFO - [cached since 0.006755s ago] ('audit_logs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:51:18,675 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:51:18,675 - sqlalchemy.engine.Engine - INFO - [cached since 0.007625s ago] ('submission_queue', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:51:18,675 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:51:18,676 - sqlalchemy.engine.Engine - INFO - [cached since 0.008298s ago] ('system_config', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:51:18,677 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-01-04 00:51:18,677 - sqlalchemy.engine.Engine - INFO - [generated in 0.00024s] ('workflowstatus', 'pg_catalog')
2026-01-04 00:51:18,678 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 00:51:18,678 - app.main - INFO - Database tables created/verified
2026-01-04 00:51:18,678 - app.main - INFO - Upload directory: D:\LMS-SAE\exam_middleware\uploads
2026-01-04 00:51:18,679 - app.main - INFO - Storage directory: D:\LMS-SAE\exam_middleware\storage
2026-01-04 00:51:18,679 - app.main - INFO - Examination Middleware started successfully
2026-01-04 00:51:29,347 - app.api.routes.auth - INFO - Authenticating student: 23004568
2026-01-04 00:51:29,547 - app.services.moodle_client - INFO - Authenticating user: 23004568
2026-01-04 00:51:29,550 - httpcore.connection - DEBUG - connect_tcp.started host='183a70678909.ngrok-free.app' port=443 local_address=None timeout=30.0 socket_options=None
2026-01-04 00:51:29,618 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001C13EF39C90>
2026-01-04 00:51:29,618 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000001C13EDB2BA0> server_hostname='183a70678909.ngrok-free.app' timeout=30.0
2026-01-04 00:51:29,677 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001C13EEBEB10>
2026-01-04 00:51:29,678 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-01-04 00:51:29,678 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-01-04 00:51:29,678 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-01-04 00:51:29,679 - httpcore.http11 - DEBUG - send_request_body.complete
2026-01-04 00:51:29,679 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-01-04 00:51:30,039 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Accept-Ranges', b'none'), (b'Access-Control-Allow-Origin', b'*'), (b'Cache-Control', b'no-store, no-cache, must-revalidate'), (b'Cache-Control', b'post-check=0, pre-check=0'), (b'Content-Length', b'126'), (b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Sat, 03 Jan 2026 19:21:29 GMT'), (b'Expires', b'Mon, 20 Aug 1969 09:23:00 GMT'), (b'Last-Modified', b'Sat, 03 Jan 2026 19:21:29 GMT'), (b'Ngrok-Agent-Ips', b'2406:7400:3b:ec84:45c4:688:4cd7:ce08'), (b'Pragma', b'no-cache'), (b'Server', b'Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.2.4'), (b'X-Powered-By', b'PHP/8.2.4')])
2026-01-04 00:51:30,040 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-01-04 00:51:30,040 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-01-04 00:51:30,040 - httpcore.http11 - DEBUG - response_closed.started
2026-01-04 00:51:30,040 - httpcore.http11 - DEBUG - response_closed.complete
2026-01-04 00:51:30,042 - app.services.moodle_client - INFO - Successfully authenticated user: 23004568
2026-01-04 00:51:30,043 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-01-04 00:51:30,043 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-01-04 00:51:30,043 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-01-04 00:51:30,043 - httpcore.http11 - DEBUG - send_request_body.complete
2026-01-04 00:51:30,043 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-01-04 00:51:30,413 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Accept-Ranges', b'none'), (b'Access-Control-Allow-Origin', b'*'), (b'Cache-Control', b'private, must-revalidate, pre-check=0, post-check=0, max-age=0'), (b'Content-Type', b'application/json'), (b'Date', b'Sat, 03 Jan 2026 19:21:30 GMT'), (b'Expires', b'Thu, 01 Jan 1970 00:00:00 GMT'), (b'Ngrok-Agent-Ips', b'2406:7400:3b:ec84:45c4:688:4cd7:ce08'), (b'Pragma', b'no-cache'), (b'Server', b'Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.2.4'), (b'X-Powered-By', b'PHP/8.2.4'), (b'Transfer-Encoding', b'chunked')])
2026-01-04 00:51:30,413 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-01-04 00:51:30,465 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-01-04 00:51:30,465 - httpcore.http11 - DEBUG - response_closed.started
2026-01-04 00:51:30,466 - httpcore.http11 - DEBUG - response_closed.complete
2026-01-04 00:51:30,466 - app.services.moodle_client - INFO - Got site info for user: 23004568
2026-01-04 00:51:30,475 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 00:51:30,476 - sqlalchemy.engine.Engine - INFO - INSERT INTO student_sessions (session_id, moodle_user_id, moodle_username, moodle_fullname, encrypted_token, token_expires_at, ip_address, user_agent, expires_at) VALUES ($1::VARCHAR, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::TIMESTAMP WITH TIME ZONE, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITH TIME ZONE) RETURNING student_sessions.id, student_sessions.created_at, student_sessions.last_activity_at
2026-01-04 00:51:30,477 - sqlalchemy.engine.Engine - INFO - [generated in 0.00036s] ('1P5-Q6AgeDavbfdbvrb6FhvWjHre_gbe8vVx2-ZTWWc', 5, '23004568', 'Santhan Kumar 212222020029', 'Z0FBQUFBQnBXV3c2bWx5V1BPclFoWWRsbURvSXo2REFUMzZrcWs3RFhoZWcyc3dZYWlIaEFVVzRFcTExUG1oVnJhalJYN04xbVloXzRtMlJPbVhCOXItekRMenlRVXFVSlpwLXU5c2pYbl9sNnlfa1ozREFfaFBWU09ZdG1TV1VvVV94N0g5b2pzTXU=', None, '127.0.0.1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36', datetime.datetime(2026, 1, 3, 20, 21, 30, 466633, tzinfo=datetime.timezone.utc))
2026-01-04 00:51:30,479 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 00:51:30,481 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 00:51:30,483 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE (examination_artifacts.parsed_reg_no = $1::VARCHAR OR examination_artifacts.moodle_username = $2::VARCHAR) AND examination_artifacts.workflow_status IN ($3::workflowstatus, $4::workflowstatus, $5::workflowstatus, $6::workflowstatus) ORDER BY examination_artifacts.uploaded_at DESC
2026-01-04 00:51:30,483 - sqlalchemy.engine.Engine - INFO - [generated in 0.00056s] ('212222020029', '212222020029', 'PENDING', 'PENDING_REVIEW', 'VALIDATED', 'READY_FOR_REVIEW')
2026-01-04 00:51:30,495 - app.api.routes.auth - INFO - Student 23004568 (reg: 212222020029) logged in. Pending papers: 1
2026-01-04 00:51:30,496 - httpcore.connection - DEBUG - close.started
2026-01-04 00:51:30,496 - httpcore.connection - DEBUG - close.complete
2026-01-04 00:51:30,497 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 00:51:30,500 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 00:51:30,501 - sqlalchemy.engine.Engine - INFO - SELECT student_sessions.id, student_sessions.session_id, student_sessions.moodle_user_id, student_sessions.moodle_username, student_sessions.moodle_fullname, student_sessions.encrypted_token, student_sessions.token_expires_at, student_sessions.ip_address, student_sessions.user_agent, student_sessions.created_at, student_sessions.last_activity_at, student_sessions.expires_at 
FROM student_sessions 
WHERE student_sessions.session_id = $1::VARCHAR
2026-01-04 00:51:30,501 - sqlalchemy.engine.Engine - INFO - [generated in 0.00034s] ('1P5-Q6AgeDavbfdbvrb6FhvWjHre_gbe8vVx2-ZTWWc',)
2026-01-04 00:51:30,504 - sqlalchemy.engine.Engine - INFO - UPDATE student_sessions SET last_activity_at=$1::TIMESTAMP WITH TIME ZONE WHERE student_sessions.id = $2::INTEGER
2026-01-04 00:51:30,505 - sqlalchemy.engine.Engine - INFO - [generated in 0.00031s] (datetime.datetime(2026, 1, 3, 19, 21, 30, 504166, tzinfo=datetime.timezone.utc), 4)
2026-01-04 00:51:30,505 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 00:51:30,507 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 00:51:30,508 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE (examination_artifacts.parsed_reg_no = $1::VARCHAR OR examination_artifacts.moodle_username = $2::VARCHAR) AND examination_artifacts.workflow_status IN ($3::workflowstatus, $4::workflowstatus, $5::workflowstatus, $6::workflowstatus) ORDER BY examination_artifacts.uploaded_at DESC
2026-01-04 00:51:30,509 - sqlalchemy.engine.Engine - INFO - [cached since 0.0243s ago] ('212222020029', '212222020029', 'PENDING', 'PENDING_REVIEW', 'VALIDATED', 'READY_FOR_REVIEW')
2026-01-04 00:51:30,510 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE examination_artifacts.parsed_reg_no = $1::VARCHAR AND examination_artifacts.workflow_status IN ($2::workflowstatus, $3::workflowstatus) ORDER BY examination_artifacts.submit_timestamp DESC
2026-01-04 00:51:30,510 - sqlalchemy.engine.Engine - INFO - [generated in 0.00052s] ('212222020029', 'SUBMITTED_TO_LMS', 'COMPLETED')
2026-01-04 00:51:30,513 - sqlalchemy.engine.Engine - INFO - SELECT subject_mappings.id, subject_mappings.subject_code, subject_mappings.subject_name, subject_mappings.moodle_course_id, subject_mappings.moodle_course_idnumber, subject_mappings.moodle_assignment_id, subject_mappings.moodle_assignment_name, subject_mappings.exam_session, subject_mappings.is_active, subject_mappings.created_at, subject_mappings.updated_at, subject_mappings.last_verified_at 
FROM subject_mappings 
WHERE subject_mappings.subject_code = $1::VARCHAR AND subject_mappings.is_active = true
2026-01-04 00:51:30,513 - sqlalchemy.engine.Engine - INFO - [generated in 0.00033s] ('19AI415',)
2026-01-04 00:51:30,516 - sqlalchemy.engine.Engine - INFO - SELECT subject_mappings.id, subject_mappings.subject_code, subject_mappings.subject_name, subject_mappings.moodle_course_id, subject_mappings.moodle_course_idnumber, subject_mappings.moodle_assignment_id, subject_mappings.moodle_assignment_name, subject_mappings.exam_session, subject_mappings.is_active, subject_mappings.created_at, subject_mappings.updated_at, subject_mappings.last_verified_at 
FROM subject_mappings 
WHERE subject_mappings.subject_code = $1::VARCHAR AND subject_mappings.is_active = true
2026-01-04 00:51:30,516 - sqlalchemy.engine.Engine - INFO - [generated in 0.00036s] ('19AI415',)
2026-01-04 00:51:30,517 - app.services.subject_discovery_service - WARNING - [NOT FOUND] No mapping found for subject code: 19AI415
2026-01-04 00:51:30,518 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 00:51:30,521 - app.db.database - ERROR - Database session error: [{'type': 'missing', 'loc': ('header', 'X-Session-ID'), 'msg': 'Field required', 'input': None, 'url': 'https://errors.pydantic.dev/2.5/v/missing'}]
2026-01-04 00:51:32,306 - app.db.database - ERROR - Database session error: [{'type': 'missing', 'loc': ('header', 'X-Session-ID'), 'msg': 'Field required', 'input': None, 'url': 'https://errors.pydantic.dev/2.5/v/missing'}]
2026-01-04 00:51:35,239 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 00:51:35,239 - sqlalchemy.engine.Engine - INFO - SELECT student_sessions.id, student_sessions.session_id, student_sessions.moodle_user_id, student_sessions.moodle_username, student_sessions.moodle_fullname, student_sessions.encrypted_token, student_sessions.token_expires_at, student_sessions.ip_address, student_sessions.user_agent, student_sessions.created_at, student_sessions.last_activity_at, student_sessions.expires_at 
FROM student_sessions 
WHERE student_sessions.session_id = $1::VARCHAR
2026-01-04 00:51:35,239 - sqlalchemy.engine.Engine - INFO - [cached since 4.739s ago] ('1P5-Q6AgeDavbfdbvrb6FhvWjHre_gbe8vVx2-ZTWWc',)
2026-01-04 00:51:35,241 - sqlalchemy.engine.Engine - INFO - UPDATE student_sessions SET last_activity_at=$1::TIMESTAMP WITH TIME ZONE WHERE student_sessions.id = $2::INTEGER
2026-01-04 00:51:35,242 - sqlalchemy.engine.Engine - INFO - [cached since 4.737s ago] (datetime.datetime(2026, 1, 3, 19, 21, 35, 241388, tzinfo=datetime.timezone.utc), 4)
2026-01-04 00:51:35,242 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 00:51:35,243 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 00:51:35,244 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE (examination_artifacts.parsed_reg_no = $1::VARCHAR OR examination_artifacts.moodle_username = $2::VARCHAR) AND examination_artifacts.workflow_status IN ($3::workflowstatus, $4::workflowstatus, $5::workflowstatus, $6::workflowstatus) ORDER BY examination_artifacts.uploaded_at DESC
2026-01-04 00:51:35,244 - sqlalchemy.engine.Engine - INFO - [cached since 4.76s ago] ('212222020029', '212222020029', 'PENDING', 'PENDING_REVIEW', 'VALIDATED', 'READY_FOR_REVIEW')
2026-01-04 00:51:35,246 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE examination_artifacts.parsed_reg_no = $1::VARCHAR AND examination_artifacts.workflow_status IN ($2::workflowstatus, $3::workflowstatus) ORDER BY examination_artifacts.submit_timestamp DESC
2026-01-04 00:51:35,247 - sqlalchemy.engine.Engine - INFO - [cached since 4.737s ago] ('212222020029', 'SUBMITTED_TO_LMS', 'COMPLETED')
2026-01-04 00:51:35,248 - sqlalchemy.engine.Engine - INFO - SELECT subject_mappings.id, subject_mappings.subject_code, subject_mappings.subject_name, subject_mappings.moodle_course_id, subject_mappings.moodle_course_idnumber, subject_mappings.moodle_assignment_id, subject_mappings.moodle_assignment_name, subject_mappings.exam_session, subject_mappings.is_active, subject_mappings.created_at, subject_mappings.updated_at, subject_mappings.last_verified_at 
FROM subject_mappings 
WHERE subject_mappings.subject_code = $1::VARCHAR AND subject_mappings.is_active = true
2026-01-04 00:51:35,248 - sqlalchemy.engine.Engine - INFO - [cached since 4.735s ago] ('19AI415',)
2026-01-04 00:51:35,249 - sqlalchemy.engine.Engine - INFO - SELECT subject_mappings.id, subject_mappings.subject_code, subject_mappings.subject_name, subject_mappings.moodle_course_id, subject_mappings.moodle_course_idnumber, subject_mappings.moodle_assignment_id, subject_mappings.moodle_assignment_name, subject_mappings.exam_session, subject_mappings.is_active, subject_mappings.created_at, subject_mappings.updated_at, subject_mappings.last_verified_at 
FROM subject_mappings 
WHERE subject_mappings.subject_code = $1::VARCHAR AND subject_mappings.is_active = true
2026-01-04 00:51:35,249 - sqlalchemy.engine.Engine - INFO - [cached since 4.734s ago] ('19AI415',)
2026-01-04 00:51:35,250 - app.services.subject_discovery_service - WARNING - [NOT FOUND] No mapping found for subject code: 19AI415
2026-01-04 00:51:35,250 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 00:51:35,258 - app.db.database - ERROR - Database session error: [{'type': 'missing', 'loc': ('header', 'X-Session-ID'), 'msg': 'Field required', 'input': None, 'url': 'https://errors.pydantic.dev/2.5/v/missing'}]
2026-01-04 00:51:36,725 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 00:51:36,726 - sqlalchemy.engine.Engine - INFO - SELECT student_sessions.id, student_sessions.session_id, student_sessions.moodle_user_id, student_sessions.moodle_username, student_sessions.moodle_fullname, student_sessions.encrypted_token, student_sessions.token_expires_at, student_sessions.ip_address, student_sessions.user_agent, student_sessions.created_at, student_sessions.last_activity_at, student_sessions.expires_at 
FROM student_sessions 
WHERE student_sessions.session_id = $1::VARCHAR
2026-01-04 00:51:36,726 - sqlalchemy.engine.Engine - INFO - [cached since 6.225s ago] ('1P5-Q6AgeDavbfdbvrb6FhvWjHre_gbe8vVx2-ZTWWc',)
2026-01-04 00:51:36,727 - sqlalchemy.engine.Engine - INFO - UPDATE student_sessions SET last_activity_at=$1::TIMESTAMP WITH TIME ZONE WHERE student_sessions.id = $2::INTEGER
2026-01-04 00:51:36,728 - sqlalchemy.engine.Engine - INFO - [cached since 6.223s ago] (datetime.datetime(2026, 1, 3, 19, 21, 36, 727275, tzinfo=datetime.timezone.utc), 4)
2026-01-04 00:51:36,729 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 00:51:36,731 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 00:51:36,732 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE (examination_artifacts.parsed_reg_no = $1::VARCHAR OR examination_artifacts.moodle_username = $2::VARCHAR) AND examination_artifacts.workflow_status IN ($3::workflowstatus, $4::workflowstatus, $5::workflowstatus, $6::workflowstatus) ORDER BY examination_artifacts.uploaded_at DESC
2026-01-04 00:51:36,732 - sqlalchemy.engine.Engine - INFO - [cached since 6.248s ago] ('212222020029', '212222020029', 'PENDING', 'PENDING_REVIEW', 'VALIDATED', 'READY_FOR_REVIEW')
2026-01-04 00:51:36,735 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE examination_artifacts.parsed_reg_no = $1::VARCHAR AND examination_artifacts.workflow_status IN ($2::workflowstatus, $3::workflowstatus) ORDER BY examination_artifacts.submit_timestamp DESC
2026-01-04 00:51:36,735 - sqlalchemy.engine.Engine - INFO - [cached since 6.225s ago] ('212222020029', 'SUBMITTED_TO_LMS', 'COMPLETED')
2026-01-04 00:51:36,737 - sqlalchemy.engine.Engine - INFO - SELECT subject_mappings.id, subject_mappings.subject_code, subject_mappings.subject_name, subject_mappings.moodle_course_id, subject_mappings.moodle_course_idnumber, subject_mappings.moodle_assignment_id, subject_mappings.moodle_assignment_name, subject_mappings.exam_session, subject_mappings.is_active, subject_mappings.created_at, subject_mappings.updated_at, subject_mappings.last_verified_at 
FROM subject_mappings 
WHERE subject_mappings.subject_code = $1::VARCHAR AND subject_mappings.is_active = true
2026-01-04 00:51:36,737 - sqlalchemy.engine.Engine - INFO - [cached since 6.224s ago] ('19AI415',)
2026-01-04 00:51:36,738 - sqlalchemy.engine.Engine - INFO - SELECT subject_mappings.id, subject_mappings.subject_code, subject_mappings.subject_name, subject_mappings.moodle_course_id, subject_mappings.moodle_course_idnumber, subject_mappings.moodle_assignment_id, subject_mappings.moodle_assignment_name, subject_mappings.exam_session, subject_mappings.is_active, subject_mappings.created_at, subject_mappings.updated_at, subject_mappings.last_verified_at 
FROM subject_mappings 
WHERE subject_mappings.subject_code = $1::VARCHAR AND subject_mappings.is_active = true
2026-01-04 00:51:36,739 - sqlalchemy.engine.Engine - INFO - [cached since 6.223s ago] ('19AI415',)
2026-01-04 00:51:36,739 - app.services.subject_discovery_service - WARNING - [NOT FOUND] No mapping found for subject code: 19AI415
2026-01-04 00:51:36,740 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 00:51:36,747 - app.db.database - ERROR - Database session error: [{'type': 'missing', 'loc': ('header', 'X-Session-ID'), 'msg': 'Field required', 'input': None, 'url': 'https://errors.pydantic.dev/2.5/v/missing'}]
2026-01-04 00:51:53,064 - app.db.database - ERROR - Database session error: [{'type': 'missing', 'loc': ('header', 'X-Session-ID'), 'msg': 'Field required', 'input': None, 'url': 'https://errors.pydantic.dev/2.5/v/missing'}]
2026-01-04 00:53:49,208 - app.main - INFO - Shutting down Examination Middleware...
2026-01-04 00:53:49,210 - app.main - INFO - Database connections closed
2026-01-04 00:53:50,296 - app.main - INFO - Starting Examination Middleware...
2026-01-04 00:53:50,345 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2026-01-04 00:53:50,345 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-04 00:53:50,346 - sqlalchemy.engine.Engine - INFO - select current_schema()
2026-01-04 00:53:50,346 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-04 00:53:50,347 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2026-01-04 00:53:50,347 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-04 00:53:50,348 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 00:53:50,350 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:53:50,350 - sqlalchemy.engine.Engine - INFO - [generated in 0.00034s] ('examination_artifacts', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:53:50,353 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:53:50,354 - sqlalchemy.engine.Engine - INFO - [cached since 0.003791s ago] ('subject_mappings', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:53:50,354 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:53:50,354 - sqlalchemy.engine.Engine - INFO - [cached since 0.004509s ago] ('staff_users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:53:50,355 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:53:50,355 - sqlalchemy.engine.Engine - INFO - [cached since 0.005259s ago] ('student_sessions', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:53:50,356 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:53:50,356 - sqlalchemy.engine.Engine - INFO - [cached since 0.006033s ago] ('audit_logs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:53:50,357 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:53:50,357 - sqlalchemy.engine.Engine - INFO - [cached since 0.006844s ago] ('submission_queue', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:53:50,357 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:53:50,357 - sqlalchemy.engine.Engine - INFO - [cached since 0.007641s ago] ('system_config', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:53:50,359 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-01-04 00:53:50,359 - sqlalchemy.engine.Engine - INFO - [generated in 0.00028s] ('workflowstatus', 'pg_catalog')
2026-01-04 00:53:50,360 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 00:53:50,360 - app.main - INFO - Database tables created/verified
2026-01-04 00:53:50,361 - app.main - INFO - Upload directory: D:\LMS-SAE\exam_middleware\uploads
2026-01-04 00:53:50,361 - app.main - INFO - Storage directory: D:\LMS-SAE\exam_middleware\storage
2026-01-04 00:53:50,361 - app.main - INFO - Examination Middleware started successfully
2026-01-04 00:56:09,305 - app.main - INFO - Shutting down Examination Middleware...
2026-01-04 00:56:09,309 - app.main - INFO - Database connections closed
2026-01-04 00:56:10,302 - app.main - INFO - Starting Examination Middleware...
2026-01-04 00:56:11,359 - app.main - INFO - Starting Examination Middleware...
2026-01-04 00:56:11,404 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2026-01-04 00:56:11,404 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-04 00:56:11,405 - sqlalchemy.engine.Engine - INFO - select current_schema()
2026-01-04 00:56:11,405 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-04 00:56:11,407 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2026-01-04 00:56:11,407 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-04 00:56:11,408 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 00:56:11,410 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:56:11,410 - sqlalchemy.engine.Engine - INFO - [generated in 0.00040s] ('examination_artifacts', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:56:11,413 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:56:11,414 - sqlalchemy.engine.Engine - INFO - [cached since 0.004002s ago] ('subject_mappings', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:56:11,414 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:56:11,415 - sqlalchemy.engine.Engine - INFO - [cached since 0.004803s ago] ('staff_users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:56:11,415 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:56:11,415 - sqlalchemy.engine.Engine - INFO - [cached since 0.005685s ago] ('student_sessions', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:56:11,416 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:56:11,416 - sqlalchemy.engine.Engine - INFO - [cached since 0.006377s ago] ('audit_logs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:56:11,416 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:56:11,417 - sqlalchemy.engine.Engine - INFO - [cached since 0.007149s ago] ('submission_queue', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:56:11,417 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:56:11,417 - sqlalchemy.engine.Engine - INFO - [cached since 0.007839s ago] ('system_config', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:56:11,419 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-01-04 00:56:11,419 - sqlalchemy.engine.Engine - INFO - [generated in 0.00031s] ('workflowstatus', 'pg_catalog')
2026-01-04 00:56:11,420 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 00:56:11,420 - app.main - INFO - Database tables created/verified
2026-01-04 00:56:11,420 - app.main - INFO - Upload directory: D:\LMS-SAE\exam_middleware\uploads
2026-01-04 00:56:11,420 - app.main - INFO - Storage directory: D:\LMS-SAE\exam_middleware\storage
2026-01-04 00:56:11,420 - app.main - INFO - Examination Middleware started successfully
2026-01-04 00:56:19,160 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 00:56:19,170 - sqlalchemy.engine.Engine - INFO - SELECT student_sessions.id, student_sessions.session_id, student_sessions.moodle_user_id, student_sessions.moodle_username, student_sessions.moodle_fullname, student_sessions.encrypted_token, student_sessions.token_expires_at, student_sessions.ip_address, student_sessions.user_agent, student_sessions.created_at, student_sessions.last_activity_at, student_sessions.expires_at 
FROM student_sessions 
WHERE student_sessions.session_id = $1::VARCHAR
2026-01-04 00:56:19,171 - sqlalchemy.engine.Engine - INFO - [generated in 0.00046s] ('1P5-Q6AgeDavbfdbvrb6FhvWjHre_gbe8vVx2-ZTWWc',)
2026-01-04 00:56:19,174 - sqlalchemy.engine.Engine - INFO - UPDATE student_sessions SET last_activity_at=$1::TIMESTAMP WITH TIME ZONE WHERE student_sessions.id = $2::INTEGER
2026-01-04 00:56:19,174 - sqlalchemy.engine.Engine - INFO - [generated in 0.00028s] (datetime.datetime(2026, 1, 3, 19, 26, 19, 173099, tzinfo=datetime.timezone.utc), 4)
2026-01-04 00:56:19,176 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 00:56:19,177 - app.api.routes.student - WARNING - [Dashboard] Failed to decrypt Moodle token: 'StudentSession' object has no attribute 'encrypted_moodle_token'
2026-01-04 00:56:19,178 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 00:56:19,180 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE (examination_artifacts.parsed_reg_no = $1::VARCHAR OR examination_artifacts.moodle_username = $2::VARCHAR) AND examination_artifacts.workflow_status IN ($3::workflowstatus, $4::workflowstatus, $5::workflowstatus, $6::workflowstatus) ORDER BY examination_artifacts.uploaded_at DESC
2026-01-04 00:56:19,180 - sqlalchemy.engine.Engine - INFO - [generated in 0.00051s] ('212222020029', '212222020029', 'PENDING', 'PENDING_REVIEW', 'VALIDATED', 'READY_FOR_REVIEW')
2026-01-04 00:56:19,190 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE examination_artifacts.parsed_reg_no = $1::VARCHAR AND examination_artifacts.workflow_status IN ($2::workflowstatus, $3::workflowstatus) ORDER BY examination_artifacts.submit_timestamp DESC
2026-01-04 00:56:19,190 - sqlalchemy.engine.Engine - INFO - [generated in 0.00043s] ('212222020029', 'SUBMITTED_TO_LMS', 'COMPLETED')
2026-01-04 00:56:19,194 - sqlalchemy.engine.Engine - INFO - SELECT subject_mappings.id, subject_mappings.subject_code, subject_mappings.subject_name, subject_mappings.moodle_course_id, subject_mappings.moodle_course_idnumber, subject_mappings.moodle_assignment_id, subject_mappings.moodle_assignment_name, subject_mappings.exam_session, subject_mappings.is_active, subject_mappings.created_at, subject_mappings.updated_at, subject_mappings.last_verified_at 
FROM subject_mappings 
WHERE subject_mappings.subject_code = $1::VARCHAR AND subject_mappings.is_active = true
2026-01-04 00:56:19,194 - sqlalchemy.engine.Engine - INFO - [generated in 0.00036s] ('19AI415',)
2026-01-04 00:56:19,196 - sqlalchemy.engine.Engine - INFO - SELECT subject_mappings.id, subject_mappings.subject_code, subject_mappings.subject_name, subject_mappings.moodle_course_id, subject_mappings.moodle_course_idnumber, subject_mappings.moodle_assignment_id, subject_mappings.moodle_assignment_name, subject_mappings.exam_session, subject_mappings.is_active, subject_mappings.created_at, subject_mappings.updated_at, subject_mappings.last_verified_at 
FROM subject_mappings 
WHERE subject_mappings.subject_code = $1::VARCHAR AND subject_mappings.is_active = true
2026-01-04 00:56:19,196 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] ('19AI415',)
2026-01-04 00:56:19,197 - app.services.subject_discovery_service - WARNING - [Layer 3] SKIPPED - No user token available for 19AI415
2026-01-04 00:56:19,197 - app.services.subject_discovery_service - INFO - [Layer 4] Checking config fallback for 19AI415
2026-01-04 00:56:19,197 - app.services.subject_discovery_service - ERROR - [NOT FOUND] No mapping found for subject code: 19AI415 after checking ALL layers
2026-01-04 00:56:19,197 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 00:56:19,200 - app.db.database - ERROR - Database session error: [{'type': 'missing', 'loc': ('header', 'X-Session-ID'), 'msg': 'Field required', 'input': None, 'url': 'https://errors.pydantic.dev/2.5/v/missing'}]
2026-01-04 00:56:24,619 - app.db.database - ERROR - Database session error: [{'type': 'missing', 'loc': ('header', 'X-Session-ID'), 'msg': 'Field required', 'input': None, 'url': 'https://errors.pydantic.dev/2.5/v/missing'}]
2026-01-04 00:59:11,288 - app.main - INFO - Shutting down Examination Middleware...
2026-01-04 00:59:11,299 - app.main - INFO - Database connections closed
2026-01-04 00:59:12,232 - app.main - INFO - Starting Examination Middleware...
2026-01-04 00:59:12,277 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2026-01-04 00:59:12,278 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-04 00:59:12,279 - sqlalchemy.engine.Engine - INFO - select current_schema()
2026-01-04 00:59:12,279 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-04 00:59:12,280 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2026-01-04 00:59:12,280 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-04 00:59:12,281 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 00:59:12,283 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:59:12,283 - sqlalchemy.engine.Engine - INFO - [generated in 0.00034s] ('examination_artifacts', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:59:12,286 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:59:12,286 - sqlalchemy.engine.Engine - INFO - [cached since 0.003718s ago] ('subject_mappings', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:59:12,287 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:59:12,287 - sqlalchemy.engine.Engine - INFO - [cached since 0.004553s ago] ('staff_users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:59:12,287 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:59:12,288 - sqlalchemy.engine.Engine - INFO - [cached since 0.005392s ago] ('student_sessions', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:59:12,288 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:59:12,288 - sqlalchemy.engine.Engine - INFO - [cached since 0.00617s ago] ('audit_logs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:59:12,289 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:59:12,289 - sqlalchemy.engine.Engine - INFO - [cached since 0.006988s ago] ('submission_queue', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:59:12,290 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 00:59:12,290 - sqlalchemy.engine.Engine - INFO - [cached since 0.00771s ago] ('system_config', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 00:59:12,290 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-01-04 00:59:12,292 - sqlalchemy.engine.Engine - INFO - [generated in 0.00035s] ('workflowstatus', 'pg_catalog')
2026-01-04 00:59:12,292 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 00:59:12,293 - app.main - INFO - Database tables created/verified
2026-01-04 00:59:12,293 - app.main - INFO - Upload directory: D:\LMS-SAE\exam_middleware\uploads
2026-01-04 00:59:12,293 - app.main - INFO - Storage directory: D:\LMS-SAE\exam_middleware\storage
2026-01-04 00:59:12,294 - app.main - INFO - Examination Middleware started successfully
2026-01-04 00:59:20,371 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 00:59:20,379 - sqlalchemy.engine.Engine - INFO - SELECT student_sessions.id, student_sessions.session_id, student_sessions.moodle_user_id, student_sessions.moodle_username, student_sessions.moodle_fullname, student_sessions.encrypted_token, student_sessions.token_expires_at, student_sessions.ip_address, student_sessions.user_agent, student_sessions.created_at, student_sessions.last_activity_at, student_sessions.expires_at 
FROM student_sessions 
WHERE student_sessions.session_id = $1::VARCHAR
2026-01-04 00:59:20,379 - sqlalchemy.engine.Engine - INFO - [generated in 0.00048s] ('1P5-Q6AgeDavbfdbvrb6FhvWjHre_gbe8vVx2-ZTWWc',)
2026-01-04 00:59:20,383 - sqlalchemy.engine.Engine - INFO - UPDATE student_sessions SET last_activity_at=$1::TIMESTAMP WITH TIME ZONE WHERE student_sessions.id = $2::INTEGER
2026-01-04 00:59:20,383 - sqlalchemy.engine.Engine - INFO - [generated in 0.00056s] (datetime.datetime(2026, 1, 3, 19, 29, 20, 382582, tzinfo=datetime.timezone.utc), 4)
2026-01-04 00:59:20,385 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 00:59:20,388 - app.api.routes.student - INFO - [Dashboard] Decrypted user token for dynamic discovery (length: 32)
2026-01-04 00:59:20,390 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 00:59:20,393 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE (examination_artifacts.parsed_reg_no = $1::VARCHAR OR examination_artifacts.moodle_username = $2::VARCHAR) AND examination_artifacts.workflow_status IN ($3::workflowstatus, $4::workflowstatus, $5::workflowstatus, $6::workflowstatus) ORDER BY examination_artifacts.uploaded_at DESC
2026-01-04 00:59:20,394 - sqlalchemy.engine.Engine - INFO - [generated in 0.00070s] ('212222020029', '212222020029', 'PENDING', 'PENDING_REVIEW', 'VALIDATED', 'READY_FOR_REVIEW')
2026-01-04 00:59:20,411 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE examination_artifacts.parsed_reg_no = $1::VARCHAR AND examination_artifacts.workflow_status IN ($2::workflowstatus, $3::workflowstatus) ORDER BY examination_artifacts.submit_timestamp DESC
2026-01-04 00:59:20,411 - sqlalchemy.engine.Engine - INFO - [generated in 0.00083s] ('212222020029', 'SUBMITTED_TO_LMS', 'COMPLETED')
2026-01-04 00:59:20,416 - sqlalchemy.engine.Engine - INFO - SELECT subject_mappings.id, subject_mappings.subject_code, subject_mappings.subject_name, subject_mappings.moodle_course_id, subject_mappings.moodle_course_idnumber, subject_mappings.moodle_assignment_id, subject_mappings.moodle_assignment_name, subject_mappings.exam_session, subject_mappings.is_active, subject_mappings.created_at, subject_mappings.updated_at, subject_mappings.last_verified_at 
FROM subject_mappings 
WHERE subject_mappings.subject_code = $1::VARCHAR AND subject_mappings.is_active = true
2026-01-04 00:59:20,416 - sqlalchemy.engine.Engine - INFO - [generated in 0.00052s] ('19AI415',)
2026-01-04 00:59:20,420 - sqlalchemy.engine.Engine - INFO - SELECT subject_mappings.id, subject_mappings.subject_code, subject_mappings.subject_name, subject_mappings.moodle_course_id, subject_mappings.moodle_course_idnumber, subject_mappings.moodle_assignment_id, subject_mappings.moodle_assignment_name, subject_mappings.exam_session, subject_mappings.is_active, subject_mappings.created_at, subject_mappings.updated_at, subject_mappings.last_verified_at 
FROM subject_mappings 
WHERE subject_mappings.subject_code = $1::VARCHAR AND subject_mappings.is_active = true
2026-01-04 00:59:20,420 - sqlalchemy.engine.Engine - INFO - [generated in 0.00051s] ('19AI415',)
2026-01-04 00:59:20,422 - app.services.subject_discovery_service - INFO - [Layer 3] Attempting Moodle discovery for 19AI415 with token...
2026-01-04 00:59:20,422 - app.services.subject_discovery_service - INFO - [Discovery] Starting Moodle discovery for subject: 19AI415
2026-01-04 00:59:20,658 - httpcore.connection - DEBUG - connect_tcp.started host='183a70678909.ngrok-free.app' port=443 local_address=None timeout=30.0 socket_options=None
2026-01-04 00:59:20,826 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000022D4071DA50>
2026-01-04 00:59:20,826 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000022D408629F0> server_hostname='183a70678909.ngrok-free.app' timeout=30.0
2026-01-04 00:59:20,969 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000022D40723290>
2026-01-04 00:59:20,969 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-01-04 00:59:20,969 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-01-04 00:59:20,970 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-01-04 00:59:20,970 - httpcore.http11 - DEBUG - send_request_body.complete
2026-01-04 00:59:20,970 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-01-04 00:59:21,466 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Accept-Ranges', b'none'), (b'Access-Control-Allow-Origin', b'*'), (b'Cache-Control', b'private, must-revalidate, pre-check=0, post-check=0, max-age=0'), (b'Content-Type', b'application/json'), (b'Date', b'Sat, 03 Jan 2026 19:29:21 GMT'), (b'Expires', b'Thu, 01 Jan 1970 00:00:00 GMT'), (b'Ngrok-Agent-Ips', b'2406:7400:3b:ec84:45c4:688:4cd7:ce08'), (b'Pragma', b'no-cache'), (b'Server', b'Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.2.4'), (b'X-Powered-By', b'PHP/8.2.4'), (b'Transfer-Encoding', b'chunked')])
2026-01-04 00:59:21,467 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-01-04 00:59:26,521 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-01-04 00:59:26,521 - httpcore.http11 - DEBUG - response_closed.started
2026-01-04 00:59:26,522 - httpcore.http11 - DEBUG - response_closed.complete
2026-01-04 00:59:26,522 - app.services.moodle_client - INFO - Got site info for user: 23004568
2026-01-04 00:59:26,522 - app.services.subject_discovery_service - INFO - [Discovery] User ID: 5, Username: 23004568
2026-01-04 00:59:26,523 - app.services.subject_discovery_service - ERROR - [Discovery] Unexpected error: 'MoodleClient' object has no attribute 'get_user_courses'
Traceback (most recent call last):
  File "D:\LMS-SAE\exam_middleware\app\services\subject_discovery_service.py", line 195, in _discover_from_moodle
    courses = await client.get_user_courses(user_id=user_id, token=token)
                    ^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'MoodleClient' object has no attribute 'get_user_courses'
2026-01-04 00:59:26,523 - httpcore.connection - DEBUG - close.started
2026-01-04 00:59:26,523 - httpcore.connection - DEBUG - close.complete
2026-01-04 00:59:26,523 - app.services.subject_discovery_service - WARNING - [Layer 3] Moodle discovery returned nothing for 19AI415
2026-01-04 00:59:26,523 - app.services.subject_discovery_service - INFO - [Layer 4] Checking config fallback for 19AI415
2026-01-04 00:59:26,523 - app.services.subject_discovery_service - ERROR - [NOT FOUND] No mapping found for subject code: 19AI415 after checking ALL layers
2026-01-04 00:59:26,525 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 00:59:26,527 - app.db.database - ERROR - Database session error: [{'type': 'missing', 'loc': ('header', 'X-Session-ID'), 'msg': 'Field required', 'input': None, 'url': 'https://errors.pydantic.dev/2.5/v/missing'}]
2026-01-04 00:59:47,939 - app.db.database - ERROR - Database session error: [{'type': 'missing', 'loc': ('header', 'X-Session-ID'), 'msg': 'Field required', 'input': None, 'url': 'https://errors.pydantic.dev/2.5/v/missing'}]
2026-01-04 01:00:37,975 - app.main - INFO - Shutting down Examination Middleware...
2026-01-04 01:00:37,977 - app.main - INFO - Database connections closed
2026-01-04 01:00:38,935 - app.main - INFO - Starting Examination Middleware...
2026-01-04 01:00:38,983 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2026-01-04 01:00:38,984 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-04 01:00:38,985 - sqlalchemy.engine.Engine - INFO - select current_schema()
2026-01-04 01:00:38,985 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-04 01:00:38,985 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2026-01-04 01:00:38,986 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-04 01:00:38,986 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 01:00:38,988 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 01:00:38,988 - sqlalchemy.engine.Engine - INFO - [generated in 0.00033s] ('examination_artifacts', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 01:00:38,992 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 01:00:38,993 - sqlalchemy.engine.Engine - INFO - [cached since 0.004346s ago] ('subject_mappings', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 01:00:38,993 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 01:00:38,993 - sqlalchemy.engine.Engine - INFO - [cached since 0.004976s ago] ('staff_users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 01:00:38,994 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 01:00:38,994 - sqlalchemy.engine.Engine - INFO - [cached since 0.005649s ago] ('student_sessions', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 01:00:38,995 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 01:00:38,995 - sqlalchemy.engine.Engine - INFO - [cached since 0.006489s ago] ('audit_logs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 01:00:38,995 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 01:00:38,996 - sqlalchemy.engine.Engine - INFO - [cached since 0.007216s ago] ('submission_queue', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 01:00:38,996 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 01:00:38,996 - sqlalchemy.engine.Engine - INFO - [cached since 0.007965s ago] ('system_config', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 01:00:38,998 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-01-04 01:00:38,998 - sqlalchemy.engine.Engine - INFO - [generated in 0.00031s] ('workflowstatus', 'pg_catalog')
2026-01-04 01:00:38,999 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 01:00:38,999 - app.main - INFO - Database tables created/verified
2026-01-04 01:00:38,999 - app.main - INFO - Upload directory: D:\LMS-SAE\exam_middleware\uploads
2026-01-04 01:00:38,999 - app.main - INFO - Storage directory: D:\LMS-SAE\exam_middleware\storage
2026-01-04 01:00:39,000 - app.main - INFO - Examination Middleware started successfully
2026-01-04 01:00:47,312 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 01:00:47,319 - sqlalchemy.engine.Engine - INFO - SELECT student_sessions.id, student_sessions.session_id, student_sessions.moodle_user_id, student_sessions.moodle_username, student_sessions.moodle_fullname, student_sessions.encrypted_token, student_sessions.token_expires_at, student_sessions.ip_address, student_sessions.user_agent, student_sessions.created_at, student_sessions.last_activity_at, student_sessions.expires_at 
FROM student_sessions 
WHERE student_sessions.session_id = $1::VARCHAR
2026-01-04 01:00:47,320 - sqlalchemy.engine.Engine - INFO - [generated in 0.00039s] ('1P5-Q6AgeDavbfdbvrb6FhvWjHre_gbe8vVx2-ZTWWc',)
2026-01-04 01:00:47,323 - sqlalchemy.engine.Engine - INFO - UPDATE student_sessions SET last_activity_at=$1::TIMESTAMP WITH TIME ZONE WHERE student_sessions.id = $2::INTEGER
2026-01-04 01:00:47,323 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] (datetime.datetime(2026, 1, 3, 19, 30, 47, 322975, tzinfo=datetime.timezone.utc), 4)
2026-01-04 01:00:47,325 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 01:00:47,338 - app.api.routes.student - INFO - [Dashboard] Decrypted user token for dynamic discovery (length: 32)
2026-01-04 01:00:47,338 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 01:00:47,341 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE (examination_artifacts.parsed_reg_no = $1::VARCHAR OR examination_artifacts.moodle_username = $2::VARCHAR) AND examination_artifacts.workflow_status IN ($3::workflowstatus, $4::workflowstatus, $5::workflowstatus, $6::workflowstatus) ORDER BY examination_artifacts.uploaded_at DESC
2026-01-04 01:00:47,341 - sqlalchemy.engine.Engine - INFO - [generated in 0.00061s] ('212222020029', '212222020029', 'PENDING', 'PENDING_REVIEW', 'VALIDATED', 'READY_FOR_REVIEW')
2026-01-04 01:00:47,352 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE examination_artifacts.parsed_reg_no = $1::VARCHAR AND examination_artifacts.workflow_status IN ($2::workflowstatus, $3::workflowstatus) ORDER BY examination_artifacts.submit_timestamp DESC
2026-01-04 01:00:47,353 - sqlalchemy.engine.Engine - INFO - [generated in 0.00068s] ('212222020029', 'SUBMITTED_TO_LMS', 'COMPLETED')
2026-01-04 01:00:47,355 - sqlalchemy.engine.Engine - INFO - SELECT subject_mappings.id, subject_mappings.subject_code, subject_mappings.subject_name, subject_mappings.moodle_course_id, subject_mappings.moodle_course_idnumber, subject_mappings.moodle_assignment_id, subject_mappings.moodle_assignment_name, subject_mappings.exam_session, subject_mappings.is_active, subject_mappings.created_at, subject_mappings.updated_at, subject_mappings.last_verified_at 
FROM subject_mappings 
WHERE subject_mappings.subject_code = $1::VARCHAR AND subject_mappings.is_active = true
2026-01-04 01:00:47,355 - sqlalchemy.engine.Engine - INFO - [generated in 0.00044s] ('19AI415',)
2026-01-04 01:00:47,357 - sqlalchemy.engine.Engine - INFO - SELECT subject_mappings.id, subject_mappings.subject_code, subject_mappings.subject_name, subject_mappings.moodle_course_id, subject_mappings.moodle_course_idnumber, subject_mappings.moodle_assignment_id, subject_mappings.moodle_assignment_name, subject_mappings.exam_session, subject_mappings.is_active, subject_mappings.created_at, subject_mappings.updated_at, subject_mappings.last_verified_at 
FROM subject_mappings 
WHERE subject_mappings.subject_code = $1::VARCHAR AND subject_mappings.is_active = true
2026-01-04 01:00:47,357 - sqlalchemy.engine.Engine - INFO - [generated in 0.00034s] ('19AI415',)
2026-01-04 01:00:47,357 - app.services.subject_discovery_service - INFO - [Layer 3] Attempting Moodle discovery for 19AI415 with token...
2026-01-04 01:00:47,358 - app.services.subject_discovery_service - INFO - [Discovery] Starting Moodle discovery for subject: 19AI415
2026-01-04 01:00:47,535 - httpcore.connection - DEBUG - connect_tcp.started host='183a70678909.ngrok-free.app' port=443 local_address=None timeout=30.0 socket_options=None
2026-01-04 01:00:48,771 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x00000217CB744610>
2026-01-04 01:00:48,772 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x00000217CB8629F0> server_hostname='183a70678909.ngrok-free.app' timeout=30.0
2026-01-04 01:00:51,026 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x00000217C80E3E90>
2026-01-04 01:00:51,026 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-01-04 01:00:51,026 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-01-04 01:00:51,027 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-01-04 01:00:51,027 - httpcore.http11 - DEBUG - send_request_body.complete
2026-01-04 01:00:51,027 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-01-04 01:00:51,748 - httpcore.http11 - DEBUG - receive_response_headers.failed exception=RemoteProtocolError('Server disconnected without sending a response.')
2026-01-04 01:00:51,749 - httpcore.http11 - DEBUG - response_closed.started
2026-01-04 01:00:51,749 - httpcore.http11 - DEBUG - response_closed.complete
2026-01-04 01:00:51,749 - app.services.subject_discovery_service - ERROR - [Discovery] Unexpected error: Server disconnected without sending a response.
Traceback (most recent call last):
  File "D:\LMS-SAE\.venv\Lib\site-packages\httpx\_transports\default.py", line 66, in map_httpcore_exceptions
    yield
  File "D:\LMS-SAE\.venv\Lib\site-packages\httpx\_transports\default.py", line 366, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\LMS-SAE\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 256, in handle_async_request
    raise exc from None
  File "D:\LMS-SAE\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 236, in handle_async_request
    response = await connection.handle_async_request(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\LMS-SAE\.venv\Lib\site-packages\httpcore\_async\connection.py", line 103, in handle_async_request
    return await self._connection.handle_async_request(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\LMS-SAE\.venv\Lib\site-packages\httpcore\_async\http11.py", line 136, in handle_async_request
    raise exc
  File "D:\LMS-SAE\.venv\Lib\site-packages\httpcore\_async\http11.py", line 106, in handle_async_request
    ) = await self._receive_response_headers(**kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\LMS-SAE\.venv\Lib\site-packages\httpcore\_async\http11.py", line 177, in _receive_response_headers
    event = await self._receive_event(timeout=timeout)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\LMS-SAE\.venv\Lib\site-packages\httpcore\_async\http11.py", line 231, in _receive_event
    raise RemoteProtocolError(msg)
httpcore.RemoteProtocolError: Server disconnected without sending a response.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\LMS-SAE\exam_middleware\app\services\subject_discovery_service.py", line 185, in _discover_from_moodle
    site_info = await client.get_site_info(token=token)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\LMS-SAE\exam_middleware\app\services\moodle_client.py", line 201, in get_site_info
    response = await client.post(url, data=params)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\LMS-SAE\.venv\Lib\site-packages\httpx\_client.py", line 1848, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
  File "D:\LMS-SAE\.venv\Lib\site-packages\httpx\_client.py", line 1530, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\LMS-SAE\.venv\Lib\site-packages\httpx\_client.py", line 1617, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\LMS-SAE\.venv\Lib\site-packages\httpx\_client.py", line 1645, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\LMS-SAE\.venv\Lib\site-packages\httpx\_client.py", line 1682, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\LMS-SAE\.venv\Lib\site-packages\httpx\_client.py", line 1719, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\LMS-SAE\.venv\Lib\site-packages\httpx\_transports\default.py", line 365, in handle_async_request
    with map_httpcore_exceptions():
  File "C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.11_3.11.2544.0_x64__qbz5n2kfra8p0\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(typ, value, traceback)
  File "D:\LMS-SAE\.venv\Lib\site-packages\httpx\_transports\default.py", line 83, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.RemoteProtocolError: Server disconnected without sending a response.
2026-01-04 01:00:51,793 - app.services.subject_discovery_service - WARNING - [Layer 3] Moodle discovery returned nothing for 19AI415
2026-01-04 01:00:51,793 - app.services.subject_discovery_service - INFO - [Layer 4] Checking config fallback for 19AI415
2026-01-04 01:00:51,793 - app.services.subject_discovery_service - ERROR - [NOT FOUND] No mapping found for subject code: 19AI415 after checking ALL layers
2026-01-04 01:00:51,795 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 01:00:51,797 - app.db.database - ERROR - Database session error: [{'type': 'missing', 'loc': ('header', 'X-Session-ID'), 'msg': 'Field required', 'input': None, 'url': 'https://errors.pydantic.dev/2.5/v/missing'}]
2026-01-04 01:02:05,414 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 01:02:05,414 - sqlalchemy.engine.Engine - INFO - SELECT student_sessions.id, student_sessions.session_id, student_sessions.moodle_user_id, student_sessions.moodle_username, student_sessions.moodle_fullname, student_sessions.encrypted_token, student_sessions.token_expires_at, student_sessions.ip_address, student_sessions.user_agent, student_sessions.created_at, student_sessions.last_activity_at, student_sessions.expires_at 
FROM student_sessions 
WHERE student_sessions.session_id = $1::VARCHAR
2026-01-04 01:02:05,414 - sqlalchemy.engine.Engine - INFO - [cached since 78.1s ago] ('1P5-Q6AgeDavbfdbvrb6FhvWjHre_gbe8vVx2-ZTWWc',)
2026-01-04 01:02:05,415 - sqlalchemy.engine.Engine - INFO - UPDATE student_sessions SET last_activity_at=$1::TIMESTAMP WITH TIME ZONE WHERE student_sessions.id = $2::INTEGER
2026-01-04 01:02:05,415 - sqlalchemy.engine.Engine - INFO - [cached since 78.09s ago] (datetime.datetime(2026, 1, 3, 19, 32, 5, 415987, tzinfo=datetime.timezone.utc), 4)
2026-01-04 01:02:05,417 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 01:02:05,426 - app.api.routes.student - INFO - [Dashboard] Decrypted user token for dynamic discovery (length: 32)
2026-01-04 01:02:05,428 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 01:02:05,428 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE (examination_artifacts.parsed_reg_no = $1::VARCHAR OR examination_artifacts.moodle_username = $2::VARCHAR) AND examination_artifacts.workflow_status IN ($3::workflowstatus, $4::workflowstatus, $5::workflowstatus, $6::workflowstatus) ORDER BY examination_artifacts.uploaded_at DESC
2026-01-04 01:02:05,429 - sqlalchemy.engine.Engine - INFO - [cached since 78.09s ago] ('212222020029', '212222020029', 'PENDING', 'PENDING_REVIEW', 'VALIDATED', 'READY_FOR_REVIEW')
2026-01-04 01:02:05,430 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE examination_artifacts.parsed_reg_no = $1::VARCHAR AND examination_artifacts.workflow_status IN ($2::workflowstatus, $3::workflowstatus) ORDER BY examination_artifacts.submit_timestamp DESC
2026-01-04 01:02:05,430 - sqlalchemy.engine.Engine - INFO - [cached since 78.08s ago] ('212222020029', 'SUBMITTED_TO_LMS', 'COMPLETED')
2026-01-04 01:02:05,431 - sqlalchemy.engine.Engine - INFO - SELECT subject_mappings.id, subject_mappings.subject_code, subject_mappings.subject_name, subject_mappings.moodle_course_id, subject_mappings.moodle_course_idnumber, subject_mappings.moodle_assignment_id, subject_mappings.moodle_assignment_name, subject_mappings.exam_session, subject_mappings.is_active, subject_mappings.created_at, subject_mappings.updated_at, subject_mappings.last_verified_at 
FROM subject_mappings 
WHERE subject_mappings.subject_code = $1::VARCHAR AND subject_mappings.is_active = true
2026-01-04 01:02:05,431 - sqlalchemy.engine.Engine - INFO - [cached since 78.08s ago] ('19AI415',)
2026-01-04 01:02:05,432 - sqlalchemy.engine.Engine - INFO - SELECT subject_mappings.id, subject_mappings.subject_code, subject_mappings.subject_name, subject_mappings.moodle_course_id, subject_mappings.moodle_course_idnumber, subject_mappings.moodle_assignment_id, subject_mappings.moodle_assignment_name, subject_mappings.exam_session, subject_mappings.is_active, subject_mappings.created_at, subject_mappings.updated_at, subject_mappings.last_verified_at 
FROM subject_mappings 
WHERE subject_mappings.subject_code = $1::VARCHAR AND subject_mappings.is_active = true
2026-01-04 01:02:05,432 - sqlalchemy.engine.Engine - INFO - [cached since 78.08s ago] ('19AI415',)
2026-01-04 01:02:05,432 - app.services.subject_discovery_service - INFO - [Layer 3] Attempting Moodle discovery for 19AI415 with token...
2026-01-04 01:02:05,432 - app.services.subject_discovery_service - INFO - [Discovery] Starting Moodle discovery for subject: 19AI415
2026-01-04 01:02:05,613 - httpcore.connection - DEBUG - connect_tcp.started host='183a70678909.ngrok-free.app' port=443 local_address=None timeout=30.0 socket_options=None
2026-01-04 01:02:05,670 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x00000217CB9B7010>
2026-01-04 01:02:05,670 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x00000217CB9B0680> server_hostname='183a70678909.ngrok-free.app' timeout=30.0
2026-01-04 01:02:05,714 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x00000217CB9B6F50>
2026-01-04 01:02:05,714 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-01-04 01:02:05,715 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-01-04 01:02:05,715 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-01-04 01:02:05,715 - httpcore.http11 - DEBUG - send_request_body.complete
2026-01-04 01:02:05,715 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-01-04 01:02:06,201 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Accept-Ranges', b'none'), (b'Access-Control-Allow-Origin', b'*'), (b'Cache-Control', b'private, must-revalidate, pre-check=0, post-check=0, max-age=0'), (b'Content-Type', b'application/json'), (b'Date', b'Sat, 03 Jan 2026 19:32:05 GMT'), (b'Expires', b'Thu, 01 Jan 1970 00:00:00 GMT'), (b'Ngrok-Agent-Ips', b'2406:7400:3b:ec84:45c4:688:4cd7:ce08'), (b'Pragma', b'no-cache'), (b'Server', b'Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.2.4'), (b'X-Powered-By', b'PHP/8.2.4'), (b'Transfer-Encoding', b'chunked')])
2026-01-04 01:02:06,201 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-01-04 01:02:06,246 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-01-04 01:02:06,246 - httpcore.http11 - DEBUG - response_closed.started
2026-01-04 01:02:06,246 - httpcore.http11 - DEBUG - response_closed.complete
2026-01-04 01:02:06,248 - app.services.moodle_client - INFO - Got site info for user: 23004568
2026-01-04 01:02:06,248 - app.services.subject_discovery_service - INFO - [Discovery] User ID: 5, Username: 23004568
2026-01-04 01:02:06,249 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-01-04 01:02:06,249 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-01-04 01:02:06,249 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-01-04 01:02:06,249 - httpcore.http11 - DEBUG - send_request_body.complete
2026-01-04 01:02:06,249 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-01-04 01:02:06,401 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Accept-Ranges', b'none'), (b'Access-Control-Allow-Origin', b'*'), (b'Cache-Control', b'private, must-revalidate, pre-check=0, post-check=0, max-age=0'), (b'Content-Length', b'234'), (b'Content-Type', b'application/json'), (b'Date', b'Sat, 03 Jan 2026 19:32:06 GMT'), (b'Expires', b'Thu, 01 Jan 1970 00:00:00 GMT'), (b'Ngrok-Agent-Ips', b'2406:7400:3b:ec84:45c4:688:4cd7:ce08'), (b'Pragma', b'no-cache'), (b'Server', b'Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.2.4'), (b'X-Powered-By', b'PHP/8.2.4')])
2026-01-04 01:02:06,401 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-01-04 01:02:06,401 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-01-04 01:02:06,401 - httpcore.http11 - DEBUG - response_closed.started
2026-01-04 01:02:06,403 - httpcore.http11 - DEBUG - response_closed.complete
2026-01-04 01:02:06,403 - app.services.moodle_client - ERROR - Moodle API error in core_course_get_courses: errorcoursecontextnotvalid - You cannot execute functions in the course context (course id:2). The context error message was: Course or activity not accessible. (debug: None)
2026-01-04 01:02:06,403 - app.services.subject_discovery_service - WARNING - [Discovery] Moodle API error for 19AI415: Moodle API error: You cannot execute functions in the course context (course id:2). The context error message was: Course or activity not accessible.
2026-01-04 01:02:06,403 - httpcore.connection - DEBUG - close.started
2026-01-04 01:02:06,403 - httpcore.connection - DEBUG - close.complete
2026-01-04 01:02:06,403 - app.services.subject_discovery_service - WARNING - [Layer 3] Moodle discovery returned nothing for 19AI415
2026-01-04 01:02:06,403 - app.services.subject_discovery_service - INFO - [Layer 4] Checking config fallback for 19AI415
2026-01-04 01:02:06,403 - app.services.subject_discovery_service - ERROR - [NOT FOUND] No mapping found for subject code: 19AI415 after checking ALL layers
2026-01-04 01:02:06,404 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 01:02:06,407 - app.db.database - ERROR - Database session error: [{'type': 'missing', 'loc': ('header', 'X-Session-ID'), 'msg': 'Field required', 'input': None, 'url': 'https://errors.pydantic.dev/2.5/v/missing'}]
2026-01-04 01:03:24,042 - app.main - INFO - Shutting down Examination Middleware...
2026-01-04 01:03:24,044 - app.main - INFO - Database connections closed
2026-01-04 01:03:25,015 - app.main - INFO - Starting Examination Middleware...
2026-01-04 01:03:25,066 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2026-01-04 01:03:25,066 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-04 01:03:25,067 - sqlalchemy.engine.Engine - INFO - select current_schema()
2026-01-04 01:03:25,067 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-04 01:03:25,068 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2026-01-04 01:03:25,068 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-01-04 01:03:25,069 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 01:03:25,071 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 01:03:25,071 - sqlalchemy.engine.Engine - INFO - [generated in 0.00034s] ('examination_artifacts', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 01:03:25,075 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 01:03:25,075 - sqlalchemy.engine.Engine - INFO - [cached since 0.0041s ago] ('subject_mappings', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 01:03:25,076 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 01:03:25,076 - sqlalchemy.engine.Engine - INFO - [cached since 0.004848s ago] ('staff_users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 01:03:25,077 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 01:03:25,077 - sqlalchemy.engine.Engine - INFO - [cached since 0.005587s ago] ('student_sessions', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 01:03:25,077 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 01:03:25,078 - sqlalchemy.engine.Engine - INFO - [cached since 0.006259s ago] ('audit_logs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 01:03:25,078 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 01:03:25,079 - sqlalchemy.engine.Engine - INFO - [cached since 0.007297s ago] ('submission_queue', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 01:03:25,079 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-01-04 01:03:25,079 - sqlalchemy.engine.Engine - INFO - [cached since 0.008131s ago] ('system_config', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-01-04 01:03:25,080 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-01-04 01:03:25,080 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] ('workflowstatus', 'pg_catalog')
2026-01-04 01:03:25,082 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 01:03:25,082 - app.main - INFO - Database tables created/verified
2026-01-04 01:03:25,082 - app.main - INFO - Upload directory: D:\LMS-SAE\exam_middleware\uploads
2026-01-04 01:03:25,083 - app.main - INFO - Storage directory: D:\LMS-SAE\exam_middleware\storage
2026-01-04 01:03:25,083 - app.main - INFO - Examination Middleware started successfully
2026-01-04 01:03:32,600 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 01:03:32,607 - sqlalchemy.engine.Engine - INFO - SELECT student_sessions.id, student_sessions.session_id, student_sessions.moodle_user_id, student_sessions.moodle_username, student_sessions.moodle_fullname, student_sessions.encrypted_token, student_sessions.token_expires_at, student_sessions.ip_address, student_sessions.user_agent, student_sessions.created_at, student_sessions.last_activity_at, student_sessions.expires_at 
FROM student_sessions 
WHERE student_sessions.session_id = $1::VARCHAR
2026-01-04 01:03:32,607 - sqlalchemy.engine.Engine - INFO - [generated in 0.00038s] ('1P5-Q6AgeDavbfdbvrb6FhvWjHre_gbe8vVx2-ZTWWc',)
2026-01-04 01:03:32,610 - sqlalchemy.engine.Engine - INFO - UPDATE student_sessions SET last_activity_at=$1::TIMESTAMP WITH TIME ZONE WHERE student_sessions.id = $2::INTEGER
2026-01-04 01:03:32,610 - sqlalchemy.engine.Engine - INFO - [generated in 0.00028s] (datetime.datetime(2026, 1, 3, 19, 33, 32, 609015, tzinfo=datetime.timezone.utc), 4)
2026-01-04 01:03:32,611 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 01:03:32,626 - app.api.routes.student - INFO - [Dashboard] Decrypted user token for dynamic discovery (length: 32)
2026-01-04 01:03:32,627 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 01:03:32,629 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE (examination_artifacts.parsed_reg_no = $1::VARCHAR OR examination_artifacts.moodle_username = $2::VARCHAR) AND examination_artifacts.workflow_status IN ($3::workflowstatus, $4::workflowstatus, $5::workflowstatus, $6::workflowstatus) ORDER BY examination_artifacts.uploaded_at DESC
2026-01-04 01:03:32,629 - sqlalchemy.engine.Engine - INFO - [generated in 0.00049s] ('212222020029', '212222020029', 'PENDING', 'PENDING_REVIEW', 'VALIDATED', 'READY_FOR_REVIEW')
2026-01-04 01:03:32,640 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE examination_artifacts.parsed_reg_no = $1::VARCHAR AND examination_artifacts.workflow_status IN ($2::workflowstatus, $3::workflowstatus) ORDER BY examination_artifacts.submit_timestamp DESC
2026-01-04 01:03:32,641 - sqlalchemy.engine.Engine - INFO - [generated in 0.00057s] ('212222020029', 'SUBMITTED_TO_LMS', 'COMPLETED')
2026-01-04 01:03:32,643 - sqlalchemy.engine.Engine - INFO - SELECT subject_mappings.id, subject_mappings.subject_code, subject_mappings.subject_name, subject_mappings.moodle_course_id, subject_mappings.moodle_course_idnumber, subject_mappings.moodle_assignment_id, subject_mappings.moodle_assignment_name, subject_mappings.exam_session, subject_mappings.is_active, subject_mappings.created_at, subject_mappings.updated_at, subject_mappings.last_verified_at 
FROM subject_mappings 
WHERE subject_mappings.subject_code = $1::VARCHAR AND subject_mappings.is_active = true
2026-01-04 01:03:32,643 - sqlalchemy.engine.Engine - INFO - [generated in 0.00028s] ('19AI415',)
2026-01-04 01:03:32,645 - sqlalchemy.engine.Engine - INFO - SELECT subject_mappings.id, subject_mappings.subject_code, subject_mappings.subject_name, subject_mappings.moodle_course_id, subject_mappings.moodle_course_idnumber, subject_mappings.moodle_assignment_id, subject_mappings.moodle_assignment_name, subject_mappings.exam_session, subject_mappings.is_active, subject_mappings.created_at, subject_mappings.updated_at, subject_mappings.last_verified_at 
FROM subject_mappings 
WHERE subject_mappings.subject_code = $1::VARCHAR AND subject_mappings.is_active = true
2026-01-04 01:03:32,646 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] ('19AI415',)
2026-01-04 01:03:32,646 - app.services.subject_discovery_service - INFO - [Layer 3] Attempting Moodle discovery for 19AI415 with token...
2026-01-04 01:03:32,646 - app.services.subject_discovery_service - INFO - [Discovery] Starting Moodle discovery for subject: 19AI415
2026-01-04 01:03:32,845 - httpcore.connection - DEBUG - connect_tcp.started host='183a70678909.ngrok-free.app' port=443 local_address=None timeout=30.0 socket_options=None
2026-01-04 01:03:32,917 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001E38C2EF9D0>
2026-01-04 01:03:32,917 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000001E38C2629F0> server_hostname='183a70678909.ngrok-free.app' timeout=30.0
2026-01-04 01:03:32,970 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001E38C0F3290>
2026-01-04 01:03:32,971 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-01-04 01:03:32,972 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-01-04 01:03:32,972 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-01-04 01:03:32,972 - httpcore.http11 - DEBUG - send_request_body.complete
2026-01-04 01:03:32,972 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-01-04 01:03:33,276 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Accept-Ranges', b'none'), (b'Access-Control-Allow-Origin', b'*'), (b'Cache-Control', b'private, must-revalidate, pre-check=0, post-check=0, max-age=0'), (b'Content-Type', b'application/json'), (b'Date', b'Sat, 03 Jan 2026 19:33:33 GMT'), (b'Expires', b'Thu, 01 Jan 1970 00:00:00 GMT'), (b'Ngrok-Agent-Ips', b'2406:7400:3b:ec84:45c4:688:4cd7:ce08'), (b'Pragma', b'no-cache'), (b'Server', b'Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.2.4'), (b'X-Powered-By', b'PHP/8.2.4'), (b'Transfer-Encoding', b'chunked')])
2026-01-04 01:03:33,277 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-01-04 01:03:33,336 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-01-04 01:03:33,336 - httpcore.http11 - DEBUG - response_closed.started
2026-01-04 01:03:33,336 - httpcore.http11 - DEBUG - response_closed.complete
2026-01-04 01:03:33,337 - app.services.moodle_client - INFO - Got site info for user: 23004568
2026-01-04 01:03:33,337 - app.services.subject_discovery_service - INFO - [Discovery] User ID: 5, Username: 23004568
2026-01-04 01:03:33,337 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-01-04 01:03:33,337 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-01-04 01:03:33,337 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-01-04 01:03:33,337 - httpcore.http11 - DEBUG - send_request_body.complete
2026-01-04 01:03:33,337 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-01-04 01:03:33,453 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Accept-Ranges', b'none'), (b'Access-Control-Allow-Origin', b'*'), (b'Cache-Control', b'private, must-revalidate, pre-check=0, post-check=0, max-age=0'), (b'Content-Length', b'234'), (b'Content-Type', b'application/json'), (b'Date', b'Sat, 03 Jan 2026 19:33:33 GMT'), (b'Expires', b'Thu, 01 Jan 1970 00:00:00 GMT'), (b'Ngrok-Agent-Ips', b'2406:7400:3b:ec84:45c4:688:4cd7:ce08'), (b'Pragma', b'no-cache'), (b'Server', b'Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.2.4'), (b'X-Powered-By', b'PHP/8.2.4')])
2026-01-04 01:03:33,453 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-01-04 01:03:33,453 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-01-04 01:03:33,454 - httpcore.http11 - DEBUG - response_closed.started
2026-01-04 01:03:33,454 - httpcore.http11 - DEBUG - response_closed.complete
2026-01-04 01:03:33,455 - app.services.moodle_client - ERROR - Moodle API error in core_course_get_courses: errorcoursecontextnotvalid - You cannot execute functions in the course context (course id:2). The context error message was: Course or activity not accessible. (debug: None)
2026-01-04 01:03:33,455 - app.services.subject_discovery_service - WARNING - [Discovery] Moodle API error for 19AI415: Moodle API error: You cannot execute functions in the course context (course id:2). The context error message was: Course or activity not accessible.
2026-01-04 01:03:33,455 - httpcore.connection - DEBUG - close.started
2026-01-04 01:03:33,455 - httpcore.connection - DEBUG - close.complete
2026-01-04 01:03:33,455 - app.services.subject_discovery_service - WARNING - [Layer 3] Moodle discovery returned nothing for 19AI415
2026-01-04 01:03:33,455 - app.services.subject_discovery_service - INFO - [Layer 4] Checking config fallback for 19AI415
2026-01-04 01:03:33,455 - app.services.subject_discovery_service - ERROR - [NOT FOUND] No mapping found for subject code: 19AI415 after checking ALL layers
2026-01-04 01:03:33,458 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 01:03:33,461 - app.db.database - ERROR - Database session error: [{'type': 'missing', 'loc': ('header', 'X-Session-ID'), 'msg': 'Field required', 'input': None, 'url': 'https://errors.pydantic.dev/2.5/v/missing'}]
2026-01-04 01:03:41,875 - app.api.routes.auth - INFO - Authenticating student: 23004568
2026-01-04 01:03:42,041 - app.services.moodle_client - INFO - Authenticating user: 23004568
2026-01-04 01:03:42,042 - httpcore.connection - DEBUG - connect_tcp.started host='183a70678909.ngrok-free.app' port=443 local_address=None timeout=30.0 socket_options=None
2026-01-04 01:03:42,087 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001E38C363F10>
2026-01-04 01:03:42,088 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000001E38C3100E0> server_hostname='183a70678909.ngrok-free.app' timeout=30.0
2026-01-04 01:03:42,132 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001E38C363E10>
2026-01-04 01:03:42,133 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-01-04 01:03:42,133 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-01-04 01:03:42,133 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-01-04 01:03:42,133 - httpcore.http11 - DEBUG - send_request_body.complete
2026-01-04 01:03:42,133 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-01-04 01:03:42,339 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Accept-Ranges', b'none'), (b'Access-Control-Allow-Origin', b'*'), (b'Cache-Control', b'no-store, no-cache, must-revalidate'), (b'Cache-Control', b'post-check=0, pre-check=0'), (b'Content-Length', b'126'), (b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Sat, 03 Jan 2026 19:33:42 GMT'), (b'Expires', b'Mon, 20 Aug 1969 09:23:00 GMT'), (b'Last-Modified', b'Sat, 03 Jan 2026 19:33:42 GMT'), (b'Ngrok-Agent-Ips', b'2406:7400:3b:ec84:45c4:688:4cd7:ce08'), (b'Pragma', b'no-cache'), (b'Server', b'Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.2.4'), (b'X-Powered-By', b'PHP/8.2.4')])
2026-01-04 01:03:42,340 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-01-04 01:03:42,340 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-01-04 01:03:42,340 - httpcore.http11 - DEBUG - response_closed.started
2026-01-04 01:03:42,341 - httpcore.http11 - DEBUG - response_closed.complete
2026-01-04 01:03:42,341 - app.services.moodle_client - INFO - Successfully authenticated user: 23004568
2026-01-04 01:03:42,341 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-01-04 01:03:42,341 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-01-04 01:03:42,341 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-01-04 01:03:42,341 - httpcore.http11 - DEBUG - send_request_body.complete
2026-01-04 01:03:42,341 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-01-04 01:03:42,542 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Accept-Ranges', b'none'), (b'Access-Control-Allow-Origin', b'*'), (b'Cache-Control', b'private, must-revalidate, pre-check=0, post-check=0, max-age=0'), (b'Content-Type', b'application/json'), (b'Date', b'Sat, 03 Jan 2026 19:33:42 GMT'), (b'Expires', b'Thu, 01 Jan 1970 00:00:00 GMT'), (b'Ngrok-Agent-Ips', b'2406:7400:3b:ec84:45c4:688:4cd7:ce08'), (b'Pragma', b'no-cache'), (b'Server', b'Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.2.4'), (b'X-Powered-By', b'PHP/8.2.4'), (b'Transfer-Encoding', b'chunked')])
2026-01-04 01:03:42,543 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-01-04 01:03:42,583 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-01-04 01:03:42,583 - httpcore.http11 - DEBUG - response_closed.started
2026-01-04 01:03:42,583 - httpcore.http11 - DEBUG - response_closed.complete
2026-01-04 01:03:42,583 - app.services.moodle_client - INFO - Got site info for user: 23004568
2026-01-04 01:03:42,586 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 01:03:42,587 - sqlalchemy.engine.Engine - INFO - INSERT INTO student_sessions (session_id, moodle_user_id, moodle_username, moodle_fullname, encrypted_token, token_expires_at, ip_address, user_agent, expires_at) VALUES ($1::VARCHAR, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::TIMESTAMP WITH TIME ZONE, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITH TIME ZONE) RETURNING student_sessions.id, student_sessions.created_at, student_sessions.last_activity_at
2026-01-04 01:03:42,587 - sqlalchemy.engine.Engine - INFO - [generated in 0.00048s] ('VpXrQHMgHsiJi0ndyB2FuxRFj5MLzVqHY2_RJyWPF08', 5, '23004568', 'Santhan Kumar 212222020029', 'Z0FBQUFBQnBXVzhXTXBCMWQ4NXN3bzhjMGVQVERSZW55ZmlndTFqVEU3YktTcVcxRWNzalhlUGxTNDIyUkhJcFh3X2RfRnVRTDlIX2NwOXAxMVoxTzFzYXVzblBfSkphMHczZkV6dEIwZGdBWk44MXlsdkc0QTNRRWp1a1FnWnhQNEFzcEpKVHRtdGQ=', None, '127.0.0.1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36', datetime.datetime(2026, 1, 3, 20, 33, 42, 585473, tzinfo=datetime.timezone.utc))
2026-01-04 01:03:42,588 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 01:03:42,589 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 01:03:42,590 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE (examination_artifacts.parsed_reg_no = $1::VARCHAR OR examination_artifacts.moodle_username = $2::VARCHAR) AND examination_artifacts.workflow_status IN ($3::workflowstatus, $4::workflowstatus, $5::workflowstatus, $6::workflowstatus) ORDER BY examination_artifacts.uploaded_at DESC
2026-01-04 01:03:42,590 - sqlalchemy.engine.Engine - INFO - [cached since 9.962s ago] ('212222020029', '212222020029', 'PENDING', 'PENDING_REVIEW', 'VALIDATED', 'READY_FOR_REVIEW')
2026-01-04 01:03:42,591 - app.api.routes.auth - INFO - Student 23004568 (reg: 212222020029) logged in. Pending papers: 1
2026-01-04 01:03:42,591 - httpcore.connection - DEBUG - close.started
2026-01-04 01:03:42,592 - httpcore.connection - DEBUG - close.complete
2026-01-04 01:03:42,593 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 01:03:42,595 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 01:03:42,596 - sqlalchemy.engine.Engine - INFO - SELECT student_sessions.id, student_sessions.session_id, student_sessions.moodle_user_id, student_sessions.moodle_username, student_sessions.moodle_fullname, student_sessions.encrypted_token, student_sessions.token_expires_at, student_sessions.ip_address, student_sessions.user_agent, student_sessions.created_at, student_sessions.last_activity_at, student_sessions.expires_at 
FROM student_sessions 
WHERE student_sessions.session_id = $1::VARCHAR
2026-01-04 01:03:42,596 - sqlalchemy.engine.Engine - INFO - [cached since 9.99s ago] ('VpXrQHMgHsiJi0ndyB2FuxRFj5MLzVqHY2_RJyWPF08',)
2026-01-04 01:03:42,597 - sqlalchemy.engine.Engine - INFO - UPDATE student_sessions SET last_activity_at=$1::TIMESTAMP WITH TIME ZONE WHERE student_sessions.id = $2::INTEGER
2026-01-04 01:03:42,598 - sqlalchemy.engine.Engine - INFO - [cached since 9.987s ago] (datetime.datetime(2026, 1, 3, 19, 33, 42, 597586, tzinfo=datetime.timezone.utc), 5)
2026-01-04 01:03:42,598 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 01:03:42,599 - app.api.routes.student - INFO - [Dashboard] Decrypted user token for dynamic discovery (length: 32)
2026-01-04 01:03:42,600 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-01-04 01:03:42,600 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE (examination_artifacts.parsed_reg_no = $1::VARCHAR OR examination_artifacts.moodle_username = $2::VARCHAR) AND examination_artifacts.workflow_status IN ($3::workflowstatus, $4::workflowstatus, $5::workflowstatus, $6::workflowstatus) ORDER BY examination_artifacts.uploaded_at DESC
2026-01-04 01:03:42,602 - sqlalchemy.engine.Engine - INFO - [cached since 9.973s ago] ('212222020029', '212222020029', 'PENDING', 'PENDING_REVIEW', 'VALIDATED', 'READY_FOR_REVIEW')
2026-01-04 01:03:42,603 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE examination_artifacts.parsed_reg_no = $1::VARCHAR AND examination_artifacts.workflow_status IN ($2::workflowstatus, $3::workflowstatus) ORDER BY examination_artifacts.submit_timestamp DESC
2026-01-04 01:03:42,603 - sqlalchemy.engine.Engine - INFO - [cached since 9.963s ago] ('212222020029', 'SUBMITTED_TO_LMS', 'COMPLETED')
2026-01-04 01:03:42,605 - sqlalchemy.engine.Engine - INFO - SELECT subject_mappings.id, subject_mappings.subject_code, subject_mappings.subject_name, subject_mappings.moodle_course_id, subject_mappings.moodle_course_idnumber, subject_mappings.moodle_assignment_id, subject_mappings.moodle_assignment_name, subject_mappings.exam_session, subject_mappings.is_active, subject_mappings.created_at, subject_mappings.updated_at, subject_mappings.last_verified_at 
FROM subject_mappings 
WHERE subject_mappings.subject_code = $1::VARCHAR AND subject_mappings.is_active = true
2026-01-04 01:03:42,605 - sqlalchemy.engine.Engine - INFO - [cached since 9.962s ago] ('19AI415',)
2026-01-04 01:03:42,606 - sqlalchemy.engine.Engine - INFO - SELECT subject_mappings.id, subject_mappings.subject_code, subject_mappings.subject_name, subject_mappings.moodle_course_id, subject_mappings.moodle_course_idnumber, subject_mappings.moodle_assignment_id, subject_mappings.moodle_assignment_name, subject_mappings.exam_session, subject_mappings.is_active, subject_mappings.created_at, subject_mappings.updated_at, subject_mappings.last_verified_at 
FROM subject_mappings 
WHERE subject_mappings.subject_code = $1::VARCHAR AND subject_mappings.is_active = true
2026-01-04 01:03:42,606 - sqlalchemy.engine.Engine - INFO - [cached since 9.961s ago] ('19AI415',)
2026-01-04 01:03:42,607 - app.services.subject_discovery_service - INFO - [Layer 3] Attempting Moodle discovery for 19AI415 with token...
2026-01-04 01:03:42,607 - app.services.subject_discovery_service - INFO - [Discovery] Starting Moodle discovery for subject: 19AI415
2026-01-04 01:03:42,815 - httpcore.connection - DEBUG - connect_tcp.started host='183a70678909.ngrok-free.app' port=443 local_address=None timeout=30.0 socket_options=None
2026-01-04 01:03:42,869 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001E38C3594D0>
2026-01-04 01:03:42,870 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000001E38C0B2A80> server_hostname='183a70678909.ngrok-free.app' timeout=30.0
2026-01-04 01:03:42,923 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001E38C359410>
2026-01-04 01:03:42,923 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-01-04 01:03:42,925 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-01-04 01:03:42,925 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-01-04 01:03:42,925 - httpcore.http11 - DEBUG - send_request_body.complete
2026-01-04 01:03:42,925 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-01-04 01:03:43,267 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Accept-Ranges', b'none'), (b'Access-Control-Allow-Origin', b'*'), (b'Cache-Control', b'private, must-revalidate, pre-check=0, post-check=0, max-age=0'), (b'Content-Type', b'application/json'), (b'Date', b'Sat, 03 Jan 2026 19:33:42 GMT'), (b'Expires', b'Thu, 01 Jan 1970 00:00:00 GMT'), (b'Ngrok-Agent-Ips', b'2406:7400:3b:ec84:45c4:688:4cd7:ce08'), (b'Pragma', b'no-cache'), (b'Server', b'Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.2.4'), (b'X-Powered-By', b'PHP/8.2.4'), (b'Transfer-Encoding', b'chunked')])
2026-01-04 01:03:43,268 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-01-04 01:03:43,322 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-01-04 01:03:43,322 - httpcore.http11 - DEBUG - response_closed.started
2026-01-04 01:03:43,323 - httpcore.http11 - DEBUG - response_closed.complete
2026-01-04 01:03:43,323 - app.services.moodle_client - INFO - Got site info for user: 23004568
2026-01-04 01:03:43,323 - app.services.subject_discovery_service - INFO - [Discovery] User ID: 5, Username: 23004568
2026-01-04 01:03:43,324 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-01-04 01:03:43,324 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-01-04 01:03:43,324 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-01-04 01:03:43,324 - httpcore.http11 - DEBUG - send_request_body.complete
2026-01-04 01:03:43,324 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-01-04 01:03:43,440 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Accept-Ranges', b'none'), (b'Access-Control-Allow-Origin', b'*'), (b'Cache-Control', b'private, must-revalidate, pre-check=0, post-check=0, max-age=0'), (b'Content-Length', b'234'), (b'Content-Type', b'application/json'), (b'Date', b'Sat, 03 Jan 2026 19:33:43 GMT'), (b'Expires', b'Thu, 01 Jan 1970 00:00:00 GMT'), (b'Ngrok-Agent-Ips', b'2406:7400:3b:ec84:45c4:688:4cd7:ce08'), (b'Pragma', b'no-cache'), (b'Server', b'Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.2.4'), (b'X-Powered-By', b'PHP/8.2.4')])
2026-01-04 01:03:43,440 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-01-04 01:03:43,442 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-01-04 01:03:43,442 - httpcore.http11 - DEBUG - response_closed.started
2026-01-04 01:03:43,442 - httpcore.http11 - DEBUG - response_closed.complete
2026-01-04 01:03:43,443 - app.services.moodle_client - ERROR - Moodle API error in core_course_get_courses: errorcoursecontextnotvalid - You cannot execute functions in the course context (course id:2). The context error message was: Course or activity not accessible. (debug: None)
2026-01-04 01:03:43,443 - app.services.subject_discovery_service - WARNING - [Discovery] Moodle API error for 19AI415: Moodle API error: You cannot execute functions in the course context (course id:2). The context error message was: Course or activity not accessible.
2026-01-04 01:03:43,443 - httpcore.connection - DEBUG - close.started
2026-01-04 01:03:43,443 - httpcore.connection - DEBUG - close.complete
2026-01-04 01:03:43,443 - app.services.subject_discovery_service - WARNING - [Layer 3] Moodle discovery returned nothing for 19AI415
2026-01-04 01:03:43,444 - app.services.subject_discovery_service - INFO - [Layer 4] Checking config fallback for 19AI415
2026-01-04 01:03:43,444 - app.services.subject_discovery_service - ERROR - [NOT FOUND] No mapping found for subject code: 19AI415 after checking ALL layers
2026-01-04 01:03:43,444 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-01-04 01:03:43,447 - app.db.database - ERROR - Database session error: [{'type': 'missing', 'loc': ('header', 'X-Session-ID'), 'msg': 'Field required', 'input': None, 'url': 'https://errors.pydantic.dev/2.5/v/missing'}]
2026-02-04 22:52:34,467 - app.main - INFO - Starting Examination Middleware...
2026-02-04 22:52:34,663 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2026-02-04 22:52:34,663 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-02-04 22:52:34,667 - sqlalchemy.engine.Engine - INFO - select current_schema()
2026-02-04 22:52:34,667 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-02-04 22:52:34,668 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2026-02-04 22:52:34,669 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-02-04 22:52:34,670 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-02-04 22:52:34,673 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-04 22:52:34,673 - sqlalchemy.engine.Engine - INFO - [generated in 0.00045s] ('examination_artifacts', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-04 22:52:34,687 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-04 22:52:34,687 - sqlalchemy.engine.Engine - INFO - [cached since 0.01421s ago] ('subject_mappings', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-04 22:52:34,688 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-04 22:52:34,688 - sqlalchemy.engine.Engine - INFO - [cached since 0.01522s ago] ('staff_users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-04 22:52:34,689 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-04 22:52:34,689 - sqlalchemy.engine.Engine - INFO - [cached since 0.01637s ago] ('student_sessions', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-04 22:52:34,690 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-04 22:52:34,690 - sqlalchemy.engine.Engine - INFO - [cached since 0.01738s ago] ('audit_logs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-04 22:52:34,691 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-04 22:52:34,691 - sqlalchemy.engine.Engine - INFO - [cached since 0.01818s ago] ('submission_queue', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-04 22:52:34,692 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-04 22:52:34,692 - sqlalchemy.engine.Engine - INFO - [cached since 0.01908s ago] ('system_config', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-04 22:52:34,693 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-04 22:52:34,694 - sqlalchemy.engine.Engine - INFO - [generated in 0.00047s] ('workflowstatus', 'pg_catalog')
2026-02-04 22:52:34,695 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-02-04 22:52:34,695 - app.main - INFO - Database tables created/verified
2026-02-04 22:52:34,696 - app.main - INFO - Upload directory: D:\LMS-SAE\exam_middleware\uploads
2026-02-04 22:52:34,696 - app.main - INFO - Storage directory: D:\LMS-SAE\exam_middleware\storage
2026-02-04 22:52:34,697 - app.main - INFO - Examination Middleware started successfully
2026-02-04 22:52:35,310 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-02-04 22:52:35,318 - sqlalchemy.engine.Engine - INFO - SELECT student_sessions.id, student_sessions.session_id, student_sessions.moodle_user_id, student_sessions.moodle_username, student_sessions.moodle_fullname, student_sessions.encrypted_token, student_sessions.token_expires_at, student_sessions.ip_address, student_sessions.user_agent, student_sessions.created_at, student_sessions.last_activity_at, student_sessions.expires_at 
FROM student_sessions 
WHERE student_sessions.session_id = $1::VARCHAR
2026-02-04 22:52:35,318 - sqlalchemy.engine.Engine - INFO - [generated in 0.00051s] ('VpXrQHMgHsiJi0ndyB2FuxRFj5MLzVqHY2_RJyWPF08',)
2026-02-04 22:52:35,327 - sqlalchemy.engine.Engine - INFO - DELETE FROM student_sessions WHERE student_sessions.id = $1::INTEGER
2026-02-04 22:52:35,328 - sqlalchemy.engine.Engine - INFO - [generated in 0.00031s] (5,)
2026-02-04 22:52:35,332 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-02-04 22:52:35,333 - app.db.database - ERROR - Database session error: 
2026-02-04 22:52:52,516 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2026-02-04 22:52:52,517 - multipart.multipart - DEBUG - Calling on_header_field with data[42:61]
2026-02-04 22:52:52,517 - multipart.multipart - DEBUG - Calling on_header_value with data[63:89]
2026-02-04 22:52:52,517 - multipart.multipart - DEBUG - Calling on_header_end with no data
2026-02-04 22:52:52,517 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2026-02-04 22:52:52,517 - multipart.multipart - DEBUG - Calling on_part_data with data[93:98]
2026-02-04 22:52:52,518 - multipart.multipart - DEBUG - Calling on_part_end with no data
2026-02-04 22:52:52,518 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2026-02-04 22:52:52,518 - multipart.multipart - DEBUG - Calling on_header_field with data[142:161]
2026-02-04 22:52:52,518 - multipart.multipart - DEBUG - Calling on_header_value with data[163:189]
2026-02-04 22:52:52,518 - multipart.multipart - DEBUG - Calling on_header_end with no data
2026-02-04 22:52:52,518 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2026-02-04 22:52:52,518 - multipart.multipart - DEBUG - Calling on_part_data with data[193:201]
2026-02-04 22:52:52,519 - multipart.multipart - DEBUG - Calling on_part_end with no data
2026-02-04 22:52:52,519 - multipart.multipart - DEBUG - Calling on_end with no data
2026-02-04 22:52:52,548 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-02-04 22:52:52,550 - sqlalchemy.engine.Engine - INFO - SELECT staff_users.id, staff_users.username, staff_users.email, staff_users.hashed_password, staff_users.full_name, staff_users.role, staff_users.is_active, staff_users.created_at, staff_users.last_login_at 
FROM staff_users 
WHERE staff_users.username = $1::VARCHAR
2026-02-04 22:52:52,550 - sqlalchemy.engine.Engine - INFO - [generated in 0.00044s] ('admin',)
2026-02-04 22:52:52,776 - sqlalchemy.engine.Engine - INFO - UPDATE staff_users SET last_login_at=$1::TIMESTAMP WITH TIME ZONE WHERE staff_users.id = $2::INTEGER
2026-02-04 22:52:52,777 - sqlalchemy.engine.Engine - INFO - [generated in 0.00057s] (datetime.datetime(2026, 2, 4, 17, 22, 52, 775609, tzinfo=datetime.timezone.utc), 1)
2026-02-04 22:52:52,781 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-02-04 22:53:18,485 - app.api.routes.auth - INFO - Authenticating student: 23004568
2026-02-04 22:53:18,722 - app.services.moodle_client - INFO - Authenticating user: 23004568
2026-02-04 22:53:18,723 - httpcore.connection - DEBUG - connect_tcp.started host='4401-2401-4900-7b70-c8be-41fd-1ad1-f71d-68de.ngrok-free.app' port=443 local_address=None timeout=30.0 socket_options=None
2026-02-04 22:53:18,938 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000013D48BB7BD0>
2026-02-04 22:53:18,938 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000013D48D056D0> server_hostname='4401-2401-4900-7b70-c8be-41fd-1ad1-f71d-68de.ngrok-free.app' timeout=30.0
2026-02-04 22:53:19,087 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000013D48BAB950>
2026-02-04 22:53:19,087 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-02-04 22:53:19,088 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-02-04 22:53:19,088 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-02-04 22:53:19,088 - httpcore.http11 - DEBUG - send_request_body.complete
2026-02-04 22:53:19,088 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-02-04 22:53:20,363 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Accept-Ranges', b'none'), (b'Access-Control-Allow-Origin', b'*'), (b'Cache-Control', b'no-store, no-cache, must-revalidate'), (b'Cache-Control', b'post-check=0, pre-check=0'), (b'Content-Length', b'126'), (b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Wed, 04 Feb 2026 17:23:19 GMT'), (b'Expires', b'Mon, 20 Aug 1969 09:23:00 GMT'), (b'Last-Modified', b'Wed, 04 Feb 2026 17:23:19 GMT'), (b'Ngrok-Agent-Ips', b'2401:4900:7b70:c8be:41fd:1ad1:f71d:68de'), (b'Pragma', b'no-cache'), (b'Server', b'Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.2.4'), (b'X-Powered-By', b'PHP/8.2.4')])
2026-02-04 22:53:20,364 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-02-04 22:53:20,364 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-02-04 22:53:20,364 - httpcore.http11 - DEBUG - response_closed.started
2026-02-04 22:53:20,364 - httpcore.http11 - DEBUG - response_closed.complete
2026-02-04 22:53:20,364 - app.services.moodle_client - INFO - Successfully authenticated user: 23004568
2026-02-04 22:53:20,365 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-02-04 22:53:20,365 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-02-04 22:53:20,365 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-02-04 22:53:20,365 - httpcore.http11 - DEBUG - send_request_body.complete
2026-02-04 22:53:20,366 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-02-04 22:53:20,974 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Accept-Ranges', b'none'), (b'Access-Control-Allow-Origin', b'*'), (b'Cache-Control', b'private, must-revalidate, pre-check=0, post-check=0, max-age=0'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 04 Feb 2026 17:23:20 GMT'), (b'Expires', b'Thu, 01 Jan 1970 00:00:00 GMT'), (b'Ngrok-Agent-Ips', b'2401:4900:7b70:c8be:41fd:1ad1:f71d:68de'), (b'Pragma', b'no-cache'), (b'Server', b'Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.2.4'), (b'X-Powered-By', b'PHP/8.2.4'), (b'Transfer-Encoding', b'chunked')])
2026-02-04 22:53:20,975 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-02-04 22:53:21,343 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-02-04 22:53:21,343 - httpcore.http11 - DEBUG - response_closed.started
2026-02-04 22:53:21,343 - httpcore.http11 - DEBUG - response_closed.complete
2026-02-04 22:53:21,343 - app.services.moodle_client - INFO - Got site info for user: 23004568
2026-02-04 22:53:21,347 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-02-04 22:53:21,348 - sqlalchemy.engine.Engine - INFO - INSERT INTO student_sessions (session_id, moodle_user_id, moodle_username, moodle_fullname, encrypted_token, token_expires_at, ip_address, user_agent, expires_at) VALUES ($1::VARCHAR, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::TIMESTAMP WITH TIME ZONE, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITH TIME ZONE) RETURNING student_sessions.id, student_sessions.created_at, student_sessions.last_activity_at
2026-02-04 22:53:21,348 - sqlalchemy.engine.Engine - INFO - [generated in 0.00036s] ('zaYhyk0RlkI6V7iGoPhhJhZXnKTd8BcQPpIzRY_neLY', 5, '23004568', 'Santhan Kumar 212222020029', 'Z0FBQUFBQnBnNENKUkN1amhWZ3dEN1JfdmQ2VDVZS1dIb3JDUHM3a1pybnVkTXpFRVVRZEJrcE1raW1GMkN0bFRwS3pVYTBBS2UxYkd6UHo4VHM3LXlBRTBfa0g5ZGRpRHg0MmZzUTNVWVlvTkZpSUxYMVI3ZXlXdFB0NDVGUEMzMVBFN2U2YTRSa0o=', None, '127.0.0.1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36', datetime.datetime(2026, 2, 4, 18, 23, 21, 343535, tzinfo=datetime.timezone.utc))
2026-02-04 22:53:21,353 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-02-04 22:53:21,355 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-02-04 22:53:21,358 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE (examination_artifacts.parsed_reg_no = $1::VARCHAR OR examination_artifacts.moodle_username = $2::VARCHAR) AND examination_artifacts.workflow_status IN ($3::workflowstatus, $4::workflowstatus, $5::workflowstatus, $6::workflowstatus) ORDER BY examination_artifacts.uploaded_at DESC
2026-02-04 22:53:21,358 - sqlalchemy.engine.Engine - INFO - [generated in 0.00076s] ('212223240065', '212223240065', 'PENDING', 'PENDING_REVIEW', 'VALIDATED', 'READY_FOR_REVIEW')
2026-02-04 22:53:21,382 - app.api.routes.auth - INFO - Student 23004568 (reg: 212223240065) logged in. Pending papers: 1
2026-02-04 22:53:21,383 - httpcore.connection - DEBUG - close.started
2026-02-04 22:53:21,383 - httpcore.connection - DEBUG - close.complete
2026-02-04 22:53:21,384 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-02-04 22:53:21,387 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-02-04 22:53:21,387 - sqlalchemy.engine.Engine - INFO - SELECT student_sessions.id, student_sessions.session_id, student_sessions.moodle_user_id, student_sessions.moodle_username, student_sessions.moodle_fullname, student_sessions.encrypted_token, student_sessions.token_expires_at, student_sessions.ip_address, student_sessions.user_agent, student_sessions.created_at, student_sessions.last_activity_at, student_sessions.expires_at 
FROM student_sessions 
WHERE student_sessions.session_id = $1::VARCHAR
2026-02-04 22:53:21,387 - sqlalchemy.engine.Engine - INFO - [cached since 46.07s ago] ('zaYhyk0RlkI6V7iGoPhhJhZXnKTd8BcQPpIzRY_neLY',)
2026-02-04 22:53:21,390 - sqlalchemy.engine.Engine - INFO - UPDATE student_sessions SET last_activity_at=$1::TIMESTAMP WITH TIME ZONE WHERE student_sessions.id = $2::INTEGER
2026-02-04 22:53:21,390 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] (datetime.datetime(2026, 2, 4, 17, 23, 21, 389453, tzinfo=datetime.timezone.utc), 6)
2026-02-04 22:53:21,390 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-02-04 22:53:21,391 - app.api.routes.student - INFO - [Dashboard] Decrypted user token for dynamic discovery (length: 32)
2026-02-04 22:53:21,393 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-02-04 22:53:21,394 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE (examination_artifacts.parsed_reg_no = $1::VARCHAR OR examination_artifacts.moodle_username = $2::VARCHAR) AND examination_artifacts.workflow_status IN ($3::workflowstatus, $4::workflowstatus, $5::workflowstatus, $6::workflowstatus) ORDER BY examination_artifacts.uploaded_at DESC
2026-02-04 22:53:21,394 - sqlalchemy.engine.Engine - INFO - [cached since 0.03682s ago] ('212222020029', '212222020029', 'PENDING', 'PENDING_REVIEW', 'VALIDATED', 'READY_FOR_REVIEW')
2026-02-04 22:53:21,396 - sqlalchemy.engine.Engine - INFO - SELECT examination_artifacts.id, examination_artifacts.artifact_uuid, examination_artifacts.raw_filename, examination_artifacts.original_filename, examination_artifacts.parsed_reg_no, examination_artifacts.parsed_subject_code, examination_artifacts.file_blob_path, examination_artifacts.file_hash, examination_artifacts.file_size_bytes, examination_artifacts.mime_type, examination_artifacts.moodle_user_id, examination_artifacts.moodle_username, examination_artifacts.moodle_course_id, examination_artifacts.moodle_assignment_id, examination_artifacts.workflow_status, examination_artifacts.moodle_draft_item_id, examination_artifacts.moodle_submission_id, examination_artifacts.lms_transaction_id, examination_artifacts.transaction_id, examination_artifacts.uploaded_at, examination_artifacts.validated_at, examination_artifacts.submit_timestamp, examination_artifacts.completed_at, examination_artifacts.uploaded_by_staff_id, examination_artifacts.submitted_by_user_id, examination_artifacts.transaction_log, examination_artifacts.error_message, examination_artifacts.retry_count 
FROM examination_artifacts 
WHERE examination_artifacts.parsed_reg_no = $1::VARCHAR AND examination_artifacts.workflow_status IN ($2::workflowstatus, $3::workflowstatus) ORDER BY examination_artifacts.submit_timestamp DESC
2026-02-04 22:53:21,396 - sqlalchemy.engine.Engine - INFO - [generated in 0.00047s] ('212222020029', 'SUBMITTED_TO_LMS', 'COMPLETED')
2026-02-04 22:53:21,399 - sqlalchemy.engine.Engine - INFO - SELECT subject_mappings.id, subject_mappings.subject_code, subject_mappings.subject_name, subject_mappings.moodle_course_id, subject_mappings.moodle_course_idnumber, subject_mappings.moodle_assignment_id, subject_mappings.moodle_assignment_name, subject_mappings.exam_session, subject_mappings.is_active, subject_mappings.created_at, subject_mappings.updated_at, subject_mappings.last_verified_at 
FROM subject_mappings 
WHERE subject_mappings.subject_code = $1::VARCHAR AND subject_mappings.is_active = true
2026-02-04 22:53:21,399 - sqlalchemy.engine.Engine - INFO - [generated in 0.00041s] ('19AI415',)
2026-02-04 22:53:21,402 - sqlalchemy.engine.Engine - INFO - SELECT subject_mappings.id, subject_mappings.subject_code, subject_mappings.subject_name, subject_mappings.moodle_course_id, subject_mappings.moodle_course_idnumber, subject_mappings.moodle_assignment_id, subject_mappings.moodle_assignment_name, subject_mappings.exam_session, subject_mappings.is_active, subject_mappings.created_at, subject_mappings.updated_at, subject_mappings.last_verified_at 
FROM subject_mappings 
WHERE subject_mappings.subject_code = $1::VARCHAR AND subject_mappings.is_active = true
2026-02-04 22:53:21,403 - sqlalchemy.engine.Engine - INFO - [generated in 0.00035s] ('19AI415',)
2026-02-04 22:53:21,403 - app.services.subject_discovery_service - INFO - [Layer 3] Attempting Moodle discovery for 19AI415 with token...
2026-02-04 22:53:21,403 - app.services.subject_discovery_service - INFO - [Discovery] Starting Moodle discovery for subject: 19AI415
2026-02-04 22:53:21,652 - httpcore.connection - DEBUG - connect_tcp.started host='4401-2401-4900-7b70-c8be-41fd-1ad1-f71d-68de.ngrok-free.app' port=443 local_address=None timeout=30.0 socket_options=None
2026-02-04 22:53:21,729 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000013D48DCC4D0>
2026-02-04 22:53:21,729 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000013D48D06F00> server_hostname='4401-2401-4900-7b70-c8be-41fd-1ad1-f71d-68de.ngrok-free.app' timeout=30.0
2026-02-04 22:53:21,831 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000013D48DCC410>
2026-02-04 22:53:21,831 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-02-04 22:53:21,831 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-02-04 22:53:21,831 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-02-04 22:53:21,831 - httpcore.http11 - DEBUG - send_request_body.complete
2026-02-04 22:53:21,831 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-02-04 22:53:22,306 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Accept-Ranges', b'none'), (b'Access-Control-Allow-Origin', b'*'), (b'Cache-Control', b'private, must-revalidate, pre-check=0, post-check=0, max-age=0'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 04 Feb 2026 17:23:21 GMT'), (b'Expires', b'Thu, 01 Jan 1970 00:00:00 GMT'), (b'Ngrok-Agent-Ips', b'2401:4900:7b70:c8be:41fd:1ad1:f71d:68de'), (b'Pragma', b'no-cache'), (b'Server', b'Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.2.4'), (b'X-Powered-By', b'PHP/8.2.4'), (b'Transfer-Encoding', b'chunked')])
2026-02-04 22:53:22,306 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-02-04 22:53:22,372 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-02-04 22:53:22,372 - httpcore.http11 - DEBUG - response_closed.started
2026-02-04 22:53:22,372 - httpcore.http11 - DEBUG - response_closed.complete
2026-02-04 22:53:22,372 - app.services.moodle_client - INFO - Got site info for user: 23004568
2026-02-04 22:53:22,372 - app.services.subject_discovery_service - INFO - [Discovery] User ID: 5, Username: 23004568
2026-02-04 22:53:22,373 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2026-02-04 22:53:22,373 - httpcore.http11 - DEBUG - send_request_headers.complete
2026-02-04 22:53:22,373 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2026-02-04 22:53:22,374 - httpcore.http11 - DEBUG - send_request_body.complete
2026-02-04 22:53:22,374 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2026-02-04 22:53:22,852 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Accept-Ranges', b'none'), (b'Access-Control-Allow-Origin', b'*'), (b'Cache-Control', b'private, must-revalidate, pre-check=0, post-check=0, max-age=0'), (b'Content-Length', b'234'), (b'Content-Type', b'application/json'), (b'Date', b'Wed, 04 Feb 2026 17:23:22 GMT'), (b'Expires', b'Thu, 01 Jan 1970 00:00:00 GMT'), (b'Ngrok-Agent-Ips', b'2401:4900:7b70:c8be:41fd:1ad1:f71d:68de'), (b'Pragma', b'no-cache'), (b'Server', b'Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.2.4'), (b'X-Powered-By', b'PHP/8.2.4')])
2026-02-04 22:53:22,853 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2026-02-04 22:53:22,853 - httpcore.http11 - DEBUG - receive_response_body.complete
2026-02-04 22:53:22,853 - httpcore.http11 - DEBUG - response_closed.started
2026-02-04 22:53:22,853 - httpcore.http11 - DEBUG - response_closed.complete
2026-02-04 22:53:22,853 - app.services.moodle_client - ERROR - Moodle API error in core_course_get_courses: errorcoursecontextnotvalid - You cannot execute functions in the course context (course id:2). The context error message was: Course or activity not accessible. (debug: None)
2026-02-04 22:53:22,853 - app.services.subject_discovery_service - WARNING - [Discovery] Moodle API error for 19AI415: Moodle API error: You cannot execute functions in the course context (course id:2). The context error message was: Course or activity not accessible.
2026-02-04 22:53:22,853 - httpcore.connection - DEBUG - close.started
2026-02-04 22:53:22,854 - httpcore.connection - DEBUG - close.complete
2026-02-04 22:53:22,854 - app.services.subject_discovery_service - WARNING - [Layer 3] Moodle discovery returned nothing for 19AI415
2026-02-04 22:53:22,854 - app.services.subject_discovery_service - INFO - [Layer 4] Checking config fallback for 19AI415
2026-02-04 22:53:22,854 - app.services.subject_discovery_service - ERROR - [NOT FOUND] No mapping found for subject code: 19AI415 after checking ALL layers
2026-02-04 22:53:22,854 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-02-04 22:53:22,865 - app.db.database - ERROR - Database session error: [{'type': 'missing', 'loc': ('header', 'X-Session-ID'), 'msg': 'Field required', 'input': None, 'url': 'https://errors.pydantic.dev/2.5/v/missing'}]
2026-02-04 22:53:25,703 - app.db.database - ERROR - Database session error: [{'type': 'missing', 'loc': ('header', 'X-Session-ID'), 'msg': 'Field required', 'input': None, 'url': 'https://errors.pydantic.dev/2.5/v/missing'}]
2026-02-04 22:54:26,948 - app.main - INFO - Shutting down Examination Middleware...
2026-02-04 22:54:26,952 - app.main - INFO - Database connections closed
2026-02-06 13:15:55,414 - asyncio - DEBUG - Using selector: EpollSelector
2026-02-06 13:17:09,245 - asyncio - DEBUG - Using selector: EpollSelector
2026-02-06 13:17:10,669 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2026-02-06 13:17:10,670 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-02-06 13:17:10,929 - sqlalchemy.engine.Engine - INFO - select current_schema()
2026-02-06 13:17:10,930 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-02-06 13:17:11,183 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2026-02-06 13:17:11,183 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2026-02-06 13:17:11,400 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-02-06 13:17:11,406 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-06 13:17:11,415 - sqlalchemy.engine.Engine - INFO - [generated in 0.00959s] ('examination_artifacts', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-06 13:17:11,712 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-06 13:17:11,712 - sqlalchemy.engine.Engine - INFO - [cached since 0.3068s ago] ('subject_mappings', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-06 13:17:11,792 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-06 13:17:11,793 - sqlalchemy.engine.Engine - INFO - [cached since 0.3873s ago] ('staff_users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-06 13:17:11,853 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-06 13:17:11,854 - sqlalchemy.engine.Engine - INFO - [cached since 0.4479s ago] ('student_sessions', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-06 13:17:11,932 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-06 13:17:11,933 - sqlalchemy.engine.Engine - INFO - [cached since 0.5272s ago] ('audit_logs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-06 13:17:11,998 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-06 13:17:11,999 - sqlalchemy.engine.Engine - INFO - [cached since 0.5932s ago] ('submission_queue', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-06 13:17:12,083 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-06 13:17:12,083 - sqlalchemy.engine.Engine - INFO - [cached since 0.6776s ago] ('system_config', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-06 13:17:12,145 - sqlalchemy.engine.Engine - INFO - SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-06 13:17:12,146 - sqlalchemy.engine.Engine - INFO - [generated in 0.00090s] ('workflowstatus', 'pg_catalog')
2026-02-06 13:17:12,313 - sqlalchemy.engine.Engine - INFO - CREATE TYPE workflowstatus AS ENUM ('PENDING', 'PENDING_REVIEW', 'VALIDATED', 'READY_FOR_REVIEW', 'LOCKED_BY_USER', 'UPLOADING', 'SUBMITTING', 'SUBMITTED_TO_LMS', 'COMPLETED', 'FAILED', 'QUEUED')
2026-02-06 13:17:12,314 - sqlalchemy.engine.Engine - INFO - [no key 0.00059s] ()
2026-02-06 13:17:12,493 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE subject_mappings (
	id SERIAL NOT NULL, 
	subject_code VARCHAR(20) NOT NULL, 
	subject_name VARCHAR(255), 
	moodle_course_id INTEGER NOT NULL, 
	moodle_course_idnumber VARCHAR(50), 
	moodle_assignment_id INTEGER NOT NULL, 
	moodle_assignment_name VARCHAR(255), 
	exam_session VARCHAR(50), 
	is_active BOOLEAN, 
	created_at TIMESTAMP WITH TIME ZONE DEFAULT now(), 
	updated_at TIMESTAMP WITH TIME ZONE, 
	last_verified_at TIMESTAMP WITH TIME ZONE, 
	PRIMARY KEY (id)
)


2026-02-06 13:17:12,493 - sqlalchemy.engine.Engine - INFO - [no key 0.00059s] ()
2026-02-06 13:17:12,654 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_subject_mappings_subject_code ON subject_mappings (subject_code)
2026-02-06 13:17:12,655 - sqlalchemy.engine.Engine - INFO - [no key 0.00092s] ()
2026-02-06 13:17:12,787 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE staff_users (
	id SERIAL NOT NULL, 
	username VARCHAR(100) NOT NULL, 
	email VARCHAR(255) NOT NULL, 
	hashed_password VARCHAR(255) NOT NULL, 
	full_name VARCHAR(255), 
	role VARCHAR(50), 
	is_active BOOLEAN, 
	created_at TIMESTAMP WITH TIME ZONE DEFAULT now(), 
	last_login_at TIMESTAMP WITH TIME ZONE, 
	PRIMARY KEY (id), 
	UNIQUE (email)
)


2026-02-06 13:17:12,788 - sqlalchemy.engine.Engine - INFO - [no key 0.00050s] ()
2026-02-06 13:17:12,917 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_staff_users_username ON staff_users (username)
2026-02-06 13:17:12,917 - sqlalchemy.engine.Engine - INFO - [no key 0.00074s] ()
2026-02-06 13:17:13,050 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE student_sessions (
	id SERIAL NOT NULL, 
	session_id VARCHAR(64) NOT NULL, 
	moodle_user_id BIGINT NOT NULL, 
	moodle_username VARCHAR(100) NOT NULL, 
	moodle_fullname VARCHAR(255), 
	encrypted_token TEXT NOT NULL, 
	token_expires_at TIMESTAMP WITH TIME ZONE, 
	ip_address VARCHAR(45), 
	user_agent VARCHAR(500), 
	created_at TIMESTAMP WITH TIME ZONE DEFAULT now(), 
	last_activity_at TIMESTAMP WITH TIME ZONE DEFAULT now(), 
	expires_at TIMESTAMP WITH TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


2026-02-06 13:17:13,051 - sqlalchemy.engine.Engine - INFO - [no key 0.00048s] ()
2026-02-06 13:17:13,211 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_session_expires ON student_sessions (expires_at)
2026-02-06 13:17:13,212 - sqlalchemy.engine.Engine - INFO - [no key 0.00077s] ()
2026-02-06 13:17:13,350 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_student_sessions_session_id ON student_sessions (session_id)
2026-02-06 13:17:13,351 - sqlalchemy.engine.Engine - INFO - [no key 0.00085s] ()
2026-02-06 13:17:13,488 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE system_config (
	id SERIAL NOT NULL, 
	key VARCHAR(100) NOT NULL, 
	value TEXT, 
	value_type VARCHAR(20), 
	description TEXT, 
	updated_at TIMESTAMP WITH TIME ZONE, 
	PRIMARY KEY (id), 
	UNIQUE (key)
)


2026-02-06 13:17:13,489 - sqlalchemy.engine.Engine - INFO - [no key 0.00086s] ()
2026-02-06 13:17:13,655 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE examination_artifacts (
	id SERIAL NOT NULL, 
	artifact_uuid UUID NOT NULL, 
	raw_filename VARCHAR(255) NOT NULL, 
	original_filename VARCHAR(255) NOT NULL, 
	parsed_reg_no VARCHAR(20), 
	parsed_subject_code VARCHAR(20), 
	file_blob_path VARCHAR(512) NOT NULL, 
	file_hash VARCHAR(64) NOT NULL, 
	file_size_bytes BIGINT, 
	mime_type VARCHAR(100), 
	moodle_user_id BIGINT, 
	moodle_username VARCHAR(100), 
	moodle_course_id INTEGER, 
	moodle_assignment_id INTEGER, 
	workflow_status workflowstatus NOT NULL, 
	moodle_draft_item_id BIGINT, 
	moodle_submission_id VARCHAR(100), 
	lms_transaction_id VARCHAR(100), 
	transaction_id VARCHAR(64), 
	uploaded_at TIMESTAMP WITH TIME ZONE DEFAULT now(), 
	validated_at TIMESTAMP WITH TIME ZONE, 
	submit_timestamp TIMESTAMP WITH TIME ZONE, 
	completed_at TIMESTAMP WITH TIME ZONE, 
	uploaded_by_staff_id INTEGER, 
	submitted_by_user_id BIGINT, 
	transaction_log JSONB, 
	error_message TEXT, 
	retry_count INTEGER, 
	PRIMARY KEY (id), 
	CONSTRAINT uq_paper_submission UNIQUE (parsed_reg_no, parsed_subject_code), 
	UNIQUE (artifact_uuid), 
	UNIQUE (transaction_id), 
	FOREIGN KEY(uploaded_by_staff_id) REFERENCES staff_users (id)
)


2026-02-06 13:17:13,656 - sqlalchemy.engine.Engine - INFO - [no key 0.00091s] ()
2026-02-06 13:17:13,804 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_examination_artifacts_parsed_reg_no ON examination_artifacts (parsed_reg_no)
2026-02-06 13:17:13,804 - sqlalchemy.engine.Engine - INFO - [no key 0.00075s] ()
2026-02-06 13:17:13,926 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_artifacts_status ON examination_artifacts (workflow_status)
2026-02-06 13:17:13,927 - sqlalchemy.engine.Engine - INFO - [no key 0.00080s] ()
2026-02-06 13:17:14,052 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_artifacts_reg_subject ON examination_artifacts (parsed_reg_no, parsed_subject_code)
2026-02-06 13:17:14,053 - sqlalchemy.engine.Engine - INFO - [no key 0.00054s] ()
2026-02-06 13:17:14,189 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_examination_artifacts_parsed_subject_code ON examination_artifacts (parsed_subject_code)
2026-02-06 13:17:14,190 - sqlalchemy.engine.Engine - INFO - [no key 0.00067s] ()
2026-02-06 13:17:14,349 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE audit_logs (
	id SERIAL NOT NULL, 
	action VARCHAR(100) NOT NULL, 
	action_category VARCHAR(50) NOT NULL, 
	description TEXT, 
	actor_type VARCHAR(20) NOT NULL, 
	actor_id VARCHAR(100), 
	actor_username VARCHAR(100), 
	actor_ip VARCHAR(45), 
	artifact_id INTEGER, 
	target_type VARCHAR(50), 
	target_id VARCHAR(100), 
	request_data JSONB, 
	response_data JSONB, 
	error_details JSONB, 
	moodle_api_function VARCHAR(100), 
	moodle_response_code INTEGER, 
	created_at TIMESTAMP WITH TIME ZONE DEFAULT now(), 
	PRIMARY KEY (id), 
	FOREIGN KEY(artifact_id) REFERENCES examination_artifacts (id)
)


2026-02-06 13:17:14,349 - sqlalchemy.engine.Engine - INFO - [no key 0.00077s] ()
2026-02-06 13:17:14,471 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_audit_logs_created_at ON audit_logs (created_at)
2026-02-06 13:17:14,472 - sqlalchemy.engine.Engine - INFO - [no key 0.00083s] ()
2026-02-06 13:17:14,603 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_audit_actor ON audit_logs (actor_type, actor_id)
2026-02-06 13:17:14,603 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2026-02-06 13:17:14,741 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_audit_artifact_action ON audit_logs (artifact_id, action)
2026-02-06 13:17:14,742 - sqlalchemy.engine.Engine - INFO - [no key 0.00063s] ()
2026-02-06 13:17:14,878 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_audit_logs_action ON audit_logs (action)
2026-02-06 13:17:14,879 - sqlalchemy.engine.Engine - INFO - [no key 0.00085s] ()
2026-02-06 13:17:15,004 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE submission_queue (
	id SERIAL NOT NULL, 
	artifact_id INTEGER NOT NULL, 
	status VARCHAR(20), 
	priority INTEGER, 
	retry_count INTEGER, 
	max_retries INTEGER, 
	next_retry_at TIMESTAMP WITH TIME ZONE, 
	queued_at TIMESTAMP WITH TIME ZONE DEFAULT now(), 
	processed_at TIMESTAMP WITH TIME ZONE, 
	last_error TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(artifact_id) REFERENCES examination_artifacts (id)
)


2026-02-06 13:17:15,005 - sqlalchemy.engine.Engine - INFO - [no key 0.00068s] ()
2026-02-06 13:17:15,167 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_queue_status_retry ON submission_queue (status, next_retry_at)
2026-02-06 13:17:15,168 - sqlalchemy.engine.Engine - INFO - [no key 0.00122s] ()
2026-02-06 13:17:15,310 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-02-06 13:17:15,654 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-02-06 13:17:15,655 - sqlalchemy.engine.Engine - INFO - SELECT id FROM staff_users WHERE username = 'admin'
2026-02-06 13:17:15,655 - sqlalchemy.engine.Engine - INFO - [generated in 0.00037s] ()
2026-02-06 13:17:16,314 - sqlalchemy.engine.Engine - INFO - INSERT INTO staff_users (username, email, hashed_password, full_name, role, is_active, last_login_at) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::TIMESTAMP WITH TIME ZONE) RETURNING staff_users.id, staff_users.created_at
2026-02-06 13:17:16,314 - sqlalchemy.engine.Engine - INFO - [generated in 0.00047s] ('admin', 'admin@example.com', '$2b$12$gWqGMfXBMvYcRoU6UKjcj.mLhmcLLzyHSjX1vwZgW/f3yzu7diWfa', 'Administrator', 'admin', True, None)
2026-02-06 13:17:16,440 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-02-06 13:17:16,722 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-02-06 13:17:16,722 - sqlalchemy.engine.Engine - INFO - SELECT id FROM subject_mappings WHERE subject_code = $1
2026-02-06 13:17:16,723 - sqlalchemy.engine.Engine - INFO - [generated in 0.00064s] ('19AI405',)
2026-02-06 13:17:16,923 - sqlalchemy.engine.Engine - INFO - SELECT id FROM subject_mappings WHERE subject_code = $1
2026-02-06 13:17:16,923 - sqlalchemy.engine.Engine - INFO - [cached since 0.2007s ago] ('19AI411',)
2026-02-06 13:17:16,988 - sqlalchemy.engine.Engine - INFO - SELECT id FROM subject_mappings WHERE subject_code = $1
2026-02-06 13:17:16,989 - sqlalchemy.engine.Engine - INFO - [cached since 0.2665s ago] ('ML',)
2026-02-06 13:17:17,050 - sqlalchemy.engine.Engine - INFO - INSERT INTO subject_mappings (subject_code, subject_name, moodle_course_id, moodle_course_idnumber, moodle_assignment_id, moodle_assignment_name, exam_session, is_active, updated_at, last_verified_at) SELECT p0::VARCHAR, p1::VARCHAR, p2::INTEGER, p3: ... 735 characters truncated ... sen_counter RETURNING subject_mappings.id, subject_mappings.created_at, subject_mappings.id AS id__1
2026-02-06 13:17:17,050 - sqlalchemy.engine.Engine - INFO - [generated in 0.00024s (insertmanyvalues) 1/1 (ordered)] ('19AI405', 'Deep Learning', 3, None, 4, None, '2024-1', True, None, None, '19AI411', 'Natural Language Processing', 4, None, 6, None, '2024-1', True, None, None, 'ML', 'Machine Learning', 2, None, 2, None, '2024-1', True, None, None)
2026-02-06 13:17:17,181 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-02-06 13:17:17,449 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-02-06 13:17:17,450 - sqlalchemy.engine.Engine - INFO - SELECT id FROM system_config WHERE key = $1
2026-02-06 13:17:17,450 - sqlalchemy.engine.Engine - INFO - [generated in 0.00036s] ('moodle_maintenance_mode',)
2026-02-06 13:17:17,634 - sqlalchemy.engine.Engine - INFO - SELECT id FROM system_config WHERE key = $1
2026-02-06 13:17:17,635 - sqlalchemy.engine.Engine - INFO - [cached since 0.185s ago] ('max_file_size_mb',)
2026-02-06 13:17:17,707 - sqlalchemy.engine.Engine - INFO - SELECT id FROM system_config WHERE key = $1
2026-02-06 13:17:17,708 - sqlalchemy.engine.Engine - INFO - [cached since 0.258s ago] ('allowed_extensions',)
2026-02-06 13:17:17,799 - sqlalchemy.engine.Engine - INFO - SELECT id FROM system_config WHERE key = $1
2026-02-06 13:17:17,799 - sqlalchemy.engine.Engine - INFO - [cached since 0.3494s ago] ('exam_session',)
2026-02-06 13:17:17,871 - sqlalchemy.engine.Engine - INFO - INSERT INTO system_config (key, value, value_type, description, updated_at) SELECT p0::VARCHAR, p1::VARCHAR, p2::VARCHAR, p3::VARCHAR, p4::TIMESTAMP WITH TIME ZONE FROM (VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::TIMESTAMP WITH T ... 304 characters truncated ...  p2, p3, p4, sen_counter) ORDER BY sen_counter RETURNING system_config.id, system_config.id AS id__1
2026-02-06 13:17:17,872 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s (insertmanyvalues) 1/1 (ordered)] ('moodle_maintenance_mode', 'false', 'string', 'Whether Moodle is in maintenance mode', None, 'max_file_size_mb', '50', 'string', 'Maximum file size in MB for uploads', None, 'allowed_extensions', 'pdf,jpg,jpeg,png', 'string', 'Comma-separated list of allowed file extensions', None, 'exam_session', '2024-SPRING', 'string', 'Current examination session', None)
2026-02-06 13:17:18,025 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-02-06 13:17:18,267 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-02-06 13:17:18,267 - sqlalchemy.engine.Engine - INFO - SELECT 1
2026-02-06 13:17:18,268 - sqlalchemy.engine.Engine - INFO - [generated in 0.00043s] ()
2026-02-06 13:17:18,466 - sqlalchemy.engine.Engine - INFO - COMMIT
2026-02-06 13:17:18,708 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2026-02-06 13:17:18,708 - sqlalchemy.engine.Engine - INFO - 
                SELECT table_name 
                FROM information_schema.tables 
                WHERE table_schema = 'public'
            
2026-02-06 13:17:18,709 - sqlalchemy.engine.Engine - INFO - [generated in 0.00041s] ()
2026-02-06 13:17:18,928 - sqlalchemy.engine.Engine - INFO - COMMIT
